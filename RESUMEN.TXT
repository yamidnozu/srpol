
/* Directorio:  */
├── .prettierrc.json [8]
├── eslint.config.js [16]
├── firebase.json [13]
├── index.html [17]
├── package.json [57]
├── postcss.config.js [7]
├── 📂 public
│   ├── SrPolForYouSinTitle.svg [42]
├── 📂 src
│   ├── App.tsx [175]
│   ├── 📂 assets
│   │   ├── react.svg [1]
│   │   └── SrPolForYouSinTitle.svg [42]
│   ├── 📂 components
│   │   ├── 📂 auth
│   │   │   ├── LoginForm.tsx [58]
│   │   │   └── RegisterForm.tsx [58]
│   │   ├── 📂 forms
│   │   │   ├── MenuForm.tsx [222]
│   │   │   └── PedidoForm.tsx [225]
│   │   ├── 📂 layout
│   │   │   ├── MainLayout.tsx [50]
│   │   │   ├── Navbar.tsx [57]
│   │   │   ├── PublicLayout.tsx [14]
│   │   │   └── Sidebar.tsx [123]
│   │   ├── 📂 menu
│   │   │   ├── GroupOrderPage.tsx [603]
│   │   │   ├── JoinOrderModal.tsx [47]
│   │   │   ├── MenuForm.tsx [223]
│   │   │   ├── MenuItem.tsx [86]
│   │   │   ├── MenuList.tsx [29]
│   │   │   ├── MenuModal.tsx [77]
│   │   │   ├── NameModal.tsx [63]
│   │   │   ├── 📂 partials
│   │   │   │   ├── OrderReview.tsx [197]
│   │   │   │   ├── PeopleSelection.tsx [63]
│   │   │   │   ├── PersonOrder.tsx [225]
│   │   │   │   └── SharedOrder.tsx [174]
│   │   │   └── PersonMenuModal.tsx [197]
│   │   ├── 📂 payment
│   │   │   └── PaymentForm.tsx [80]
│   │   ├── 📂 pedidos
│   │   │   ├── PedidoForm.tsx [228]
│   │   │   ├── PedidoItem.tsx [9]
│   │   │   └── PedidoList.tsx [395]
│   │   ├── 📂 splash
│   │   │   └── SplashScreen.tsx [63]
│   │   └── 📂 ui
│   │       ├── Button.tsx [79]
│   │       ├── Container.tsx [17]
│   │       ├── CurrencyInput.tsx [64]
│   │       ├── ErrorBoundry.tsx [46]
│   │       ├── ListItem.tsx [64]
│   │       └── TextField.tsx [34]
│   ├── 📂 context
│   │   ├── AppContext.tsx [81]
│   │   └── AuthContext.tsx [160]
│   ├── 📂 hooks
│   │   ├── useAuth.ts [11]
│   │   └── useMenu.ts [10]
│   ├── main.tsx [10]
│   ├── 📂 pages
│   │   ├── ContabilidadDetail.tsx [602]
│   │   ├── ContabilidadPage.tsx [353]
│   │   ├── Dashboard.tsx [1000]
│   │   ├── GestionMenu.tsx [1153]
│   │   ├── GestionUsuarios.tsx [82]
│   │   ├── Login.tsx [62]
│   │   ├── MenuPage.tsx [222]
│   │   ├── PedidosPage.tsx [18]
│   │   ├── Perfil.tsx [97]
│   │   └── Success.tsx [41]
│   ├── 📂 payment
│   │   └── payment.ts [87]
│   ├── 📂 styles
│   │   ├── authForm.css [65]
│   │   ├── global.css [66]
│   │   ├── login.css [132]
│   │   ├── public-layout.css [11]
│   │   └── SplashScreen.css [76]
│   ├── 📂 types
│   │   ├── css.d.ts [2]
│   │   └── global.d.ts [83]
│   └── 📂 utils
│       ├── constants.ts [6]
│       ├── firebase.ts [16]
│       ├── menu-scripts.ts [223]
│       └── theme.ts [43]
├── tailwind.config.js [9]
├── tsconfig.app.json [26]
├── tsconfig.json [29]
├── tsconfig.node.json [25]
└── vite.config.ts [41]


Total de líneas resumidas: 9090


/* Inicio .prettierrc.json */
{
  "semi": false,
  "trailingComma": "all",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2,
  "useTabs": false
}
/* Fin .prettierrc.json */

/* Inicio eslint.config.js */
import js from "@eslint/js";
import tseslint from "typescript-eslint";

export default tseslint.config(
  {
    files: ["**/*.{ts,tsx}"], // Asegúrate de incluir esto para que se aplique a archivos TS/TSX
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.json'], //  <- Ruta a tu tsconfig.json
        tsconfigRootDir: import.meta.dirname, // <-  Directorio raíz para tsconfig.json
      },
    },
  },
  js.configs.recommended,
  ...tseslint.configs.recommendedTypeChecked,
);
/* Fin eslint.config.js */

/* Inicio firebase.json */
{
  "hosting": {
    "public": "dist",
    "ignore": ["firebase.json", "**/.*", "**/node_modules/**"],
    "rewrites": [
      {
        "source": "**",
        "destination": "/index.html"
      }
    ]
  }
}

/* Fin firebase.json */

/* Inicio index.html */
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <link rel="apple-touch-icon" href="/logo192.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <link rel="manifest" href="/manifest.json" /> -->
    <meta name="theme-color" content="#ffffff" />
    <title>SrPol</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>

/* Fin index.html */

/* Inicio package.json */
{
  "name": "srpol",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview",
    "format": "npx eslint . --fix && npx prettier . --write"
  },
  "dependencies": {
    "@emotion/react": "^11.14.0",
    "@emotion/styled": "^11.14.0",
    "@mercadopago/sdk-js": "^0.0.3",
    "@mui/icons-material": "^6.4.1",
    "@mui/material": "^6.4.1",
    "@mui/x-data-grid": "^7.24.1",
    "@stripe/stripe-js": "^5.5.0",
    "axios": "^1.7.9",
    "chart.js": "^4.4.7",
    "firebase": "^11.2.0",
    "firebase-admin": "^13.0.2",
    "firebase-functions": "^6.3.0",
    "react": "^18.3.1",
    "react-chartjs-2": "^5.3.0",
    "react-dom": "^18.3.1",
    "react-icons": "^5.4.0",
    "react-router-dom": "^7.1.3",
    "stripe": "^17.5.0",
    "uuid": "^11.0.5"
  },
  "devDependencies": {
    "@eslint/js": "^9.17.0",
    "@types/react": "^18.3.18",
    "@types/react-dom": "^18.3.5",
    "@typescript-eslint/eslint-plugin": "^8.22.0",
    "@typescript-eslint/parser": "^8.22.0",
    "@vitejs/plugin-react": "^4.3.4",
    "autoprefixer": "^10.4.17",
    "eslint": "^9.19.0",
    "eslint-config-prettier": "^10.0.1",
    "eslint-plugin-import": "^2.31.0",
    "eslint-plugin-react": "^7.37.4",
    "eslint-plugin-react-hooks": "^5.1.0",
    "eslint-plugin-react-refresh": "^0.4.16",
    "globals": "^15.14.0",
    "postcss": "^8.4.35",
    "prettier": "^3.4.2",
    "tailwindcss": "^3.4.1",
    "typescript": "~5.6.2",
    "typescript-eslint": "^8.18.2",
    "vite": "^6.0.5",
    "vite-plugin-pwa": "^0.21.1"
  }
}
/* Fin package.json */

/* Inicio postcss.config.js */
import autoprefixer from 'autoprefixer'
import tailwindcss from 'tailwindcss'

export default {
  plugins: [tailwindcss('./tailwind.config.js'), autoprefixer],
}

/* Fin postcss.config.js */

/* Inicio public\SrPolForYouSinTitle.svg */
<?xml version="1.0" encoding="UTF-8"?>
<svg version="1.1" viewBox="0 0 2000 2000" width="2000" height="2000" xmlns="http://www.w3.org/2000/svg">
<path transform="translate(1096,273)" d="m0 0h16l21 3 21 6 18 8 16 9 20 15 5-2 16-8 14-6 21-7 24-5 18-2h29l23 3 24 6 25 10 15 8 12 8 13 10 15 14 9 10 12 16 11 19 10 21 8 24 3 12 8 2 29 6 28 8 25 10 20 10 15 10 10 8 10 9 11 12 9 13 10 19 7 21 3 15 1 9v30l-4 27-7 26-8 21-4 9 2 4 8 14 6 14 4 16 1 8v25l-3 18-6 20-8 18-1 2 15 37 12 34 10 33 10 40 8 42 5 37 3 33 1 18v68l-3 42-5 40-6 34-8 36-1 2 15 1 23 4 20 6 19 8 16 10 13 11 7 7 10 14 7 15 4 14 2 16-1 17-4 17-5 13-8 15-9 12-9 10-12 11-17 12-17 9-18 6-26 5-24 2 2 14v32l-4 21-7 19-7 13-8 11-9 10-8 8-14 10-17 10-19 8-18 6-26 6-29 4-43 3-15 12-17 10-20 8-17 5-16 3-10 1-18 11-19 12-25 14-29 15-28 13-37 15-34 12-34 10-36 9-36 7-42 6-32 3-17 1h-76l-40-3-39-5-39-7-39-9-31-9-36-12-26-10-28-12-29-14-29-15-22-13-19-12-21-14-18-13-21-16-11-9-13-11-10-9-8-7-13-12-31-31-7-8-11-12-9-11-14-17-15-20-13-18-12-18-12-19-14-24-13-24-13-26-14-32-13-34-12-36-10-36-8-35-7-41-4-32-3-40v-76l3-40 5-39 7-39 8-35 10-35 12-36 14-36 16-35 14-28 13-23 12-20 24-36 13-18 14-18 9-11 11-13 9-10 7-8 15-16 24-24 8-7 13-12 11-9 13-11 17-13 16-12 20-14 25-16 22-13 22-12 23-12 35-16 36-14 38-13 36-10 34-8 39-7 40-5 42-3h15l4-16 9-21 10-17 10-13 11-12 11-10 14-10 19-10 21-7 15-3z" fill="#C11A25"/>
<path transform="translate(685,1266)" d="m0 0 15 2 23 14 21 12 21 11 33 15 33 13 35 12 43 12 41 9 35 6 40 5 23 2 18 1h68l28-2 32-4 31-6 25-7 9-3 3-3 9 6 5 6 14 11 14 9 20 10-2 4-8 6-16 8-15 4-16 2-20 1 12 3 8 1h14l16-3 14-5 11-7 7-6h2l2-4 2-2v-6l-20-9-20-11-6-4 2-1 21 7 22 5 28 4 28 2h52l36-2 54-5 85-9 38-3 21-1h32l26 2 22 4 20 6 16 8 14 9 10 9 9 12 6 12 4 15v22l-4 16-6 14-8 12-11 13-13 11-14 9-15 7-15 5-19 4-10 1h-25l-3-1-8-16-8-11-9-9-14-10-21-11-25-9-28-7-24-4-21-2 31 6 25 7 20 7 25 12 12 8 11 9 7 7 7 10 5 10 2 6 1 7 4 9 3 14 1 8v26l-4 20-6 15-6 11-8 10-8 9-17 13-19 10-19 7-21 6-29 5-21 2-24 1 5-21 1-8v-19l-3-17-5-15-8-15-11-14-11-11-16-11-17-9-21-7-14-3-17-2h-8l21 3 19 5 19 8 14 8 14 11 10 10 10 14 7 14 5 17 1 5v26l-4 17-7 17-12 10-13 8-19 9-21 6-22 3h-20l-18-2-23-5-24-8-20-9-25-13-12-9-12-11-7-8-13-15-12-16-13-18-16-24-16-25-14-22-11-17-3-4 7 20 14 29 14 24 12 19 14 21 13 18 11 14 9 10 7 8 12 11 14 9 22 12-3 3-32 15-34 14-41 14-36 10-37 8-37 6-37 4-39 2h-33l-38-2-38-4-37-6-41-9-35-10-38-13-32-13-28-13-22-11-23-13-4-3-2-19-1-26 2-1 28 3h48l16-3 12-5 11-8 6-8 5-10 3-11 24-5 16-6 13-7 11-9 8-11 5-10 3-14v-20l19-10 17-10 19-14 15-13 14-14 11-14 7-10 9-16 5-14 2-11v-11l-2-9-5-10-9-9-16-8-16-4-21-2h-76l-68 3-74 5-81 7-59 6-6 2-1 1v7h13l82-8 73-6 63-4 43-2 39-1h33l27 1 19 3 13 5 9 6 5 6 4 10v14l-4 14-8 16-9 13-9 11-13 14-8 7-16 13-15 10-21 12-14 6-2 2 1 10v18l-4 13-7 10-7 7-11 7-14 6-19 5-16 3-2 7-3 11-5 9-7 7-12 6-12 3-11 1h-31l-32-3-28-5-28-7-26-9-24-11-17-10-14-10-11-9-16-16-11-15-8-14-6-13-3-7-4-21-1-8v-31l3-19 6-20 8-18 8-14 12-16 12-14 7-7 8-7 15-12 21-14 21-12 27-13 25-10 4 2 10 7 16 8 17 5 7 2-6 12-7 12v6l8 3 12 2h29l15-3 10-4 7-5-34 4h-18l-14-2-3-1 2-5 13-22-1-5-5-2-20-4-15-6-12-7-9-8-2-4 18-5 18-8 14-8 13-10z" fill="#FCFCFC"/>
<path transform="translate(898,614)" d="m0 0 4 2 29 19 27 18 12 9 14 12 7 7 9 12 8 16 4 13 3 3 3 1h16l16-4 11-6 19-13 15-7 12-3 7-1h29l24 4 21 5 33 22 18 13 17 13 14 11 13 11 11 9 13 12 8 7 16 15 29 29 7 8 14 15 9 11 13 15 11 14 14 18 10 14 4 5 9 2 3 13 4 29 1 11 1 33-1 25-3 30-5 30-8 32-10 29-9 20-8 16-12 20-13 18-12 14-11 12-9 9-11 9-12 10-21 14-21 12-19 9-24 9-23 7-34 7-31 4-25 2-44 1-31-1-39-3-39-5-39-7-31-7-30-8-35-11-30-11-26-11-28-13-23-12-27-16-21-14-18-13-11-9-11-10-8-7-9-9-7-8-13-16-12-17-12-21-10-21-10-30-5-25-1-8v-34l3-18 5-17 10-22 11-18 11-14 32-32 10-15 9-19 14-38 10-23 12-25 12-21 14-21 9-12 9-11 9-10 7-8 13-13 8-7 16-13 16-11 13-8 18-10 19-9 24-9z" fill="#FCFCFC"/>
<path transform="translate(913,440)" d="m0 0h6l-3 2-16 6-14 8-10 8-10 10-9 14-7 15-5 21v24l4 16 6 14 10 14 6 6v2l-27 11-23 11-17 10-18 12-17 13-15 13-24 24-9 11-12 15-16 24-14 24-14 28-12 29-14 38-9 17-9 11-31 31-11 15-11 19-9 19-6 18-4 22-1 11v24l3 25 6 25 6 18 10 23 11 21 14 21 10 13 11 13 14 15 14 13 11 9 10 8-2 4-14 11-16 9-15 6-19 5-9 3-4 6v10l-27 12-24 12-23 14-19 14-13 11-13 12-10 11-12 16-12 20-8 17-6 18-5 25-1 11v22l3 24 6 24 6 15 10 15 10 14 12 13 10 10 17 13 19 12 16 8 20 9 33 11 28 7 3 45 5 4 27 15 27 14 31 14 33 13 28 10 41 12 38 9 33 6 39 5 40 3h67l39-3 37-5 33-6 37-9 34-10 34-12 31-13 28-13 8-4 7 1 18 7 9 3v2l-22 12-26 13-25 11-28 11-31 11-42 12-30 7-32 6-37 5-36 3-23 1h-40l-38-2-38-4-43-7-40-9-32-9-36-12-36-14-28-13-16-8-27-14-22-13-22-14-16-11-18-13-14-11-16-13-14-12-24-22-28-28-7-8-10-11-9-11-11-13-15-20-13-18-14-21-13-21-13-23-12-23-15-31-15-37-12-34-10-34-9-38-7-38-4-31-3-35-1-23v-41l2-37 4-38 6-38 7-33 9-35 10-32 11-30 13-31 16-33 14-27 17-28 10-16 14-20 14-19 11-14 11-13 9-11 15-16 9-10 24-24 8-7 13-12 11-9 13-11 20-15 19-14 26-17 25-15 18-10 27-14 28-13 30-12 28-10 25-8 38-10 33-7 38-6z" fill="#FDE430"/>
<path transform="translate(1096,295)" d="m0 0h17l19 3 16 5 16 7 14 8 14 10 7 6-2 4-11 15-9 16-1 4 7-9 17-17 17-12 23-12 21-8 23-6 22-3h30l22 3 25 7 18 8 15 8 14 10 10 9 8 7 12 14 11 16 10 18 8 19 7 23 3 17 29 5 27 6 23 7 24 10 17 9 14 10 14 12 10 11 10 15 7 15 5 16 3 18v30l-4 25-7 25-10 25-4 8v6l10 13 8 16 4 14 1 6v27l-4 20-6 16-8 16-10 14-11 12-9 8-14 9-16 7-13 3h-24l-19-4-15-6-13-7-12-9-11-10-9-11-10-14-11-21-4-10v-3l25 1 20-2 16-4 15-6 7-5-12 5-16 4-8 1h-22l-18-3-22-6-16-6-21-11-14-10-13-11-13-13-13-17-11-18-5-10v-3l19-9 16-10 13-10 12-11-18 12-21 11-19 7-17 4h-15l-26-4-24-7-23-10-17-10-5-5 4-20 1-9v-31l-3-20-6-23-8-21-9-17-8-11-9-10-10-7-11-5-5-2 3-9 9-16-4 4-12 20-2 1h-10l-14 3-16 8-9 6-10 9-4-2-7-8-7-7-16-11-21-11-24-8-22-4-6-1-1-4v-27l4-20 6-18 12-23 10-13 11-12 9-8 10-7 14-8 19-7 14-3z" fill="#FCFCFC"/>
<path transform="translate(1648,889)" d="m0 0 3 4 13 36 10 32 11 44 7 37 5 38 3 37 1 27v25l-2 43-4 39-6 38-7 34-5 20-6 2-31 2-54 5-85 9-40 3-20 1h-50l-36-3-28-5-24-7-4-2 4-3 23-13 19-13 14-11 11-10 8-7 10-10 7-8 13-16 16-24 12-21 9-19 10-26 8-26 6-26 5-31 3-35v-49l-3-31-5-29 1-4 9-11 13-15 11-13 1-2 6 2 10 6 15 6 14 4 10 2 10 1h15l18-3 15-5 16-8z" fill="#FDE430"/>
<path transform="translate(1289,777)" d="m0 0 5 3 13 12 8 7 16 15 29 29 7 8 14 15 9 11 13 15 11 14 14 18 10 14 4 5 9 2 3 13 4 29 1 11 1 33-1 25-3 30-5 30-8 32-10 29-9 20-8 16-12 20-13 18-12 14-11 12-9 9-11 9-12 10-21 14-21 12-19 9-24 9-23 7-34 7-31 4-25 2-44 1-31-1-39-3-39-5-39-7-31-7-30-8-35-11-30-11-26-11-28-13-23-12-27-16-21-14-18-13-11-9-11-10-8-7-9-9-7-8-13-16-12-17-12-21-10-21-8-23 1-3 9 17 13 21 13 17 9 11 11 12 19 19 11 9 15 12 17 12 19 12 18 10 23 12 30 13 33 12 34 10 39 9 35 6 35 4 28 2h67l36-3 35-5 37-8 30-9 28-11 24-12 16-10 16-12 10-9 8-7 7-8 10-12 11-16 9-15 8-15 10-24 7-21 6-24 5-30 2-21v-50l-3-30-5-28-7-28-11-32-11-25-10-20-12-20-11-16-10-13z" fill="#E0E8EC"/>
<path transform="translate(913,440)" d="m0 0h6l-3 2-16 6-14 8-10 8-10 10-2 3-36 7-32 8-36 11-25 9-27 11-24 11-34 17-24 14-21 13-12 8-20 14-17 13-16 13-13 11-20 18-8 8-8 7-29 31-9 11-12 14-15 20-11 15-18 27-15 25-10 18-14 27-14 31-12 31-12 36-9 32-8 36-6 36-4 34-2 28v72l3 38 5 37 6 33 12 48 14 43 11 28 11 25 14 29 13 24 15 25 20 30 8 11 8 21 10 15 10 14 12 13 10 10 17 13 19 12 16 8 20 9 33 11 28 7 3 45 5 4 27 15 27 14 31 14 33 13 28 10 41 12 38 9 33 6 39 5 40 3h67l39-3 37-5 33-6 37-9 34-10 34-12 31-13 28-13 8-4 7 1 18 7 9 3v2l-22 12-26 13-25 11-28 11-31 11-42 12-30 7-32 6-37 5-36 3-23 1h-40l-38-2-38-4-43-7-40-9-32-9-36-12-36-14-28-13-16-8-27-14-22-13-22-14-16-11-18-13-14-11-16-13-14-12-24-22-28-28-7-8-10-11-9-11-11-13-15-20-13-18-14-21-13-21-13-23-12-23-15-31-15-37-12-34-10-34-9-38-7-38-4-31-3-35-1-23v-41l2-37 4-38 6-38 7-33 9-35 10-32 11-30 13-31 16-33 14-27 17-28 10-16 14-20 14-19 11-14 11-13 9-11 15-16 9-10 24-24 8-7 13-12 11-9 13-11 20-15 19-14 26-17 25-15 18-10 27-14 28-13 30-12 28-10 25-8 38-10 33-7 38-6z" fill="#FDFDFD"/>
<path transform="translate(957,454)" d="m0 0h12l21 2 21 5 19 7 19 10 12 9 10 9 9 11 3 5 2 1 2-4 10-10 14-10 13-6 7-2h18l11 4 9 6 7 6 10 13 10 19 8 22 5 20 3 22v22l-3 21-5 19-8 20-9 17-9-2-24-5-22-2-22 1-17 4-13 5-11 7-18 12-10 4-12 2h-9l-6-17-7-13-10-13-14-14-17-13-27-18-23-15-14-10-13-11-11-11-9-14-5-12-2-8v-21l5-19 7-14 7-9 4-5 10-8 14-8 16-6 12-3z" fill="#F01B1B"/>
<path transform="translate(888,943)" d="m0 0h10l10 3 9 6 9 9 8 13 8 16 15 33 8 15 9 10 8 7 23 14 9 7 6 9 2 5 1 8-2 8-4 6-10 17-12 18-5 8 2 16v36l-4 22-7 19-8 14-11 13-10 8-16 8-15 4h-19l-11-4-8-6-7-8-2-6-16 5-5 1h-17l-10-3-10-7-7-10-3-9-1-13 1-3-6-2-8-7-3-6v-9l6-23 15-48 11-44 5-21-18-1h-36l-17 3-12 4-3-1-2-7 1-18 4-16 5-12 7-12 7-9 9-10 13-11 15-10 16-9 19-8 19-6 25-5z" fill="#C31A25"/>
<path transform="translate(1210,540)" d="m0 0 21 18 21 14 18 10 23 11 24 9 20 6 24 5 23 2 23-1 20-4 14-5 16-8-2 5-8 15-5 15-2 9v26l4 15 8 16 11 14 7 7 16 12 16 9 16 6 19 4 10 1h17l22-3 12-3 3 1-7 9-7 15-3 11-1 14 2 13 5 13 9 10 12 6 7 2 14 1 14-2 12-5 10-7 4-3-3 9-7 14-10 14-11 12-9 8-14 9-16 7-13 3h-24l-19-4-15-6-13-7-12-9-11-10-9-11-10-14-11-21-4-10v-3l25 1 20-2 16-4 15-6 7-5-12 5-16 4-8 1h-22l-18-3-22-6-16-6-21-11-14-10-13-11-13-13-13-17-11-18-5-10v-3l19-9 16-10 13-10 12-11-18 12-21 11-19 7-17 4h-15l-26-4-24-7-23-10-17-10-5-5 4-20 1-9v-31l-3-20-6-23z" fill="#E0E8EC"/>
<path transform="translate(942,1440)" d="m0 0h1l-1 10-6 16-10 17-13 16-13 14-8 7-16 13-15 10-21 12-14 6-2 2 1 10v18l-4 13-7 10-7 7-11 7-14 6-19 5-16 3-2 7-3 11-5 9-7 7-12 6-12 3-11 1h-31l-32-3-28-5-28-7-26-9-24-11-17-10-14-10-11-9-16-16-11-15-8-14-6-13-3-7-4-21-1-8v-31l3-18h1l3 19 5 15 9 17 7 6 9 9 11 9 16 13 18 12 15 9 16 8 23 10 28 9 22 5 26 3h18l17-2 15-4 6-3 2-4-1-6-6-9 33-7 24-7 17-8 9-7 4-5 1-3v-8l-4-8-8-8 4-2 30-5 25-6 20-6 22-9 23-12 14-10 12-11 10-14 6-13z" fill="#E0E8EC"/>
<path transform="translate(889,952)" d="m0 0h8l9 3 10 9 7 9 11 21 16 36 8 14 9 10 8 7 19 12 10 7 7 7 2 5v10l-6 7-8 4-9 2h-17l-16-3-24-8-25-11-34-16-21-8-11-3-33-4h-38l-19 3-4 1v-13l4-15 5-12 7-11 11-13 11-10 17-12 23-12 19-7 17-5 17-3z" fill="#FFAF08"/>
<path transform="translate(1211,661)" d="m0 0 5 2 17 10 18 8 21 7 24 5 18 2 15 1 12 22 12 17 9 11 11 12 11 9 13 10 15 9 21 10 14 5 4 10 8 18 8 15 12 17 12 13 4 4-2 4-12 14-9 11-12 14-10 12h-2l-13-18-14-18-13-16-11-13-12-14-15-16-11-12-27-27-8-7-15-14-11-9-10-9-14-11-15-12-19-14-18-13-24-16-1-2 11-23z" fill="#FDFDFD"/>
<path transform="translate(698,1268)" d="m0 0 5 2 20 12 21 12 21 11 33 15 33 13 35 12 43 12 41 9 35 6 40 5 23 2 18 1h68l28-2h10l-5 5-24 14-19 9-24 9-23 7-27 6-27 4-24 2h-43l-2-2-2-9-5-10-9-9-16-8-16-4-21-2h-86l-15-9-16-12-13-11-18-18-11-14-10-15-10-19-8-21z" fill="#E0E8EC"/>
<path transform="translate(1474,1626)" d="m0 0 6 2 8 11 7 14 5 17 1 5v26l-4 17-7 17-12 10-13 8-19 9-21 6-22 3h-20l-18-2-23-5-24-8-20-9-25-13-12-9-12-11-7-8-13-15-12-16-13-18-16-24-1-3 4 2 10 8 18 12 18 10 17 8 24 9 24 7 31 6 18 2h42l20-3 15-4 15-6 11-7 10-9 7-12 3-13z" fill="#E0E8EC"/>
<path transform="translate(1661,1530)" d="m0 0 5 5 6 8 5 10 2 6 1 7 4 9 3 14 1 8v26l-4 20-6 15-6 11-8 10-8 9-17 13-19 10-19 7-21 6-29 5-21 2-24 1 5-21 1-8v-19l-3-17-5-15-8-15-3-5 23 4 10 1h20l21-3 21-7 16-9 14-11 8-8 12-16 10-18 8-19z" fill="#E0E8EC"/>
<path transform="translate(1113,921)" d="m0 0h17l15 3 13 5 12 7 11 9 9 9 9 14 5 14 2 9v24l-4 17-8 16-7 10-8 9-11 8-16 8-13 3h-18l-16-4-11-6-10-8-8-9-8-14-4-13-2-13v-11l2-14 5-15 7-13 7-9 4-5 14-11 15-7 11-3h-17l-18 4-16 6-17 9-5 2 6-7 10-8 14-8 13-5z" fill="#C11A24"/>
<path transform="translate(746,825)" d="m0 0h19l14 4 14 7 10 8 8 7 9 12 6 13 3 13v22l-4 16-5 12-7 11-9 10-10 8-14 7-12 3h-15l-12-3-11-6-10-9-7-10-5-10-3-11-1-7v-17l3-15 6-15 8-12 9-10 12-9 13-6 13-3-8-1h-9l-15 3-17 8-14 11-3 2 2-5 6-8 7-7 11-7 9-4z" fill="#C11A24"/>
<path transform="translate(1648,889)" d="m0 0 3 4 13 36 10 32 11 44 7 37 5 38 3 37 1 27v25l-2 43-4 39-6 38-7 34-5 20-6 2-26 1 10-41 7-37 5-38 2-23 1-18v-64l-3-40-5-38-6-32-7-30-8-29-12-36-5-13v-2l15-9z" fill="#FDFDFD"/>
<path transform="translate(1190,1098)" d="m0 0h21l11 3 16 8 11 10 9 14 4 11 2 10v13l-3 14-8 16-9 10-7 6-8 5-15 5-6 1h-15l-16-4-13-7-12-11-9-14-4-11-1-5v-22l3-11 7-14 9-10 8-7 14-7z" fill="#FC506F"/>
<path transform="translate(643,946)" d="m0 0 15 2 10 4 9 7 7 7 8 16 3 12v18l-4 16-6 12-7 9-8 8-14 8-10 3h-18l-10-3-12-7-7-7-8-13-4-13-1-7v-12l3-15 5-12 7-11 10-10 14-8 9-3z" fill="#FC506F"/>
<path transform="translate(1447,1455)" d="m0 0h28l6 2-1 4-10 4-27 10-22 11-19 12-16 13-20 18-17 17-12 9-5 2h-9l-6-4-12-18-10-12-11-9-14-9-3-3v-5l7-6 13-6 22-7 33-8 39-7 35-5z" fill="#E0E8EC"/>
<path transform="translate(835,1074)" d="m0 0 9 1-2 17-6 36-5 23-8 30-4 13v3h23l25-5 20-7 19-10 14-10 13-11 10-10 13-17 3-5 13 1h19l9-1-7 12-13 18-9 11-9 10-8 8-17 13-15 9-16 8-15 6-15 5-18 4-19 2h-10l-18-3-9-5-3-3-1-7 4-16 17-55 10-40z" fill="#FFAE08"/>
<path transform="translate(850,1077)" d="m0 0 15 5 36 17 28 12 23 8v4l-8 11-9 10-13 13-15 11-17 10-21 8-16 4-14 2h-13l1-7 9-32 7-34 6-39z" fill="#FF5740"/>
<path transform="translate(1426,794)" d="m0 0 10 3 11 4 4 10 8 18 8 15 12 17 12 13 4 4-2 4-12 14-9 11-12 14-10 12h-2l-13-18-14-18-13-16-11-13-12-14-8-9 6-7 7-7 7-8z" fill="#E0E8EC"/>
<path transform="translate(980,1165)" d="m0 0h2l1 9v30l-3 18-4 14-8 16-6 9-7 8-11 8-13 6-11 3h-16l-10-4-8-7-7-14-2-9v-22l24-8 20-9 14-8 17-12 14-12 8-8z" fill="#F01B1B"/>
<path transform="translate(1834,1444)" d="m0 0h1v21l-4 16-6 14-8 12-11 13-13 11-14 9-15 7-15 5-19 4-10 1h-25l-3-1-8-16-8-11-5-6 36-8 30-9 26-10 19-9 18-11 12-9 12-11z" fill="#E0E8EC"/>
<path transform="translate(991,371)" d="m0 0h1l1 23 4 15 7 14 8 10 11 11 14 9 17 8 13 4 18 3h24l20-4 12-5 11-6 7-5v3l-12 20-2 1h-10l-14 3-16 8-9 6-10 9-4-2-7-8-7-7-16-11-21-11-24-8-22-4-6-1-1-4v-27l4-20 6-18z" fill="#E0E8EC"/>
<path transform="translate(1112,944)" d="m0 0h13l8 4 7 7 3 7 1 5v8l-3 10-6 9-9 6-5 2h-12l-10-5-6-8-3-7v-14l4-10 7-8 8-5z" fill="#FDFDFD"/>
<path transform="translate(752,847)" d="m0 0h8l9 4 6 8 2 6v13l-4 10-6 7-9 5h-13l-9-6-5-9-1-5v-7l3-10 6-9 9-6z" fill="#FDFDFD"/>
<path transform="translate(512,1665)" d="m0 0 5 2 23 11 25 9 25 7 16 4 2 32v9l-5-2-22-15-19-14-14-11-13-11-11-9-12-11z" fill="#FDE32F"/>
<path transform="translate(1211,661)" d="m0 0 5 2 17 10 18 8 8 3-2 5-14 18-8 11-5-2-14-10-18-12-1-2 11-23z" fill="#E0E8EC"/>
<path transform="translate(864,1233)" d="m0 0h4l1 20 1 9-14 5-6 1h-12l-9-3-9-8-4-8-1-3v-11l21 1 22-2z" fill="#F01B1B"/>
<path transform="translate(883,962)" d="m0 0h10l8 3 2 3-1 4-5 3-58 12-16 6-21 11-19 12h-2l2-5 10-11 13-10 21-12 20-8 17-5z" fill="#FDE531"/>
<path transform="translate(1166,441)" d="m0 0h1l2 22 4 19-17-8-5-2 3-9 9-16 2-5z" fill="#E0E6EA"/>
<path transform="translate(899,1011)" d="m0 0 6 1 5 4 4 7-1 6-6 1-5-6-3-7z" fill="#C51922"/>
<path transform="translate(1163,445)" d="m0 0v3l-7 13h-3l2-5z" fill="#D52C3E"/>
</svg>

/* Fin public\SrPolForYouSinTitle.svg */

/* Inicio src\App.tsx */
// src/App.tsx
import React from 'react'
import { Navigate, Route, BrowserRouter as Router, Routes } from 'react-router-dom'
import MainLayout from './components/layout/MainLayout'
import PublicLayout from './components/layout/PublicLayout'
import GroupOrderPage from './components/menu/GroupOrderPage'
import { AppProvider } from './context/AppContext'
import { AuthProvider } from './context/AuthContext'
import { useAuth } from './hooks/useAuth'
import ContabilidadDetail from './pages/ContabilidadDetail'
import ContabilidadPage from './pages/ContabilidadPage'
import Dashboard from './pages/Dashboard'
import GestionMenu from './pages/GestionMenu'
import GestionUsuarios from './pages/GestionUsuarios'
import Login from './pages/Login'
import MenuPage from './pages/MenuPage'
import PedidosPage from './pages/PedidosPage'
import Perfil from './pages/Perfil'
import Success from './pages/Success'

// Componente para manejar el layout dinámicamente según autenticación
const DynamicLayoutRoute: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const { user, loading } = useAuth()

  if (loading) {
    return <div>Cargando...</div>
  }

  return user ? <MainLayout>{children}</MainLayout> : <PublicLayout>{children}</PublicLayout>
}

// Ruta pública: solo accesible para usuarios no autenticados
const PublicRoute: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const { user, loading } = useAuth()

  if (loading) {
    return <div>Cargando...</div>
  }

  return !user ? <PublicLayout>{children}</PublicLayout> : <Navigate to="/" />
}

// Ruta privada: solo accesible para usuarios autenticados con roles permitidos
const PrivateRoute: React.FC<{
  children: React.ReactNode
  allowedRoles?: string[]
}> = ({ children, allowedRoles }) => {
  const { user, loading, userRole } = useAuth()

  if (loading) {
    return <div>Cargando...</div>
  }

  if (!user) {
    return <Navigate to="/login" />
  }

  if (allowedRoles && !allowedRoles.includes(userRole || 'client')) {
    return <Navigate to="/" />
  }

  return <MainLayout>{children}</MainLayout>
}

const App: React.FC = () => {
  return (
    <AuthProvider>
      <AppProvider>
        <Router>
          <Routes>
            {/* Ruta pública: solo para no autenticados */}
            <Route
              path="/login"
              element={
                <PublicRoute>
                  <Login />
                </PublicRoute>
              }
            />

            {/* Rutas con layout dinámico: accesibles para ambos, con o sin autenticación */}
            <Route
              path="/menu"
              element={
                <DynamicLayoutRoute>
                  <MenuPage />
                </DynamicLayoutRoute>
              }
            />
            <Route
              path="/menu/:groupOrderId"
              element={
                <DynamicLayoutRoute>
                  <GroupOrderPage />
                </DynamicLayoutRoute>
              }
            />

            {/* Rutas privadas: solo para autenticados */}
            <Route
              path="/"
              element={
                <PrivateRoute>
                  <Dashboard />
                </PrivateRoute>
              }
            />
            <Route
              path="/success"
              element={
                <PrivateRoute>
                  <Success />
                </PrivateRoute>
              }
            />
            <Route
              path="/pedidos"
              element={
                <PrivateRoute>
                  <PedidosPage />
                </PrivateRoute>
              }
            />
            <Route
              path="/gestion-menu"
              element={
                <PrivateRoute allowedRoles={['admin', 'encargado']}>
                  <GestionMenu />
                </PrivateRoute>
              }
            />
            <Route
              path="/perfil"
              element={
                <PrivateRoute>
                  <Perfil />
                </PrivateRoute>
              }
            />
            <Route
              path="/gestion-usuarios"
              element={
                <PrivateRoute allowedRoles={['admin']}>
                  <GestionUsuarios />
                </PrivateRoute>
              }
            />
            <Route
              path="/contabilidad"
              element={
                <PrivateRoute allowedRoles={['admin', 'encargado']}>
                  <ContabilidadPage />
                </PrivateRoute>
              }
            />
            <Route
              path="/contabilidad/:id"
              element={
                <PrivateRoute allowedRoles={['admin', 'encargado']}>
                  <ContabilidadDetail />
                </PrivateRoute>
              }
            />

            {/* Redirección por defecto */}
            <Route path="*" element={<Navigate to="/" />} />
          </Routes>
        </Router>
      </AppProvider>
    </AuthProvider>
  )
}

export default App

/* Fin src\App.tsx */

/* Inicio src\assets\react.svg */
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
/* Fin src\assets\react.svg */

/* Inicio src\assets\SrPolForYouSinTitle.svg */
<?xml version="1.0" encoding="UTF-8"?>
<svg version="1.1" viewBox="0 0 2000 2000" width="2000" height="2000" xmlns="http://www.w3.org/2000/svg">
<path transform="translate(1096,273)" d="m0 0h16l21 3 21 6 18 8 16 9 20 15 5-2 16-8 14-6 21-7 24-5 18-2h29l23 3 24 6 25 10 15 8 12 8 13 10 15 14 9 10 12 16 11 19 10 21 8 24 3 12 8 2 29 6 28 8 25 10 20 10 15 10 10 8 10 9 11 12 9 13 10 19 7 21 3 15 1 9v30l-4 27-7 26-8 21-4 9 2 4 8 14 6 14 4 16 1 8v25l-3 18-6 20-8 18-1 2 15 37 12 34 10 33 10 40 8 42 5 37 3 33 1 18v68l-3 42-5 40-6 34-8 36-1 2 15 1 23 4 20 6 19 8 16 10 13 11 7 7 10 14 7 15 4 14 2 16-1 17-4 17-5 13-8 15-9 12-9 10-12 11-17 12-17 9-18 6-26 5-24 2 2 14v32l-4 21-7 19-7 13-8 11-9 10-8 8-14 10-17 10-19 8-18 6-26 6-29 4-43 3-15 12-17 10-20 8-17 5-16 3-10 1-18 11-19 12-25 14-29 15-28 13-37 15-34 12-34 10-36 9-36 7-42 6-32 3-17 1h-76l-40-3-39-5-39-7-39-9-31-9-36-12-26-10-28-12-29-14-29-15-22-13-19-12-21-14-18-13-21-16-11-9-13-11-10-9-8-7-13-12-31-31-7-8-11-12-9-11-14-17-15-20-13-18-12-18-12-19-14-24-13-24-13-26-14-32-13-34-12-36-10-36-8-35-7-41-4-32-3-40v-76l3-40 5-39 7-39 8-35 10-35 12-36 14-36 16-35 14-28 13-23 12-20 24-36 13-18 14-18 9-11 11-13 9-10 7-8 15-16 24-24 8-7 13-12 11-9 13-11 17-13 16-12 20-14 25-16 22-13 22-12 23-12 35-16 36-14 38-13 36-10 34-8 39-7 40-5 42-3h15l4-16 9-21 10-17 10-13 11-12 11-10 14-10 19-10 21-7 15-3z" fill="#C11A25"/>
<path transform="translate(685,1266)" d="m0 0 15 2 23 14 21 12 21 11 33 15 33 13 35 12 43 12 41 9 35 6 40 5 23 2 18 1h68l28-2 32-4 31-6 25-7 9-3 3-3 9 6 5 6 14 11 14 9 20 10-2 4-8 6-16 8-15 4-16 2-20 1 12 3 8 1h14l16-3 14-5 11-7 7-6h2l2-4 2-2v-6l-20-9-20-11-6-4 2-1 21 7 22 5 28 4 28 2h52l36-2 54-5 85-9 38-3 21-1h32l26 2 22 4 20 6 16 8 14 9 10 9 9 12 6 12 4 15v22l-4 16-6 14-8 12-11 13-13 11-14 9-15 7-15 5-19 4-10 1h-25l-3-1-8-16-8-11-9-9-14-10-21-11-25-9-28-7-24-4-21-2 31 6 25 7 20 7 25 12 12 8 11 9 7 7 7 10 5 10 2 6 1 7 4 9 3 14 1 8v26l-4 20-6 15-6 11-8 10-8 9-17 13-19 10-19 7-21 6-29 5-21 2-24 1 5-21 1-8v-19l-3-17-5-15-8-15-11-14-11-11-16-11-17-9-21-7-14-3-17-2h-8l21 3 19 5 19 8 14 8 14 11 10 10 10 14 7 14 5 17 1 5v26l-4 17-7 17-12 10-13 8-19 9-21 6-22 3h-20l-18-2-23-5-24-8-20-9-25-13-12-9-12-11-7-8-13-15-12-16-13-18-16-24-16-25-14-22-11-17-3-4 7 20 14 29 14 24 12 19 14 21 13 18 11 14 9 10 7 8 12 11 14 9 22 12-3 3-32 15-34 14-41 14-36 10-37 8-37 6-37 4-39 2h-33l-38-2-38-4-37-6-41-9-35-10-38-13-32-13-28-13-22-11-23-13-4-3-2-19-1-26 2-1 28 3h48l16-3 12-5 11-8 6-8 5-10 3-11 24-5 16-6 13-7 11-9 8-11 5-10 3-14v-20l19-10 17-10 19-14 15-13 14-14 11-14 7-10 9-16 5-14 2-11v-11l-2-9-5-10-9-9-16-8-16-4-21-2h-76l-68 3-74 5-81 7-59 6-6 2-1 1v7h13l82-8 73-6 63-4 43-2 39-1h33l27 1 19 3 13 5 9 6 5 6 4 10v14l-4 14-8 16-9 13-9 11-13 14-8 7-16 13-15 10-21 12-14 6-2 2 1 10v18l-4 13-7 10-7 7-11 7-14 6-19 5-16 3-2 7-3 11-5 9-7 7-12 6-12 3-11 1h-31l-32-3-28-5-28-7-26-9-24-11-17-10-14-10-11-9-16-16-11-15-8-14-6-13-3-7-4-21-1-8v-31l3-19 6-20 8-18 8-14 12-16 12-14 7-7 8-7 15-12 21-14 21-12 27-13 25-10 4 2 10 7 16 8 17 5 7 2-6 12-7 12v6l8 3 12 2h29l15-3 10-4 7-5-34 4h-18l-14-2-3-1 2-5 13-22-1-5-5-2-20-4-15-6-12-7-9-8-2-4 18-5 18-8 14-8 13-10z" fill="#FCFCFC"/>
<path transform="translate(898,614)" d="m0 0 4 2 29 19 27 18 12 9 14 12 7 7 9 12 8 16 4 13 3 3 3 1h16l16-4 11-6 19-13 15-7 12-3 7-1h29l24 4 21 5 33 22 18 13 17 13 14 11 13 11 11 9 13 12 8 7 16 15 29 29 7 8 14 15 9 11 13 15 11 14 14 18 10 14 4 5 9 2 3 13 4 29 1 11 1 33-1 25-3 30-5 30-8 32-10 29-9 20-8 16-12 20-13 18-12 14-11 12-9 9-11 9-12 10-21 14-21 12-19 9-24 9-23 7-34 7-31 4-25 2-44 1-31-1-39-3-39-5-39-7-31-7-30-8-35-11-30-11-26-11-28-13-23-12-27-16-21-14-18-13-11-9-11-10-8-7-9-9-7-8-13-16-12-17-12-21-10-21-10-30-5-25-1-8v-34l3-18 5-17 10-22 11-18 11-14 32-32 10-15 9-19 14-38 10-23 12-25 12-21 14-21 9-12 9-11 9-10 7-8 13-13 8-7 16-13 16-11 13-8 18-10 19-9 24-9z" fill="#FCFCFC"/>
<path transform="translate(913,440)" d="m0 0h6l-3 2-16 6-14 8-10 8-10 10-9 14-7 15-5 21v24l4 16 6 14 10 14 6 6v2l-27 11-23 11-17 10-18 12-17 13-15 13-24 24-9 11-12 15-16 24-14 24-14 28-12 29-14 38-9 17-9 11-31 31-11 15-11 19-9 19-6 18-4 22-1 11v24l3 25 6 25 6 18 10 23 11 21 14 21 10 13 11 13 14 15 14 13 11 9 10 8-2 4-14 11-16 9-15 6-19 5-9 3-4 6v10l-27 12-24 12-23 14-19 14-13 11-13 12-10 11-12 16-12 20-8 17-6 18-5 25-1 11v22l3 24 6 24 6 15 10 15 10 14 12 13 10 10 17 13 19 12 16 8 20 9 33 11 28 7 3 45 5 4 27 15 27 14 31 14 33 13 28 10 41 12 38 9 33 6 39 5 40 3h67l39-3 37-5 33-6 37-9 34-10 34-12 31-13 28-13 8-4 7 1 18 7 9 3v2l-22 12-26 13-25 11-28 11-31 11-42 12-30 7-32 6-37 5-36 3-23 1h-40l-38-2-38-4-43-7-40-9-32-9-36-12-36-14-28-13-16-8-27-14-22-13-22-14-16-11-18-13-14-11-16-13-14-12-24-22-28-28-7-8-10-11-9-11-11-13-15-20-13-18-14-21-13-21-13-23-12-23-15-31-15-37-12-34-10-34-9-38-7-38-4-31-3-35-1-23v-41l2-37 4-38 6-38 7-33 9-35 10-32 11-30 13-31 16-33 14-27 17-28 10-16 14-20 14-19 11-14 11-13 9-11 15-16 9-10 24-24 8-7 13-12 11-9 13-11 20-15 19-14 26-17 25-15 18-10 27-14 28-13 30-12 28-10 25-8 38-10 33-7 38-6z" fill="#FDE430"/>
<path transform="translate(1096,295)" d="m0 0h17l19 3 16 5 16 7 14 8 14 10 7 6-2 4-11 15-9 16-1 4 7-9 17-17 17-12 23-12 21-8 23-6 22-3h30l22 3 25 7 18 8 15 8 14 10 10 9 8 7 12 14 11 16 10 18 8 19 7 23 3 17 29 5 27 6 23 7 24 10 17 9 14 10 14 12 10 11 10 15 7 15 5 16 3 18v30l-4 25-7 25-10 25-4 8v6l10 13 8 16 4 14 1 6v27l-4 20-6 16-8 16-10 14-11 12-9 8-14 9-16 7-13 3h-24l-19-4-15-6-13-7-12-9-11-10-9-11-10-14-11-21-4-10v-3l25 1 20-2 16-4 15-6 7-5-12 5-16 4-8 1h-22l-18-3-22-6-16-6-21-11-14-10-13-11-13-13-13-17-11-18-5-10v-3l19-9 16-10 13-10 12-11-18 12-21 11-19 7-17 4h-15l-26-4-24-7-23-10-17-10-5-5 4-20 1-9v-31l-3-20-6-23-8-21-9-17-8-11-9-10-10-7-11-5-5-2 3-9 9-16-4 4-12 20-2 1h-10l-14 3-16 8-9 6-10 9-4-2-7-8-7-7-16-11-21-11-24-8-22-4-6-1-1-4v-27l4-20 6-18 12-23 10-13 11-12 9-8 10-7 14-8 19-7 14-3z" fill="#FCFCFC"/>
<path transform="translate(1648,889)" d="m0 0 3 4 13 36 10 32 11 44 7 37 5 38 3 37 1 27v25l-2 43-4 39-6 38-7 34-5 20-6 2-31 2-54 5-85 9-40 3-20 1h-50l-36-3-28-5-24-7-4-2 4-3 23-13 19-13 14-11 11-10 8-7 10-10 7-8 13-16 16-24 12-21 9-19 10-26 8-26 6-26 5-31 3-35v-49l-3-31-5-29 1-4 9-11 13-15 11-13 1-2 6 2 10 6 15 6 14 4 10 2 10 1h15l18-3 15-5 16-8z" fill="#FDE430"/>
<path transform="translate(1289,777)" d="m0 0 5 3 13 12 8 7 16 15 29 29 7 8 14 15 9 11 13 15 11 14 14 18 10 14 4 5 9 2 3 13 4 29 1 11 1 33-1 25-3 30-5 30-8 32-10 29-9 20-8 16-12 20-13 18-12 14-11 12-9 9-11 9-12 10-21 14-21 12-19 9-24 9-23 7-34 7-31 4-25 2-44 1-31-1-39-3-39-5-39-7-31-7-30-8-35-11-30-11-26-11-28-13-23-12-27-16-21-14-18-13-11-9-11-10-8-7-9-9-7-8-13-16-12-17-12-21-10-21-8-23 1-3 9 17 13 21 13 17 9 11 11 12 19 19 11 9 15 12 17 12 19 12 18 10 23 12 30 13 33 12 34 10 39 9 35 6 35 4 28 2h67l36-3 35-5 37-8 30-9 28-11 24-12 16-10 16-12 10-9 8-7 7-8 10-12 11-16 9-15 8-15 10-24 7-21 6-24 5-30 2-21v-50l-3-30-5-28-7-28-11-32-11-25-10-20-12-20-11-16-10-13z" fill="#E0E8EC"/>
<path transform="translate(913,440)" d="m0 0h6l-3 2-16 6-14 8-10 8-10 10-2 3-36 7-32 8-36 11-25 9-27 11-24 11-34 17-24 14-21 13-12 8-20 14-17 13-16 13-13 11-20 18-8 8-8 7-29 31-9 11-12 14-15 20-11 15-18 27-15 25-10 18-14 27-14 31-12 31-12 36-9 32-8 36-6 36-4 34-2 28v72l3 38 5 37 6 33 12 48 14 43 11 28 11 25 14 29 13 24 15 25 20 30 8 11 8 21 10 15 10 14 12 13 10 10 17 13 19 12 16 8 20 9 33 11 28 7 3 45 5 4 27 15 27 14 31 14 33 13 28 10 41 12 38 9 33 6 39 5 40 3h67l39-3 37-5 33-6 37-9 34-10 34-12 31-13 28-13 8-4 7 1 18 7 9 3v2l-22 12-26 13-25 11-28 11-31 11-42 12-30 7-32 6-37 5-36 3-23 1h-40l-38-2-38-4-43-7-40-9-32-9-36-12-36-14-28-13-16-8-27-14-22-13-22-14-16-11-18-13-14-11-16-13-14-12-24-22-28-28-7-8-10-11-9-11-11-13-15-20-13-18-14-21-13-21-13-23-12-23-15-31-15-37-12-34-10-34-9-38-7-38-4-31-3-35-1-23v-41l2-37 4-38 6-38 7-33 9-35 10-32 11-30 13-31 16-33 14-27 17-28 10-16 14-20 14-19 11-14 11-13 9-11 15-16 9-10 24-24 8-7 13-12 11-9 13-11 20-15 19-14 26-17 25-15 18-10 27-14 28-13 30-12 28-10 25-8 38-10 33-7 38-6z" fill="#FDFDFD"/>
<path transform="translate(957,454)" d="m0 0h12l21 2 21 5 19 7 19 10 12 9 10 9 9 11 3 5 2 1 2-4 10-10 14-10 13-6 7-2h18l11 4 9 6 7 6 10 13 10 19 8 22 5 20 3 22v22l-3 21-5 19-8 20-9 17-9-2-24-5-22-2-22 1-17 4-13 5-11 7-18 12-10 4-12 2h-9l-6-17-7-13-10-13-14-14-17-13-27-18-23-15-14-10-13-11-11-11-9-14-5-12-2-8v-21l5-19 7-14 7-9 4-5 10-8 14-8 16-6 12-3z" fill="#F01B1B"/>
<path transform="translate(888,943)" d="m0 0h10l10 3 9 6 9 9 8 13 8 16 15 33 8 15 9 10 8 7 23 14 9 7 6 9 2 5 1 8-2 8-4 6-10 17-12 18-5 8 2 16v36l-4 22-7 19-8 14-11 13-10 8-16 8-15 4h-19l-11-4-8-6-7-8-2-6-16 5-5 1h-17l-10-3-10-7-7-10-3-9-1-13 1-3-6-2-8-7-3-6v-9l6-23 15-48 11-44 5-21-18-1h-36l-17 3-12 4-3-1-2-7 1-18 4-16 5-12 7-12 7-9 9-10 13-11 15-10 16-9 19-8 19-6 25-5z" fill="#C31A25"/>
<path transform="translate(1210,540)" d="m0 0 21 18 21 14 18 10 23 11 24 9 20 6 24 5 23 2 23-1 20-4 14-5 16-8-2 5-8 15-5 15-2 9v26l4 15 8 16 11 14 7 7 16 12 16 9 16 6 19 4 10 1h17l22-3 12-3 3 1-7 9-7 15-3 11-1 14 2 13 5 13 9 10 12 6 7 2 14 1 14-2 12-5 10-7 4-3-3 9-7 14-10 14-11 12-9 8-14 9-16 7-13 3h-24l-19-4-15-6-13-7-12-9-11-10-9-11-10-14-11-21-4-10v-3l25 1 20-2 16-4 15-6 7-5-12 5-16 4-8 1h-22l-18-3-22-6-16-6-21-11-14-10-13-11-13-13-13-17-11-18-5-10v-3l19-9 16-10 13-10 12-11-18 12-21 11-19 7-17 4h-15l-26-4-24-7-23-10-17-10-5-5 4-20 1-9v-31l-3-20-6-23z" fill="#E0E8EC"/>
<path transform="translate(942,1440)" d="m0 0h1l-1 10-6 16-10 17-13 16-13 14-8 7-16 13-15 10-21 12-14 6-2 2 1 10v18l-4 13-7 10-7 7-11 7-14 6-19 5-16 3-2 7-3 11-5 9-7 7-12 6-12 3-11 1h-31l-32-3-28-5-28-7-26-9-24-11-17-10-14-10-11-9-16-16-11-15-8-14-6-13-3-7-4-21-1-8v-31l3-18h1l3 19 5 15 9 17 7 6 9 9 11 9 16 13 18 12 15 9 16 8 23 10 28 9 22 5 26 3h18l17-2 15-4 6-3 2-4-1-6-6-9 33-7 24-7 17-8 9-7 4-5 1-3v-8l-4-8-8-8 4-2 30-5 25-6 20-6 22-9 23-12 14-10 12-11 10-14 6-13z" fill="#E0E8EC"/>
<path transform="translate(889,952)" d="m0 0h8l9 3 10 9 7 9 11 21 16 36 8 14 9 10 8 7 19 12 10 7 7 7 2 5v10l-6 7-8 4-9 2h-17l-16-3-24-8-25-11-34-16-21-8-11-3-33-4h-38l-19 3-4 1v-13l4-15 5-12 7-11 11-13 11-10 17-12 23-12 19-7 17-5 17-3z" fill="#FFAF08"/>
<path transform="translate(1211,661)" d="m0 0 5 2 17 10 18 8 21 7 24 5 18 2 15 1 12 22 12 17 9 11 11 12 11 9 13 10 15 9 21 10 14 5 4 10 8 18 8 15 12 17 12 13 4 4-2 4-12 14-9 11-12 14-10 12h-2l-13-18-14-18-13-16-11-13-12-14-15-16-11-12-27-27-8-7-15-14-11-9-10-9-14-11-15-12-19-14-18-13-24-16-1-2 11-23z" fill="#FDFDFD"/>
<path transform="translate(698,1268)" d="m0 0 5 2 20 12 21 12 21 11 33 15 33 13 35 12 43 12 41 9 35 6 40 5 23 2 18 1h68l28-2h10l-5 5-24 14-19 9-24 9-23 7-27 6-27 4-24 2h-43l-2-2-2-9-5-10-9-9-16-8-16-4-21-2h-86l-15-9-16-12-13-11-18-18-11-14-10-15-10-19-8-21z" fill="#E0E8EC"/>
<path transform="translate(1474,1626)" d="m0 0 6 2 8 11 7 14 5 17 1 5v26l-4 17-7 17-12 10-13 8-19 9-21 6-22 3h-20l-18-2-23-5-24-8-20-9-25-13-12-9-12-11-7-8-13-15-12-16-13-18-16-24-1-3 4 2 10 8 18 12 18 10 17 8 24 9 24 7 31 6 18 2h42l20-3 15-4 15-6 11-7 10-9 7-12 3-13z" fill="#E0E8EC"/>
<path transform="translate(1661,1530)" d="m0 0 5 5 6 8 5 10 2 6 1 7 4 9 3 14 1 8v26l-4 20-6 15-6 11-8 10-8 9-17 13-19 10-19 7-21 6-29 5-21 2-24 1 5-21 1-8v-19l-3-17-5-15-8-15-3-5 23 4 10 1h20l21-3 21-7 16-9 14-11 8-8 12-16 10-18 8-19z" fill="#E0E8EC"/>
<path transform="translate(1113,921)" d="m0 0h17l15 3 13 5 12 7 11 9 9 9 9 14 5 14 2 9v24l-4 17-8 16-7 10-8 9-11 8-16 8-13 3h-18l-16-4-11-6-10-8-8-9-8-14-4-13-2-13v-11l2-14 5-15 7-13 7-9 4-5 14-11 15-7 11-3h-17l-18 4-16 6-17 9-5 2 6-7 10-8 14-8 13-5z" fill="#C11A24"/>
<path transform="translate(746,825)" d="m0 0h19l14 4 14 7 10 8 8 7 9 12 6 13 3 13v22l-4 16-5 12-7 11-9 10-10 8-14 7-12 3h-15l-12-3-11-6-10-9-7-10-5-10-3-11-1-7v-17l3-15 6-15 8-12 9-10 12-9 13-6 13-3-8-1h-9l-15 3-17 8-14 11-3 2 2-5 6-8 7-7 11-7 9-4z" fill="#C11A24"/>
<path transform="translate(1648,889)" d="m0 0 3 4 13 36 10 32 11 44 7 37 5 38 3 37 1 27v25l-2 43-4 39-6 38-7 34-5 20-6 2-26 1 10-41 7-37 5-38 2-23 1-18v-64l-3-40-5-38-6-32-7-30-8-29-12-36-5-13v-2l15-9z" fill="#FDFDFD"/>
<path transform="translate(1190,1098)" d="m0 0h21l11 3 16 8 11 10 9 14 4 11 2 10v13l-3 14-8 16-9 10-7 6-8 5-15 5-6 1h-15l-16-4-13-7-12-11-9-14-4-11-1-5v-22l3-11 7-14 9-10 8-7 14-7z" fill="#FC506F"/>
<path transform="translate(643,946)" d="m0 0 15 2 10 4 9 7 7 7 8 16 3 12v18l-4 16-6 12-7 9-8 8-14 8-10 3h-18l-10-3-12-7-7-7-8-13-4-13-1-7v-12l3-15 5-12 7-11 10-10 14-8 9-3z" fill="#FC506F"/>
<path transform="translate(1447,1455)" d="m0 0h28l6 2-1 4-10 4-27 10-22 11-19 12-16 13-20 18-17 17-12 9-5 2h-9l-6-4-12-18-10-12-11-9-14-9-3-3v-5l7-6 13-6 22-7 33-8 39-7 35-5z" fill="#E0E8EC"/>
<path transform="translate(835,1074)" d="m0 0 9 1-2 17-6 36-5 23-8 30-4 13v3h23l25-5 20-7 19-10 14-10 13-11 10-10 13-17 3-5 13 1h19l9-1-7 12-13 18-9 11-9 10-8 8-17 13-15 9-16 8-15 6-15 5-18 4-19 2h-10l-18-3-9-5-3-3-1-7 4-16 17-55 10-40z" fill="#FFAE08"/>
<path transform="translate(850,1077)" d="m0 0 15 5 36 17 28 12 23 8v4l-8 11-9 10-13 13-15 11-17 10-21 8-16 4-14 2h-13l1-7 9-32 7-34 6-39z" fill="#FF5740"/>
<path transform="translate(1426,794)" d="m0 0 10 3 11 4 4 10 8 18 8 15 12 17 12 13 4 4-2 4-12 14-9 11-12 14-10 12h-2l-13-18-14-18-13-16-11-13-12-14-8-9 6-7 7-7 7-8z" fill="#E0E8EC"/>
<path transform="translate(980,1165)" d="m0 0h2l1 9v30l-3 18-4 14-8 16-6 9-7 8-11 8-13 6-11 3h-16l-10-4-8-7-7-14-2-9v-22l24-8 20-9 14-8 17-12 14-12 8-8z" fill="#F01B1B"/>
<path transform="translate(1834,1444)" d="m0 0h1v21l-4 16-6 14-8 12-11 13-13 11-14 9-15 7-15 5-19 4-10 1h-25l-3-1-8-16-8-11-5-6 36-8 30-9 26-10 19-9 18-11 12-9 12-11z" fill="#E0E8EC"/>
<path transform="translate(991,371)" d="m0 0h1l1 23 4 15 7 14 8 10 11 11 14 9 17 8 13 4 18 3h24l20-4 12-5 11-6 7-5v3l-12 20-2 1h-10l-14 3-16 8-9 6-10 9-4-2-7-8-7-7-16-11-21-11-24-8-22-4-6-1-1-4v-27l4-20 6-18z" fill="#E0E8EC"/>
<path transform="translate(1112,944)" d="m0 0h13l8 4 7 7 3 7 1 5v8l-3 10-6 9-9 6-5 2h-12l-10-5-6-8-3-7v-14l4-10 7-8 8-5z" fill="#FDFDFD"/>
<path transform="translate(752,847)" d="m0 0h8l9 4 6 8 2 6v13l-4 10-6 7-9 5h-13l-9-6-5-9-1-5v-7l3-10 6-9 9-6z" fill="#FDFDFD"/>
<path transform="translate(512,1665)" d="m0 0 5 2 23 11 25 9 25 7 16 4 2 32v9l-5-2-22-15-19-14-14-11-13-11-11-9-12-11z" fill="#FDE32F"/>
<path transform="translate(1211,661)" d="m0 0 5 2 17 10 18 8 8 3-2 5-14 18-8 11-5-2-14-10-18-12-1-2 11-23z" fill="#E0E8EC"/>
<path transform="translate(864,1233)" d="m0 0h4l1 20 1 9-14 5-6 1h-12l-9-3-9-8-4-8-1-3v-11l21 1 22-2z" fill="#F01B1B"/>
<path transform="translate(883,962)" d="m0 0h10l8 3 2 3-1 4-5 3-58 12-16 6-21 11-19 12h-2l2-5 10-11 13-10 21-12 20-8 17-5z" fill="#FDE531"/>
<path transform="translate(1166,441)" d="m0 0h1l2 22 4 19-17-8-5-2 3-9 9-16 2-5z" fill="#E0E6EA"/>
<path transform="translate(899,1011)" d="m0 0 6 1 5 4 4 7-1 6-6 1-5-6-3-7z" fill="#C51922"/>
<path transform="translate(1163,445)" d="m0 0v3l-7 13h-3l2-5z" fill="#D52C3E"/>
</svg>

/* Fin src\assets\SrPolForYouSinTitle.svg */

/* Inicio src\components\auth\LoginForm.tsx */
// src/components/auth/LoginForm.tsx
import React, { useState } from 'react'
import { useAuth } from '../../hooks/useAuth'
import '../../styles/authForm.css' // Importa el archivo CSS específico para los formularios de autenticación

const LoginForm: React.FC = () => {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [error, setError] = useState<string | null>(null)
  const { login } = useAuth()

  const handleSubmit = async (event: React.FormEvent) => {
    event.preventDefault()
    setError(null)
    try {
      await login(email, password)
    } catch (err) {
      setError((err as { message: string }).message)
      setTimeout(() => setError(null), 5000)
    }
  }

  return (
    <form onSubmit={handleSubmit} className="auth-form">
      <div className="form-group">
        <label htmlFor="email">Correo electrónico</label>
        <input
          type="email"
          id="email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          required
        />
      </div>
      <div className="form-group">
        <label htmlFor="password">Contraseña</label>
        <input
          type="password"
          id="password"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
          required
        />
      </div>
      {error && (
        <div className="error-message">
          <p>Error: {error}</p>
        </div>
      )}
      <button type="submit" className="auth-button">
        Iniciar Sesión
      </button>
    </form>
  )
}

export default LoginForm

/* Fin src\components\auth\LoginForm.tsx */

/* Inicio src\components\auth\RegisterForm.tsx */
// src/components/auth/RegisterForm.tsx
import React, { useState } from 'react'
import { useAuth } from '../../hooks/useAuth'
import '../../styles/authForm.css' // Importa el archivo CSS específico para los formularios de autenticación

const RegisterForm: React.FC = () => {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [error, setError] = useState<string | null>(null)
  const { register } = useAuth()

  const handleSubmit = async (event: React.FormEvent) => {
    event.preventDefault()
    setError(null)
    try {
      await register(email, password)
    } catch (err) {
      setError((err as { message: string }).message)
      setTimeout(() => setError(null), 5000)
    }
  }

  return (
    <form onSubmit={handleSubmit} className="auth-form">
      <div className="form-group">
        <label htmlFor="email">Correo electrónico</label>
        <input
          type="email"
          id="email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          required
        />
      </div>
      <div className="form-group">
        <label htmlFor="password">Contraseña</label>
        <input
          type="password"
          id="password"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
          required
        />
      </div>
      {error && (
        <div className="error-message">
          <p>Error: {error}</p>
        </div>
      )}
      <button type="submit" className="auth-button">
        Registrarse
      </button>
    </form>
  )
}

export default RegisterForm

/* Fin src\components\auth\RegisterForm.tsx */

/* Inicio src\components\forms\MenuForm.tsx */
/* Inicio src\components\forms\MenuForm.tsx */
import React, { useState } from "react";
import { MenuItem } from "../../context/AppContext";
import { useMenu } from "../../hooks/useMenu";

interface MenuFormProps {
  initialValues?: Partial<MenuItem>;
  onSubmit: (values: Partial<MenuItem>) => void;
  onClose: () => void; // Add onClose prop
}

const MenuForm: React.FC<MenuFormProps> = ({
  initialValues,
  onSubmit,
  onClose,
}) => {
  const { loading } = useMenu();
  const [name, setName] = useState(initialValues?.name || "");
  const [description, setDescription] = useState(
    initialValues?.description || ""
  );
  const [price, setPrice] = useState(initialValues?.price || 0);
  const [imageUrl, setImageUrl] = useState(initialValues?.imageUrl || "");
  const [recommendation, setRecommendation] = useState(
    initialValues?.recommendation || ""
  );
  const [observations, setObservations] = useState(
    initialValues?.observations || ""
  );
  const [available, setAvailable] = useState(
    initialValues?.available !== undefined ? initialValues.available : true
  );
  // Nuevo estado para el estado de disponibilidad
  const [availabilityStatus, setAvailabilityStatus] = useState<
    "disponible" | "noDisponibleMomento" | "noDisponibleLargoPlazo"
  >(initialValues?.availabilityStatus || "disponible");

  const handleSubmit = (event: React.FormEvent) => {
    event.preventDefault();
    onSubmit({
      name,
      description,
      price,
      imageUrl,
      available,
      recommendation,
      observations,
      availabilityStatus, // Incluir el nuevo estado en los valores enviados
    });
    onClose(); // Close modal on submit
  };

  if (loading) {
    return <div>Cargando...</div>;
  }

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      {" "}
      {/* Formulario con espaciado vertical */}
      <div className="grid grid-cols-1 gap-4">
        {" "}
        {/* Grid para los campos */}
        <div>
          <label
            htmlFor="name"
            className="block text-sm font-medium text-gray-700"
          >
            Nombre del Item
          </label>
          <input
            type="text"
            id="name"
            value={name}
            onChange={(e) => setName(e.target.value)}
            required
            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          />
        </div>
        <div>
          <label
            htmlFor="description"
            className="block text-sm font-medium text-gray-700"
          >
            Descripción
          </label>
          <textarea /* Usamos textarea para la descripción */
            id="description"
            value={description}
            onChange={(e) => setDescription(e.target.value)}
            required
            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          />
        </div>
        <div>
          <label
            htmlFor="price"
            className="block text-sm font-medium text-gray-700"
          >
            Precio
          </label>
          <input
            type="number"
            id="price"
            value={price}
            onChange={(e) => setPrice(Number(e.target.value))}
            required
            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          />
        </div>
        <div>
          <label
            htmlFor="imageUrl"
            className="block text-sm font-medium text-gray-700"
          >
            URL de Imagen
          </label>
          <input
            type="url"
            id="imageUrl"
            value={imageUrl}
            onChange={(e) => setImageUrl(e.target.value)}
            required
            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          />
        </div>
        <div>
          <label
            htmlFor="recommendation"
            className="block text-sm font-medium text-gray-700"
          >
            Recomendaciones (Opcional)
          </label>
          <input
            type="text"
            id="recommendation"
            value={recommendation}
            onChange={(e) => setRecommendation(e.target.value)}
            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          />
        </div>
        <div>
          <label
            htmlFor="observations"
            className="block text-sm font-medium text-gray-700"
          >
            Observaciones (Opcional)
          </label>
          <input
            type="text"
            id="observations"
            value={observations}
            onChange={(e) => setObservations(e.target.value)}
            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          />
        </div>
        {/* Nuevo campo para el estado de disponibilidad */}
        <div>
          <label
            htmlFor="availabilityStatus"
            className="block text-sm font-medium text-gray-700"
          >
            Estado de Disponibilidad
          </label>
          <select
            id="availabilityStatus"
            value={availabilityStatus}
            onChange={(e) =>
              setAvailabilityStatus(
                e.target.value as
                  | "disponible"
                  | "noDisponibleMomento"
                  | "noDisponibleLargoPlazo"
              )
            }
            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          >
            <option value="disponible">Disponible</option>
            <option value="noDisponibleMomento">
              No disponible en el momento
            </option>
            <option value="noDisponibleLargoPlazo">Ya no disponible</option>
          </select>
        </div>
      </div>
      <div className="flex items-center justify-between mt-4">
        {" "}
        {/* Contenedor para checkbox y botones */}
        <div className="flex items-center">
          <input
            type="checkbox"
            id="available"
            className="form-checkbox h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
            checked={available}
            onChange={(e) => setAvailable(e.target.checked)}
          />
          <label htmlFor="available" className="ml-2 text-sm text-gray-700">
            Disponible (Visible en Menu)
          </label>
        </div>
        <div className="space-x-2">
          <button
            className="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
            onClick={onClose}
            type="button" /* Importante: type="button" para evitar submit del form al cancelar */
          >
            Cancelar
          </button>
          <button
            type="submit"
            className="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
          >
            {initialValues?.id ? "Guardar" : "Agregar"}
          </button>
        </div>
      </div>
    </form>
  );
};

export default MenuForm;

/* Fin src\components\forms\MenuForm.tsx */

/* Inicio src\components\forms\PedidoForm.tsx */
/* eslint-disable @typescript-eslint/no-misused-promises */
/* src/components/pedidos/PedidoForm.tsx */
import { Timestamp, addDoc, collection } from 'firebase/firestore'
import React, { useEffect, useState } from 'react'
import { v4 as uuidv4 } from 'uuid'
import { useAuth } from '../../hooks/useAuth'
import { useMenu } from '../../hooks/useMenu'
import { db } from '../../utils/firebase'

interface Person {
  personIndex: number
  userId: string | null
  name: string
  items: { id: string; quantity: number }[]
  locked?: boolean
  finished?: boolean
}

interface SharedOrderItem {
  itemId: string
  quantity: number
  personIds: string[]
}

interface PedidoFormProps {
  onClose: () => void
  people?: Person[]
  sharedOrderItems?: SharedOrderItem[]
}

const PedidoForm: React.FC<PedidoFormProps> = ({ onClose, people, sharedOrderItems }) => {
  const { menu } = useMenu()
  const { user, addPoints } = useAuth()
  const [items, setItems] = useState<
    {
      id: string
      quantity: number
      assignedTo: string
    }[]
  >([])

  const [peopleOrder, setPeopleOrder] = useState<{ userId: string | null; name: string }[]>([])
  const [sede, setSede] = useState('')
  const [deliveryFee, setDeliveryFee] = useState(0)
  const [deliveryIncluded, setDeliveryIncluded] = useState(true)
  const [paymentMethod, setPaymentMethod] = useState('contraentrega')

  useEffect(() => {
    if (people) {
      const mapped = people.map((p) => ({
        userId: p.userId,
        name: p.name,
      }))
      setPeopleOrder(mapped)

      const personItems = people.flatMap((person) =>
        person.items.map((item) => ({
          id: item.id,
          quantity: item.quantity,
          assignedTo: person.name,
        })),
      )
      setItems(personItems)
    }
  }, [people])

  useEffect(() => {
    if (sharedOrderItems) {
      const sharedItemsForDisplay = sharedOrderItems.flatMap((sharedItem) =>
        Array(sharedItem.quantity)
          .fill(null)
          .map(() => ({
            id: sharedItem.itemId,
            quantity: 1,
            assignedTo: 'Compartido',
          })),
      )
      setItems((prev) => [...prev, ...sharedItemsForDisplay])
    }
  }, [sharedOrderItems])

  const sedesDisponibles = ['Sede Norte', 'Sede Sur', 'Sede Centro']
  useEffect(() => {
    if (sedesDisponibles.length === 1) {
      setSede(sedesDisponibles[0])
    }
  }, [])

  const calculateTotal = () => {
    let total = 0
    items.forEach((item) => {
      const menuItem = menu.find((m) => m.id === item.id)
      if (menuItem) {
        total += menuItem.price * item.quantity
      }
    })
    return total + deliveryFee
  }

  const handleSubmit = async (event: React.FormEvent) => {
    event.preventDefault()
    const uid = user ? user.uid : null // Permitir pedidos sin autenticación

    try {
      const total = calculateTotal()
      const orderId = uuidv4()
      const orderData = {
        userId: uid,
        items: items.map((item) => ({
          id: item.id,
          quantity: item.quantity,
          assignedTo: item.assignedTo,
        })),
        people: peopleOrder,
        sede,
        status: 'pendiente',
        total,
        deliveryFee,
        deliveryIncluded,
        paymentMethod,
        orderDate: Timestamp.now(),
        orderId,
        sharedItems: sharedOrderItems
          ? sharedOrderItems.map((si) => ({
              itemId: si.itemId,
              quantity: si.quantity,
              personIds: si.personIds,
            }))
          : [],
      }

      await addDoc(collection(db, 'pedidos'), orderData)
      if (user) {
        await addPoints()
        alert('Pedido realizado con éxito y puntos sumados.')
      } else {
        alert('Pedido realizado con éxito.')
      }
      onClose()
    } catch (error) {
      console.error('Error al agregar el pedido:', error)
      alert('Error al agregar el pedido.')
    }
  }

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      <h2 className="text-xl font-bold text-gray-900">Realizar Pedido</h2>
      <div>
        <label htmlFor="sede" className="block text-sm font-medium text-gray-700">
          Sede
        </label>
        <select
          id="sede"
          value={sede}
          onChange={(e) => setSede(e.target.value)}
          required
          className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
        >
          {sedesDisponibles.map((sedeItem) => (
            <option key={sedeItem} value={sedeItem}>
              {sedeItem}
            </option>
          ))}
        </select>
      </div>
      <div>
        <label htmlFor="deliveryFee" className="block text-sm font-medium text-gray-700">
          Costo de Envío
        </label>
        <input
          type="number"
          id="deliveryFee"
          value={deliveryFee}
          onChange={(e) => setDeliveryFee(parseFloat(e.target.value))}
          required
          min="0"
          className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
        />
      </div>
      <div className="flex items-start">
        <div className="flex items-center h-5">
          <input
            type="checkbox"
            id="deliveryIncluded"
            name="deliveryIncluded"
            checked={deliveryIncluded}
            onChange={(e) => setDeliveryIncluded(e.target.checked)}
            className="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded"
          />
        </div>
        <div className="ml-2 text-sm">
          <label htmlFor="deliveryIncluded" className="font-medium text-gray-700">
            ¿El domicilio está incluido?
          </label>
        </div>
      </div>
      <div>
        <label htmlFor="paymentMethod" className="block text-sm font-medium text-gray-700">
          Método de Pago
        </label>
        <select
          id="paymentMethod"
          value={paymentMethod}
          onChange={(e) => setPaymentMethod(e.target.value)}
          required
          className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
        >
          <option value="contraentrega">Contraentrega</option>
        </select>
      </div>
      <div>
        <button
          type="submit"
          className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-500 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"
        >
          Realizar Pedido
        </button>
      </div>
    </form>
  )
}

export default PedidoForm

/* Fin src\components\forms\PedidoForm.tsx */

/* Inicio src\components\layout\MainLayout.tsx */
// src/components/layout/MainLayout.tsx
import React, { useEffect, useState } from 'react'
import Navbar from './Navbar'
import Sidebar from './Sidebar'

interface MainLayoutProps {
  children: React.ReactNode
}

const MainLayout: React.FC<MainLayoutProps> = ({ children }) => {
  const [drawerOpen, setDrawerOpen] = useState(false)
  const [isMobile, setIsMobile] = useState(false)

  const handleDrawerToggle = () => {
    setDrawerOpen(!drawerOpen)
  }

  const handleDrawerClose = () => {
    setDrawerOpen(false)
  }

  useEffect(() => {
    const handleResize = () => {
      setIsMobile(window.innerWidth < 768) // Ajusta el breakpoint según tus necesidades
    }

    handleResize() // Set initial value
    window.addEventListener('resize', handleResize)
    return () => window.removeEventListener('resize', handleResize)
  }, [])

  return (
    <div className="flex h-screen bg-gray-100 overflow-hidden">
      <Navbar toggleDrawer={handleDrawerToggle} />
      <Sidebar drawerOpen={drawerOpen} handleDrawerClose={handleDrawerClose} />
      <main
        className={`flex-1 overflow-x-hidden overflow-y-auto p-4 ${
          isMobile ? 'pt-16' : 'md:pl-64'
        }`}
      >
        <div className="container mx-auto">
          <div className="w-full">{children}</div>
        </div>
      </main>
    </div>
  )
}

export default MainLayout

/* Fin src\components\layout\MainLayout.tsx */

/* Inicio src\components\layout\Navbar.tsx */
// src/components/layout/Navbar.tsx
import MenuIcon from '@mui/icons-material/Menu'
import React from 'react'
import { useNavigate } from 'react-router-dom'
import { useAuth } from '../../hooks/useAuth'

interface NavbarProps {
  toggleDrawer: () => void
}

const Navbar: React.FC<NavbarProps> = ({ toggleDrawer }) => {
  const { logout, user } = useAuth()
  const navigate = useNavigate()

  const handleLogout = async () => {
    await logout()
    navigate('/login')
  }

  return (
    <header className="bg-white shadow-md fixed w-full top-0 z-50">
      <div className="container mx-auto px-4 sm:px-6 py-3 flex justify-between items-center">
        <div className="flex items-center">
          <button
            className="text-gray-500 hover:text-gray-700 focus:outline-none focus:text-gray-700 md:hidden transition-colors duration-200" // Transición en el icono
            aria-label="Abrir menú"
            onClick={toggleDrawer}
          >
            <MenuIcon className="transition-transform duration-300 hover:scale-110" />{' '}
            {/* Transición y escala en hover del icono */}
          </button>

          <img
            src="SrPolTitulo.png"
            alt="SrPol Logo"
            className="h-10 mr-2 transition-transform duration-300 hover:scale-105" // Transición en el logo
          />
          {/* Transición en el título */}
        </div>
        {user && (
          <div className=" md:flex items-center">
            <span className="hidden md:flex items-center text-gray-700 mr-4">{user.email}</span>
            <button
              className="bg-indigo-500 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition-colors duration-200 hover:scale-105" // Transición en el botón
              onClick={handleLogout}
            >
              Cerrar Sesión
            </button>
          </div>
        )}
      </div>
    </header>
  )
}

export default Navbar

/* Fin src\components\layout\Navbar.tsx */

/* Inicio src\components\layout\PublicLayout.tsx */
// src/components/layout/PublicLayout.tsx
import React, { ReactNode } from 'react'
import '../../styles/public-layout.css' // Importa el archivo CSS para el diseño público

interface PublicLayoutProps {
  children: ReactNode
}

const PublicLayout: React.FC<PublicLayoutProps> = ({ children }) => {
  return <div>{children}</div>
}

export default PublicLayout

/* Fin src\components\layout\PublicLayout.tsx */

/* Inicio src\components\layout\Sidebar.tsx */
// src/components/layout/Sidebar.tsx
import {
  AddBusiness as AddBusinessIcon,
  Dashboard as DashboardIcon,
  People as PeopleIcon,
  Person as PersonIcon,
  RestaurantMenu as RestaurantMenuIcon,
  Settings as SettingsIcon,
  ShoppingCart as ShoppingCartIcon,
} from '@mui/icons-material'
import React from 'react'
import { NavLink, useLocation } from 'react-router-dom' // Importa NavLink y useLocation
import { useAuth } from '../../hooks/useAuth'

interface SidebarProps {
  drawerOpen: boolean
  handleDrawerClose: () => void
}

const Sidebar: React.FC<SidebarProps> = ({ drawerOpen, handleDrawerClose }) => {
  const { userRole } = useAuth()
  const location = useLocation() // Hook para obtener la ruta actual

  const menuItems = [
    {
      text: 'Dashboard',
      icon: <DashboardIcon />,
      path: '/',
      roles: ['admin', 'encargado', 'client'],
    },
    {
      text: 'Menú',
      icon: <RestaurantMenuIcon />,
      path: '/menu',
      roles: ['admin', 'encargado', 'client'],
    },
    {
      text: 'Pedidos',
      icon: <ShoppingCartIcon />,
      path: '/pedidos',
      roles: ['admin', 'encargado', 'client'],
    },
    {
      text: 'Gestionar Menú',
      icon: <SettingsIcon />,
      path: '/gestion-menu',
      roles: ['admin', 'encargado'],
    },
    {
      text: 'Perfil',
      icon: <PersonIcon />,
      path: '/perfil',
      roles: ['admin', 'encargado', 'client'],
    },
    {
      text: 'Gestión de Usuarios',
      icon: <PeopleIcon />,
      path: '/gestion-usuarios',
      roles: ['admin'],
    },
    {
      text: 'Contabilidad',
      icon: <AddBusinessIcon />, // Algún ícono que quieras (o un emoji de dinero 💸)
      path: '/contabilidad',
      roles: ['admin', 'encargado'],
    },
  ]

  return (
    <aside
      className={`bg-gray-50 w-64 flex-shrink-0 overflow-y-auto fixed top-16 md:top-0 left-0 h-full z-40 transition-transform duration-300 ease-in-out md:translate-x-0 ${
        drawerOpen ? 'translate-x-0' : '-translate-x-full'
      } md:shadow-md`} // Shadow en desktop
    >
      <div className="py-6 px-4 md:px-6">
        {' '}
        {/* Más padding en desktop */}
        <span className="text-xl font-semibold text-gray-900 block mb-2 md:hidden text-center">
          Navegación
        </span>{' '}
        {/* Título en mobile */}
        <nav className="space-y-2">
          {menuItems
            .filter(
              (item) => item.roles.includes(userRole || 'public') || item.roles.includes('public'),
            )
            .map((item) => {
              const isActive = location.pathname === item.path // Verifica si la ruta coincide
              return (
                <NavLink
                  key={item.text}
                  to={item.path}
                  className={({
                    isActive,
                  }) => `group flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors duration-200
                                      ${
                                        isActive
                                          ? 'bg-indigo-100 text-indigo-700'
                                          : 'text-gray-700 hover:bg-gray-100 hover:text-gray-900'
                                      }`}
                  onClick={handleDrawerClose} // Cierra el drawer en mobile al hacer clic
                >
                  <span
                    className={`mr-3 h-6 w-6 flex items-center justify-center ${
                      isActive ? 'text-indigo-500' : 'text-gray-500 group-hover:text-gray-600'
                    }`}
                  >
                    {' '}
                    {/* Icon color changes on hover and active */}
                    {item.icon}
                  </span>
                  {item.text}
                </NavLink>
              )
            })}
        </nav>
      </div>
    </aside>
  )
}

export default Sidebar

/* Fin src\components\layout\Sidebar.tsx */

/* Inicio src\components\menu\GroupOrderPage.tsx */
/* src/components/menu/GroupOrderPage.tsx */
/* eslint-disable @typescript-eslint/no-floating-promises */
/* eslint-disable @typescript-eslint/no-misused-promises */
import { doc, onSnapshot, updateDoc } from 'firebase/firestore'
import React, { ChangeEvent, FC, useEffect, useRef, useState } from 'react'
import { useNavigate, useParams, useSearchParams } from 'react-router-dom'
import { MenuItem as MenuItemType } from '../../context/AppContext'
import { useAuth } from '../../hooks/useAuth'
import { useMenu } from '../../hooks/useMenu'
import { COLLECTIONS } from '../../utils/constants'
import { db } from '../../utils/firebase'
import OrderReview from './partials/OrderReview'
import PeopleSelection from './partials/PeopleSelection'
import PersonOrder from './partials/PersonOrder'
import SharedOrder from './partials/SharedOrder'

export interface Person {
  personIndex: number
  userId: string | null
  name: string
  items: { id: string; quantity: number }[]
  locked?: boolean
  finished?: boolean
  photoUrl?: string
}

export interface SharedOrderItem {
  itemId: string
  quantity: number
  personIds: string[]
}

export interface GroupOrderData {
  code: string
  ownerId: string | null
  status: string
  participants: Person[]
  sharedItems: SharedOrderItem[]
  orderPlaced?: boolean
  allFinished?: boolean
  showPricesToAll?: boolean
}

const GroupOrderPage: FC = (): JSX.Element => {
  const { menu } = useMenu()
  const { user } = useAuth()
  const navigate = useNavigate()

  const [numPeople, setNumPeople] = useState<number>(1)
  const [people, setPeople] = useState<Person[]>([])
  const [showPeopleNames, setShowPeopleNames] = useState<boolean>(false)
  const [showPedidoForm, setShowPedidoForm] = useState<boolean>(false)
  const [sharedOrderItems, setSharedOrderItems] = useState<SharedOrderItem[]>([])
  const [selectedView, setSelectedView] = useState<string>('shared')
  const [groupOrderCode, setGroupOrderCode] = useState<string | null>(null)
  const [groupOrderId, setGroupOrderId] = useState<string | null>(null)
  const [isOwner, setIsOwner] = useState<boolean>(false)
  const [allFinished, setAllFinished] = useState<boolean>(false)
  const [orderPlaced, setOrderPlaced] = useState<boolean>(false)
  const [showPricesToAll, setShowPricesToAll] = useState<boolean>(false)

  const [editingPersonIndex, setEditingPersonIndex] = useState<number | null>(null)
  const [editingName, setEditingName] = useState<string>('')

  const [searchParams] = useSearchParams()
  const codeFromURL: string | null = searchParams.get('code')
  const joiningWithCode: boolean = !!codeFromURL
  const { groupOrderId: routeGroupId } = useParams<{ groupOrderId: string }>()

  const sharedOrderSummaryRef = useRef<HTMLDivElement>(null)
  const personRefs = useRef<React.RefObject<HTMLDivElement>[]>([])
  if (personRefs.current.length !== people.length) {
    personRefs.current = Array.from({ length: people.length }, () =>
      React.createRef<HTMLDivElement>(),
    )
  }

  useEffect(() => {
    if (routeGroupId) {
      setGroupOrderId(routeGroupId)
      setGroupOrderCode(codeFromURL)
      const unsubscribe = subscribeToGroupOrder(routeGroupId)
      return () => unsubscribe()
    } else {
      console.error('No se encontró groupOrderId en la ruta')
      navigate('/menu')
    }
  }, [routeGroupId, codeFromURL])

  const subscribeToGroupOrder = (groupId: string): (() => void) => {
    const ref = doc(db, COLLECTIONS.GROUP_ORDERS, groupId)
    return onSnapshot(
      ref,
      (docSnap) => {
        if (!docSnap.exists()) {
          navigate('/menu')
          return
        }
        const data = docSnap.data() as GroupOrderData
        setGroupOrderCode(data.code)
        setPeople(data.participants)
        setSharedOrderItems(data.sharedItems)
        setIsOwner(user ? user.uid === data.ownerId : false)
        setAllFinished(data.participants.every((p: Person) => Boolean(p.finished)))
        setOrderPlaced(Boolean(data.orderPlaced))
        setShowPricesToAll(Boolean(data.showPricesToAll))
        if (data.participants.length !== numPeople) {
          setNumPeople(data.participants.length)
        }
        if (data.orderPlaced) {
          setShowPedidoForm(true)
        }
      },
      (error) => {
        console.error('Error al suscribirse al pedido grupal:', error)
        navigate('/menu')
      },
    )
  }

  const handleNumPeopleChange = (e: ChangeEvent<HTMLInputElement>): void => {
    const num: number = Number(e.target.value)
    setNumPeople(num)
    setPeople((prev: Person[]) => {
      const currentCount = prev.length
      if (num > currentCount) {
        const newPeople: Person[] = Array.from({ length: num - currentCount }, (_, i) => ({
          personIndex: currentCount + i,
          userId: null,
          name: `Persona ${currentCount + i + 1}`,
          items: [],
          locked: false,
          finished: false,
        }))
        return [...prev, ...newPeople]
      } else if (num < currentCount) {
        return prev.slice(0, num)
      }
      return prev
    })
  }

  const handlePersonNameChange = (index: number, name: string): void => {
    setPeople((prev: Person[]) => {
      const updated = [...prev]
      if (updated[index]) {
        updated[index].name = name
      }
      return updated
    })
  }

  const handleStartOrder = (): void => {
    if (people.every((p: Person) => p.name.trim() !== '')) {
      setShowPeopleNames(true)
      setSelectedView('shared')
    } else {
      alert('Por favor ingresa el nombre de cada persona')
    }
  }

  const handleAddToSharedOrder = async (item: MenuItemType): Promise<void> => {
    if (!groupOrderId || orderPlaced) return
    if (item.availabilityStatus !== 'disponible') return

    const existingIndex: number = sharedOrderItems.findIndex((si) => si.itemId === item.id)
    let updated: SharedOrderItem[]
    if (existingIndex >= 0) {
      updated = sharedOrderItems.map((si, idx) =>
        idx === existingIndex ? { ...si, quantity: si.quantity + 1 } : si,
      )
    } else {
      updated = [...sharedOrderItems, { itemId: item.id, quantity: 1, personIds: [] }]
    }
    setSharedOrderItems(updated)
    try {
      await updateDoc(doc(db, COLLECTIONS.GROUP_ORDERS, groupOrderId), {
        sharedItems: updated,
      })
    } catch (error) {
      console.error('Error al actualizar sharedItems:', (error as Error).message)
    }
  }

  const handleSharedOrderItemQuantityChange = async (
    itemId: string,
    quantity: number,
  ): Promise<void> => {
    if (!groupOrderId || orderPlaced) return
    if (quantity < 0) return

    const updated = sharedOrderItems.map((si) => (si.itemId === itemId ? { ...si, quantity } : si))
    setSharedOrderItems(updated)
    try {
      await updateDoc(doc(db, COLLECTIONS.GROUP_ORDERS, groupOrderId), {
        sharedItems: updated,
      })
    } catch (error) {
      console.error('Error al cambiar cantidad en sharedItems:', (error as Error).message)
    }
  }

  const handleRemoveSharedOrderItem = async (itemId: string): Promise<void> => {
    if (!groupOrderId || orderPlaced) return

    const updated = sharedOrderItems.filter((si) => si.itemId !== itemId)
    setSharedOrderItems(updated)
    try {
      await updateDoc(doc(db, COLLECTIONS.GROUP_ORDERS, groupOrderId), {
        sharedItems: updated,
      })
    } catch (error) {
      console.error('Error al remover item compartido:', (error as Error).message)
    }
  }

  const handleAddItemToPerson = async (
    personIndex: number,
    menuItem: MenuItemType,
  ): Promise<void> => {
    if (!groupOrderId || orderPlaced) return
    if (menuItem.availabilityStatus !== 'disponible') return

    const personData: Person = people[personIndex]
    const lockedByOther: boolean = user
      ? Boolean(personData.locked) && personData.userId !== user.uid
      : false
    if (lockedByOther) return

    let updatedPeople: Person[] = [...people]
    if (user && !personData.locked) {
      updatedPeople = updatedPeople.map((p, idx) =>
        idx === personIndex ? { ...p, userId: user.uid, locked: true } : p,
      )
    } else if (!user && !personData.locked) {
      // Permitir edición para invitados manteniendo userId como null
      updatedPeople = updatedPeople.map((p, idx) =>
        idx === personIndex ? { ...p, userId: null, locked: true } : p,
      )
    }

    updatedPeople = updatedPeople.map((p, idx) => {
      if (idx === personIndex) {
        const foundItem = p.items.find((it) => it.id === menuItem.id)
        if (foundItem) {
          return {
            ...p,
            items: p.items.map((it) =>
              it.id === menuItem.id ? { ...it, quantity: it.quantity + 1 } : it,
            ),
          }
        } else {
          return { ...p, items: [...p.items, { id: menuItem.id, quantity: 1 }] }
        }
      }
      return p
    })
    setPeople(updatedPeople)
    try {
      await updateDoc(doc(db, COLLECTIONS.GROUP_ORDERS, groupOrderId), {
        participants: updatedPeople,
      })
    } catch (error) {
      console.error('Error al agregar item a persona:', (error as Error).message)
    }
  }

  const handlePersonOrderItemQuantityChange = async (
    personIndex: number,
    itemId: string,
    quantity: number,
  ): Promise<void> => {
    if (!groupOrderId || orderPlaced) return
    if (quantity < 0) return

    const updated = people.map((p, idx) =>
      idx === personIndex
        ? {
            ...p,
            items: p.items.map((it) => (it.id === itemId ? { ...it, quantity } : it)),
          }
        : p,
    )
    setPeople(updated)
    try {
      await updateDoc(doc(db, COLLECTIONS.GROUP_ORDERS, groupOrderId), {
        participants: updated,
      })
    } catch (error) {
      console.error('Error al cambiar cantidad de item en persona:', (error as Error).message)
    }
  }

  const handleRemoveItemFromPerson = async (personIndex: number, itemId: string): Promise<void> => {
    if (!groupOrderId || orderPlaced) return

    const updated = people.map((p, idx) =>
      idx === personIndex ? { ...p, items: p.items.filter((it) => it.id !== itemId) } : p,
    )
    setPeople(updated)
    try {
      await updateDoc(doc(db, COLLECTIONS.GROUP_ORDERS, groupOrderId), {
        participants: updated,
      })
    } catch (error) {
      console.error('Error al remover item de persona:', (error as Error).message)
    }
  }

  const handlePersonFinishedOrder = async (personIndex: number): Promise<void> => {
    if (!groupOrderId || orderPlaced) return

    const updated = people.map((p, idx) => (idx === personIndex ? { ...p, finished: true } : p))
    setPeople(updated)
    const everyoneDone: boolean = updated.every((p) => Boolean(p.finished))
    setAllFinished(everyoneDone)
    try {
      await updateDoc(doc(db, COLLECTIONS.GROUP_ORDERS, groupOrderId), {
        participants: updated,
        allFinished: everyoneDone,
      })
    } catch (error) {
      console.error('Error al finalizar pedido de persona:', (error as Error).message)
    }
  }

  const handleReviewOrder = (): void => {
    setShowPedidoForm(true)
  }

  const handleOrderPlacement = async (): Promise<void> => {
    if (!groupOrderId) return
    await updateDoc(doc(db, COLLECTIONS.GROUP_ORDERS, groupOrderId), {
      orderPlaced: true,
    })
    setOrderPlaced(true)
    setShowPedidoForm(true)
  }

  const handleToggleShowPrices = async (): Promise<void> => {
    if (!groupOrderId) return
    const newVal: boolean = !showPricesToAll
    setShowPricesToAll(newVal)
    try {
      await updateDoc(doc(db, COLLECTIONS.GROUP_ORDERS, groupOrderId), {
        showPricesToAll: newVal,
      })
    } catch (error) {
      console.error('Error al alternar visualización de precios:', (error as Error).message)
    }
  }

  const getSharedItemCount = (): number =>
    sharedOrderItems.reduce((acc, si) => acc + si.quantity, 0)

  const getInitialLetter = (name: string): string =>
    name.trim() === '' ? '?' : name.trim()[0].toUpperCase()

  return (
    <div className="min-h-screen bg-gray-50 p-4 md:p-8">
      <header className="mb-6 text-center">
        {groupOrderCode && (
          <div className="sm:flex sm:items-center sm:justify-center">
            <h2 className="text-2xl font-bold text-indigo-600">
              Código de Pedido: <span className="text-3xl font-mono">{groupOrderCode}</span>
            </h2>
            <p className="text-sm text-gray-500 sm:ml-2">Comparte este código con tus amigos</p>
          </div>
        )}
      </header>

      {!showPeopleNames && !joiningWithCode ? (
        <PeopleSelection
          numPeople={numPeople}
          people={people}
          onNumPeopleChange={handleNumPeopleChange}
          onPersonNameChange={handlePersonNameChange}
          onStartOrder={handleStartOrder}
        />
      ) : !showPedidoForm ? (
        <>
          <div className="flex flex-wrap gap-4 justify-center mb-8">
            <div
              onClick={() => setSelectedView('shared')}
              className="cursor-pointer flex flex-col items-center"
            >
              <div
                className={`relative w-16 h-16 rounded-full ring-4 transition-transform duration-300 flex items-center justify-center ${
                  selectedView === 'shared' ? 'ring-indigo-500 scale-110' : 'ring-gray-300'
                } bg-indigo-100`}
              >
                <span className="text-2xl">🤝</span>
                {getSharedItemCount() > 0 && (
                  <span className="absolute top-0 right-0 bg-red-500 text-white text-xs font-bold rounded-full px-2 py-0.5">
                    {getSharedItemCount()}
                  </span>
                )}
              </div>
              <span className="mt-2 text-sm font-medium text-gray-700">Compartido</span>
            </div>
            {people.map((person, i) => {
              const lockedByOther: boolean =
                Boolean(person.locked) && person.userId !== (user ? user.uid : null)
              const active: boolean = selectedView === `person-${i}`
              const bubbleColors: string[] = [
                'bg-pink-100',
                'bg-blue-100',
                'bg-yellow-100',
                'bg-green-100',
                'bg-purple-100',
                'bg-teal-100',
              ]
              const color: string = bubbleColors[i % bubbleColors.length]
              return (
                <div
                  key={person.personIndex}
                  onClick={() => setSelectedView(`person-${i}`)}
                  className="cursor-pointer flex flex-col items-center"
                >
                  <div
                    className={`relative w-16 h-16 rounded-full transition-transform duration-300 flex items-center justify-center ${
                      active ? 'ring-indigo-500 scale-110' : 'ring-gray-300'
                    } ${color}`}
                  >
                    {person.photoUrl ? (
                      <img
                        src={person.photoUrl}
                        alt={person.name}
                        className="w-full h-full object-cover rounded-full"
                      />
                    ) : (
                      <span className="text-xl font-bold text-gray-700">
                        {getInitialLetter(person.name)}
                      </span>
                    )}
                    {lockedByOther && (
                      <span className="absolute top-0 left-0 text-red-500 text-lg">🔒</span>
                    )}
                    {person.finished && (
                      <span className="absolute bottom-0 right-0 text-green-500 text-lg font-bold">
                        ✅
                      </span>
                    )}
                  </div>
                  {editingPersonIndex === i ? (
                    <input
                      type="text"
                      value={editingName}
                      onChange={(e) => setEditingName(e.target.value)}
                      onBlur={() => {
                        handlePersonNameChange(i, editingName)
                        setEditingPersonIndex(null)
                      }}
                      onKeyDown={(e) => {
                        if (e.key === 'Enter') {
                          handlePersonNameChange(i, editingName)
                          setEditingPersonIndex(null)
                        }
                      }}
                      className="mt-2 text-sm font-medium text-gray-700 max-w-[4rem] truncate border border-gray-300 rounded px-1"
                      autoFocus
                    />
                  ) : (
                    <span
                      onClick={() => {
                        if (!person.locked || (user && person.userId === user.uid) || !user) {
                          setEditingPersonIndex(i)
                          setEditingName(person.name)
                        }
                      }}
                      className="mt-2 text-sm font-medium text-gray-700 max-w-[4rem] truncate cursor-pointer"
                    >
                      {person.name}
                    </span>
                  )}
                </div>
              )
            })}
          </div>

          {selectedView === 'shared' ? (
            <SharedOrder
              menuCategories={menu
                .filter((item) => item.availabilityStatus !== 'noDisponibleLargoPlazo')
                .reduce<Record<string, MenuItemType[]>>((acc, item) => {
                  const cat: string = item.recommendation || 'General'
                  if (!acc[cat]) acc[cat] = []
                  acc[cat].push(item)
                  return acc
                }, {})}
              sharedOrderItems={sharedOrderItems}
              onAddToSharedOrder={handleAddToSharedOrder}
              onSharedOrderItemQuantityChange={handleSharedOrderItemQuantityChange}
              onRemoveSharedOrderItem={handleRemoveSharedOrderItem}
              calculateSharedSubtotal={() =>
                sharedOrderItems.reduce((sum, si) => {
                  const menuItem = menu.find((m) => m.id === si.itemId)
                  return menuItem ? sum + menuItem.price * si.quantity : sum
                }, 0)
              }
              sharedOrderSummaryRef={sharedOrderSummaryRef}
              activeTab={selectedView}
              menu={menu}
              disabled={orderPlaced}
            />
          ) : (
            people.map((person, i) => {
              if (selectedView === `person-${i}`) {
                const lockedByOther: boolean =
                  Boolean(person.locked) && person.userId !== (user ? user.uid : null)
                return (
                  <PersonOrder
                    key={person.personIndex}
                    person={person}
                    index={i}
                    menuCategories={menu
                      .filter((m) => m.availabilityStatus !== 'noDisponibleLargoPlazo')
                      .reduce<Record<string, MenuItemType[]>>((acc, item) => {
                        const cat: string = item.recommendation || 'General'
                        if (!acc[cat]) acc[cat] = []
                        acc[cat].push(item)
                        return acc
                      }, {})}
                    menu={menu}
                    onAddItemToPerson={handleAddItemToPerson}
                    onPersonOrderItemQuantityChange={handlePersonOrderItemQuantityChange}
                    onRemoveItemFromPerson={handleRemoveItemFromPerson}
                    calculateSubtotal={(personItems) =>
                      personItems.reduce((total, it) => {
                        const menuItem = menu.find((m) => m.id === it.id)
                        return menuItem ? total + menuItem.price * it.quantity : total
                      }, 0)
                    }
                    personOrderSummaryRef={personRefs.current[i]}
                    activeTab={selectedView}
                    onPersonFinishedOrder={handlePersonFinishedOrder}
                    isFinished={Boolean(person.finished)}
                    personLocked={Boolean(person.locked)}
                    isCurrentUserTab={user ? person.userId === user.uid : true}
                    personIndex={i}
                    disabled={lockedByOther || orderPlaced}
                  />
                )
              }
              return null
            })
          )}

          <div className="flex justify-center mt-8">
            {isOwner && allFinished && !orderPlaced ? (
              <button
                onClick={handleReviewOrder}
                disabled={orderPlaced}
                className="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-xl transition-colors duration-300"
              >
                ¡Revisar Pedido Grupal! ✅
              </button>
            ) : isOwner && orderPlaced ? (
              <p className="text-center text-green-600 font-semibold">
                Pedido realizado. Revisando resumen...
              </p>
            ) : !isOwner ? (
              <p className="text-center text-gray-600">
                Solo el creador del pedido puede finalizar pedidos de otros.
              </p>
            ) : !allFinished ? (
              <p className="text-center text-gray-600">
                Aún faltan personas por confirmar su pedido.
              </p>
            ) : null}
          </div>
        </>
      ) : (
        <OrderReview
          people={people}
          sharedOrderItems={sharedOrderItems}
          menu={menu}
          onClosePedidoForm={() => setShowPedidoForm(false)}
          calculateSharedSubtotal={() =>
            sharedOrderItems.reduce((sum, si) => {
              const menuItem = menu.find((m) => m.id === si.itemId)
              return menuItem ? sum + menuItem.price * si.quantity : sum
            }, 0)
          }
          calculateSubtotal={(personItems) =>
            personItems.reduce((total, it) => {
              const menuItem = menu.find((m) => m.id === it.id)
              return menuItem ? total + menuItem.price * it.quantity : total
            }, 0)
          }
          isOrderOwner={isOwner}
          onOrderPlaced={handleOrderPlacement}
          orderPlaced={orderPlaced}
          showPricesToAll={showPricesToAll}
          onToggleShowPrices={handleToggleShowPrices}
        />
      )}
    </div>
  )
}

export default GroupOrderPage

/* Fin src\components\menu\GroupOrderPage.tsx */

/* Inicio src\components\menu\JoinOrderModal.tsx */
/* src/components/menu/JoinOrderModal.tsx */
import { Button, Dialog, DialogActions, DialogContent, DialogTitle, TextField } from '@mui/material'
import React, { useState } from 'react'

interface JoinOrderModalProps {
  open: boolean
  onClose: () => void
  onJoinOrder: (code: string) => void
}

const JoinOrderModal: React.FC<JoinOrderModalProps> = ({ open, onClose, onJoinOrder }) => {
  const [code, setCode] = useState('')

  const handleJoin = () => {
    onJoinOrder(code)
    onClose()
  }

  return (
    <Dialog open={open} onClose={onClose}>
      <DialogTitle>Unirse a Pedido Compartido</DialogTitle>
      <DialogContent>
        <TextField
          autoFocus
          margin="dense"
          id="code"
          label="Código del pedido"
          type="text"
          fullWidth
          value={code}
          onChange={(e) => setCode(e.target.value)}
        />
      </DialogContent>
      <DialogActions>
        <Button onClick={onClose} color="primary">
          Cancelar
        </Button>
        <Button onClick={handleJoin} color="primary">
          Unirme
        </Button>
      </DialogActions>
    </Dialog>
  )
}

export default JoinOrderModal

/* Fin src\components\menu\JoinOrderModal.tsx */

/* Inicio src\components\menu\MenuForm.tsx */
/* Inicio src\components\forms\MenuForm.tsx */
/* src\components\forms\MenuForm.tsx */
import React, { useState } from "react";
import { MenuItem } from "../../context/AppContext";
import { useMenu } from "../../hooks/useMenu";

interface MenuFormProps {
  initialValues?: Partial<MenuItem>;
  onSubmit: (values: Partial<MenuItem>) => void;
  onClose: () => void; // Add onClose prop
}

const MenuForm: React.FC<MenuFormProps> = ({
  initialValues,
  onSubmit,
  onClose,
}) => {
  const { loading } = useMenu();
  const [name, setName] = useState(initialValues?.name || "");
  const [description, setDescription] = useState(
    initialValues?.description || ""
  );
  const [price, setPrice] = useState(initialValues?.price || 0);
  const [imageUrl, setImageUrl] = useState(initialValues?.imageUrl || "");
  const [recommendation, setRecommendation] = useState(
    initialValues?.recommendation || ""
  );
  const [observations, setObservations] = useState(
    initialValues?.observations || ""
  );
  const [available, setAvailable] = useState(
    initialValues?.available !== undefined ? initialValues.available : true
  );
  // Nueva estado para el estado de disponibilidad
  const [availabilityStatus, setAvailabilityStatus] = useState<
    "disponible" | "noDisponibleMomento" | "noDisponibleLargoPlazo"
  >(initialValues?.availabilityStatus || "disponible");

  const handleSubmit = (event: React.FormEvent) => {
    event.preventDefault();
    onSubmit({
      name,
      description,
      price,
      imageUrl,
      available,
      recommendation,
      observations,
      availabilityStatus, // Incluir el nuevo estado en los valores enviados
    });
    onClose(); // Close modal on submit
  };

  if (loading) {
    return <div>Cargando...</div>;
  }

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      {" "}
      {/* Formulario con espaciado vertical */}
      <div className="grid grid-cols-1 gap-4">
        {" "}
        {/* Grid para los campos */}
        <div>
          <label
            htmlFor="name"
            className="block text-sm font-medium text-gray-700"
          >
            Nombre del Item
          </label>
          <input
            type="text"
            id="name"
            value={name}
            onChange={(e) => setName(e.target.value)}
            required
            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          />
        </div>
        <div>
          <label
            htmlFor="description"
            className="block text-sm font-medium text-gray-700"
          >
            Descripción
          </label>
          <textarea /* Usamos textarea para la descripción */
            id="description"
            value={description}
            onChange={(e) => setDescription(e.target.value)}
            required
            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          />
        </div>
        <div>
          <label
            htmlFor="price"
            className="block text-sm font-medium text-gray-700"
          >
            Precio
          </label>
          <input
            type="number"
            id="price"
            value={price}
            onChange={(e) => setPrice(Number(e.target.value))}
            required
            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          />
        </div>
        <div>
          <label
            htmlFor="imageUrl"
            className="block text-sm font-medium text-gray-700"
          >
            URL de Imagen
          </label>
          <input
            type="url"
            id="imageUrl"
            value={imageUrl}
            onChange={(e) => setImageUrl(e.target.value)}
            required
            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          />
        </div>
        <div>
          <label
            htmlFor="recommendation"
            className="block text-sm font-medium text-gray-700"
          >
            Recomendaciones (Opcional)
          </label>
          <input
            type="text"
            id="recommendation"
            value={recommendation}
            onChange={(e) => setRecommendation(e.target.value)}
            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          />
        </div>
        <div>
          <label
            htmlFor="observations"
            className="block text-sm font-medium text-gray-700"
          >
            Observaciones (Opcional)
          </label>
          <input
            type="text"
            id="observations"
            value={observations}
            onChange={(e) => setObservations(e.target.value)}
            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          />
        </div>
        {/* Nuevo campo para el estado de disponibilidad */}
        <div>
          <label
            htmlFor="availabilityStatus"
            className="block text-sm font-medium text-gray-700"
          >
            Estado de Disponibilidad
          </label>
          <select
            id="availabilityStatus"
            value={availabilityStatus}
            onChange={(e) =>
              setAvailabilityStatus(
                e.target.value as
                  | "disponible"
                  | "noDisponibleMomento"
                  | "noDisponibleLargoPlazo"
              )
            }
            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          >
            <option value="disponible">Disponible</option>
            <option value="noDisponibleMomento">
              No disponible en el momento
            </option>
            <option value="noDisponibleLargoPlazo">Ya no disponible</option>
          </select>
        </div>
      </div>
      <div className="flex items-center justify-between mt-4">
        {" "}
        {/* Contenedor para checkbox y botones */}
        <div className="flex items-center">
          <input
            type="checkbox"
            id="available"
            className="form-checkbox h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
            checked={available}
            onChange={(e) => setAvailable(e.target.checked)}
          />
          <label htmlFor="available" className="ml-2 text-sm text-gray-700">
            Disponible (Visible en Menu)
          </label>
        </div>
        <div className="space-x-2">
          <button
            className="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
            onClick={onClose}
            type="button" /* Importante: type="button" para evitar submit del form al cancelar */
          >
            Cancelar
          </button>
          <button
            type="submit"
            className="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
          >
            {initialValues?.id ? "Guardar" : "Agregar"}
          </button>
        </div>
      </div>
    </form>
  );
};

export default MenuForm;

/* Fin src\components\menu\MenuForm.tsx */

/* Inicio src\components\menu\MenuItem.tsx */
import React from 'react'
import { MenuItem as MenuItemType } from '../../context/AppContext'

interface MenuItemProps {
  item: MenuItemType
  onEdit: (item: MenuItemType) => void
  onDelete: (item: MenuItemType) => void
}
export const formatPriceCOP = (price: number) => {
  return price.toLocaleString('es-CO', {
    style: 'currency',
    currency: 'COP',
    minimumFractionDigits: 0, // Remove cents if whole number
    maximumFractionDigits: 0,
  })
}
const MenuItem: React.FC<MenuItemProps> = ({ item, onEdit, onDelete }) => {
  // Función para determinar el color del badge según el estado de disponibilidad
  const getStatusBadgeClass = () => {
    switch (item.availabilityStatus) {
      case 'noDisponibleMomento':
        return 'bg-yellow-500 text-yellow-900' // Amarillo para "No disponible por el momento"
      case 'noDisponibleLargoPlazo':
        return 'bg-red-500 text-red-900' // Rojo para "No disponible a largo plazo"
      default:
        return 'bg-green-500 text-green-900' // Verde para "Disponible"
    }
  }

  const statusBadgeClass = `inline-block ${getStatusBadgeClass()} rounded-full px-3 py-1 text-sm font-semibold mr-2 mb-2`

  // Function to format price to Colombian Pesos

  return (
    <div className="max-w-sm rounded overflow-hidden shadow-lg">
      {' '}
      {/* Card principal con Tailwind */}
      <img className="w-full" src={item.imageUrl} alt={item.name} /> {/* Imagen responsive */}
      <div className="px-6 py-4">
        {' '}
        {/* Contenido principal card */}
        <div className="font-bold text-xl mb-2 flex justify-between items-center">
          {item.name}
          <span className={statusBadgeClass}>
            {item.availabilityStatus === 'disponible'
              ? 'Disponible'
              : item.availabilityStatus === 'noDisponibleMomento'
                ? 'No Disponible Ahora'
                : 'No Disponible'}
          </span>
        </div>{' '}
        {/* Nombre del item */}
        <p className="text-gray-700 text-base">{item.description}</p> {/* Descripción */}
        <p className="text-gray-700 text-lg mt-2">Precio: {formatPriceCOP(item.price)}</p>{' '}
        {/* Precio */}
        <div>
          {item.recommendation && (
            <p className="text-gray-600 text-sm mt-1">Recomendaciones: {item.recommendation}</p>
          )}
          {item.observations && (
            <p className="text-gray-600 text-sm mt-1">Observaciones: {item.observations}</p>
          )}
        </div>
      </div>
      <div className="px-6 py-4 flex justify-end space-x-2">
        {' '}
        {/* Contenedor acciones */}
        <button
          className="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
          onClick={() => onEdit(item)}
        >
          Editar
        </button>
        <button
          className="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
          onClick={() => onDelete(item)}
        >
          Eliminar
        </button>
      </div>
    </div>
  )
}

export default MenuItem

/* Fin src\components\menu\MenuItem.tsx */

/* Inicio src\components\menu\MenuList.tsx */
import React from "react";
import { MenuItem as MenuItemType } from "../../context/AppContext";
import MenuItemComponent from "./MenuItem";

interface MenuListProps {
  menu: MenuItemType[];
  onEdit: (item: MenuItemType) => void;
  onDelete: (item: MenuItemType) => Promise<void>;
}

const MenuList: React.FC<MenuListProps> = ({ menu, onEdit, onDelete }) => {
  return (
    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {" "}
      {/* Grid responsive para la lista */}
      {menu.map((item) => (
        <MenuItemComponent
          key={item.id}
          item={item}
          onEdit={onEdit}
          onDelete={onDelete}
        />
      ))}
    </div>
  );
};

export default MenuList;

/* Fin src\components\menu\MenuList.tsx */

/* Inicio src\components\menu\MenuModal.tsx */
// src/components/menu/MenuModal.tsx
import React, { useState } from 'react'
import { MenuItem } from '../../context/AppContext'

interface MenuModalProps {
  open: boolean
  onClose: () => void
  initialValues?: Partial<MenuItem>
  onSubmit: (values: Partial<MenuItem>) => void | Promise<void>
}

const MenuModal: React.FC<MenuModalProps> = ({ open, onClose, initialValues, onSubmit }) => {
  const [localValues, setLocalValues] = useState<Partial<MenuItem>>(initialValues ?? {})

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
    const { name, value } = e.target
    setLocalValues((prev) => ({ ...prev, [name]: value }))
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    await onSubmit(localValues)
    onClose()
  }

  if (!open) return null

  return (
    <div
      style={{
        position: 'fixed',
        inset: 0,
        backgroundColor: 'rgba(0,0,0,0.5)',
      }}
      onClick={onClose}
    >
      <div
        style={{
          backgroundColor: '#fff',
          maxWidth: 500,
          margin: '50px auto',
          padding: 20,
        }}
        onClick={(e) => e.stopPropagation()}
      >
        <h3>Editar / Agregar ítem al Menú</h3>
        <form onSubmit={void handleSubmit}>
          <div style={{ marginBottom: '1rem' }}>
            <label>Nombre:</label>
            <input name="name" type="text" value={localValues.name ?? ''} onChange={handleChange} />
          </div>
          <div style={{ marginBottom: '1rem' }}>
            <label>Descripción:</label>
            <textarea
              name="description"
              value={localValues.description ?? ''}
              onChange={handleChange}
            />
          </div>
          {/* ... otros campos price, imageUrl, etc. */}

          <div style={{ marginTop: '1rem' }}>
            <button type="button" onClick={onClose}>
              Cancelar
            </button>
            <button type="submit" style={{ marginLeft: 8 }}>
              Guardar
            </button>
          </div>
        </form>
      </div>
    </div>
  )
}

export default MenuModal

/* Fin src\components\menu\MenuModal.tsx */

/* Inicio src\components\menu\NameModal.tsx */
/** src/components/menu/NameModal.tsx **/
import React, { FormEvent, useState } from 'react'

interface NameModalProps {
  open: boolean
  onClose: () => void
  currentName?: string
  onSubmit: (name: string) => void
}

const NameModal: React.FC<NameModalProps> = ({ open, onClose, currentName = '', onSubmit }) => {
  const [tempName, setTempName] = useState<string>(currentName)

  if (!open) return null

  const handleSubmit = (e: FormEvent) => {
    e.preventDefault()
    // Llamamos al onSubmit con el contenido (si está vacío, que sea el currentName anterior)
    onSubmit(tempName.trim() || currentName)
    onClose()
  }

  return (
    <div
      className="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"
      onClick={onClose}
    >
      <div
        className="bg-white rounded p-6 max-w-sm w-full relative"
        onClick={(e) => e.stopPropagation()}
      >
        <h2 className="text-xl font-bold mb-4 text-center">¿Cuál es tu nombre?</h2>
        <form onSubmit={handleSubmit} className="space-y-4">
          <input
            type="text"
            placeholder="Déjalo vacío si prefieres 'Persona X'"
            className="border border-gray-300 rounded w-full p-2"
            value={tempName}
            onChange={(e) => setTempName(e.target.value)}
          />
          <div className="flex justify-end space-x-2">
            <button
              type="button"
              onClick={onClose}
              className="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"
            >
              Cancelar
            </button>
            <button
              type="submit"
              className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
            >
              Aceptar
            </button>
          </div>
        </form>
      </div>
    </div>
  )
}

export default NameModal

/* Fin src\components\menu\NameModal.tsx */

/* Inicio src\components\menu\partials\OrderReview.tsx */
/* src/components/menu/partials/OrderReview.tsx */
import { Typography } from '@mui/material'
import React from 'react'
import { MenuItem as MenuItemType } from '../../../context/AppContext'
import PedidoForm from '../../forms/PedidoForm'
import { Person, SharedOrderItem } from '../GroupOrderPage'

interface OrderReviewProps {
  people: Person[]
  sharedOrderItems: SharedOrderItem[]
  menu: MenuItemType[]
  onClosePedidoForm: () => void
  calculateSharedSubtotal: () => number
  calculateSubtotal: (personItems: { id: string; quantity: number }[]) => number
  isOrderOwner: boolean
  onOrderPlaced: () => void
  orderPlaced: boolean
  showPricesToAll?: boolean
  onToggleShowPrices: () => void
}

const OrderReview: React.FC<OrderReviewProps> = ({
  people,
  sharedOrderItems,
  menu,
  onClosePedidoForm,
  calculateSharedSubtotal,
  calculateSubtotal,
  isOrderOwner,
  onOrderPlaced,
  orderPlaced,
  showPricesToAll = false,
  onToggleShowPrices,
}) => {
  // Formatear a moneda
  const formatPriceCOP = (price: number) => {
    return price.toLocaleString('es-CO', {
      style: 'currency',
      currency: 'COP',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    })
  }

  // Calculamos totales usando las funciones pasadas por props
  const totalShared = calculateSharedSubtotal()
  const totalIndividuals = people.reduce((sum, person) => {
    return sum + calculateSubtotal(person.items)
  }, 0)
  const totalOrderAmount = totalShared + totalIndividuals

  // Quién ve los precios
  const canViewPrices = isOrderOwner || showPricesToAll

  const handlePedidoFormClose = () => {
    onClosePedidoForm()
    onOrderPlaced() // Indica que se confirmó el pedido
  }

  return (
    <div className="max-w-2xl mx-auto p-6 bg-white rounded-xl shadow-md animate-fade-in">
      <h2 className="text-2xl font-bold text-gray-900 mb-6 text-center text-indigo-700">
        Revisión Detallada del Pedido Grupal 🧐
      </h2>

      {/* Toggle para mostrar/ocultar precios al resto, solo si orderPlaced y soy owner */}
      {isOrderOwner && orderPlaced && (
        <div className="flex justify-center mb-6">
          <label className="flex items-center cursor-pointer">
            <input
              type="checkbox"
              className="form-checkbox h-5 w-5 text-indigo-600"
              checked={showPricesToAll}
              onChange={onToggleShowPrices}
            />
            <span className="ml-2 text-gray-800">Mostrar Precios a Todos</span>
          </label>
        </div>
      )}

      {/* Items Compartidos */}
      {sharedOrderItems && sharedOrderItems.length > 0 && (
        <div className="mb-6 p-4 border rounded-lg shadow-sm bg-gray-50">
          <h3 className="text-lg font-semibold text-gray-900 mb-3 text-indigo-600">
            Detalle del Pedido Compartido 🤝
          </h3>
          <ul>
            {sharedOrderItems.map((sharedItem) => {
              const menuItem = menu.find((m) => m.id === sharedItem.itemId)
              if (!menuItem) return null
              const itemTotal = menuItem.price * sharedItem.quantity
              return (
                <li key={sharedItem.itemId} className="py-2 flex items-center justify-between">
                  <div className="flex items-center">
                    <span className="mr-2">{menuItem.name}</span>
                    <span className="text-sm text-gray-500">x {sharedItem.quantity}</span>
                  </div>
                  {canViewPrices && (
                    <span className="w-12 text-right">{formatPriceCOP(itemTotal)}</span>
                  )}
                </li>
              )
            })}
          </ul>
          {canViewPrices && (
            <div className="font-semibold text-right mt-2">
              Subtotal Compartido:
              <span className="text-indigo-700 ml-1">{formatPriceCOP(totalShared)}</span>
            </div>
          )}
        </div>
      )}

      {/* Items de cada persona */}
      {people.map((person) => {
        const personSubtotal = calculateSubtotal(person.items)
        return (
          <div key={person.personIndex} className="mb-6 p-4 border rounded-lg shadow-sm bg-gray-50">
            <h3 className="text-lg font-semibold text-gray-900 mb-3 text-indigo-600">
              Detalle del Pedido Individual - {person.name} 👤
            </h3>
            <ul>
              {person.items.map((it) => {
                const menuItem = menu.find((m) => m.id === it.id)
                if (!menuItem) return null
                const itemTotal = menuItem.price * it.quantity
                return (
                  <li key={it.id} className="py-2 flex items-center justify-between">
                    <div className="flex items-center">
                      <span className="mr-2">{menuItem.name}</span>
                      <span className="text-sm text-gray-500">x {it.quantity}</span>
                    </div>
                    {canViewPrices && (
                      <span className="w-12 text-right">{formatPriceCOP(itemTotal)}</span>
                    )}
                  </li>
                )
              })}
            </ul>
            {canViewPrices && (
              <div className="font-semibold text-right mt-2">
                Subtotal Individual:
                <span className="text-indigo-700 ml-1">{formatPriceCOP(personSubtotal)}</span>
              </div>
            )}
          </div>
        )
      })}

      {/* Totales finales */}
      {canViewPrices && (
        <div className="mb-6 p-4 border rounded-lg shadow-sm bg-gray-100">
          <h3 className="text-xl font-semibold text-gray-900 mb-3 text-indigo-600 text-center">
            Resumen del Pedido Grupal Completo 💰
          </h3>
          <div className="flex justify-between items-center">
            <div className="font-semibold text-gray-700">
              <Typography>Subtotal Compartido:</Typography>
              {people.map((person) => (
                <Typography key={person.personIndex}>Subtotal {person.name}:</Typography>
              ))}
              <Typography className="font-bold mt-2">Total del Pedido:</Typography>
            </div>
            <div className="text-right font-semibold text-xl text-indigo-700">
              <Typography>{formatPriceCOP(totalShared)}</Typography>
              {people.map((person) => (
                <Typography key={person.personIndex}>
                  {formatPriceCOP(calculateSubtotal(person.items))}
                </Typography>
              ))}
              <Typography className="font-bold mt-2">{formatPriceCOP(totalOrderAmount)}</Typography>
            </div>
          </div>
        </div>
      )}

      {/* Si no se ha colocado el pedido, renderizar el form */}
      {!orderPlaced && (
        <PedidoForm
          onClose={handlePedidoFormClose}
          people={people}
          sharedOrderItems={sharedOrderItems}
        />
      )}
      {orderPlaced && (
        <div className="text-center mt-6">
          <Typography variant="h6" className="text-green-600">
            ¡Pedido realizado con éxito!
          </Typography>
        </div>
      )}
    </div>
  )
}

export default OrderReview

/* Fin src\components\menu\partials\OrderReview.tsx */

/* Inicio src\components\menu\partials\PeopleSelection.tsx */
import React from "react";
import { Person } from "../GroupOrderPage";

interface PeopleSelectionProps {
  numPeople: number;
  people: Person[];
  onNumPeopleChange: (event: React.ChangeEvent<HTMLInputElement>) => void;
  onPersonNameChange: (index: number, name: string) => void;
  onStartOrder: () => void;
}

const PeopleSelection: React.FC<PeopleSelectionProps> = ({
  numPeople,
  people,
  onNumPeopleChange,
  onPersonNameChange,
  onStartOrder,
}) => {
  return (
    <div className="mb-8 text-center">
      <h2 className="text-xl font-semibold text-gray-800 mb-4">
        ¿Cuántos son hoy?
      </h2>
      <div className="flex flex-col items-center space-y-4">
        <div className="flex items-center space-x-4">
          <label
            htmlFor="numPeople"
            className="block text-gray-700 text-sm font-bold"
          >
            Somos:
          </label>
          <input
            type="number"
            id="numPeople"
            value={numPeople}
            onChange={onNumPeopleChange}
            min="1"
            className="shadow appearance-none border rounded w-20 py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-center"
          />
          <span className="text-gray-700 text-sm font-bold">Personas</span>
        </div>
        {Array.from({ length: numPeople }).map((_, index) => (
          <input
            key={index}
            type="text"
            placeholder={`Nombre Persona ${index + 1}`}
            className="shadow appearance-none border rounded w-full max-w-sm py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
            value={people[index]?.name || ""}
            onChange={(e) => onPersonNameChange(index, e.target.value)}
          />
        ))}
      </div>

      <button
        className="mt-6 bg-indigo-500 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-xl focus:outline-none focus:shadow-outline transition-colors duration-300"
        onClick={onStartOrder}
      >
        ¡A Pedir! 🚀
      </button>
    </div>
  );
};
export default PeopleSelection;
/* Fin src\components\menu\partials\PeopleSelection.tsx */

/* Inicio src\components\menu\partials\PersonOrder.tsx */
/* Inicio src\components\menu\partials\PersonOrder.tsx */
import React from "react";
import { MenuItem as MenuItemType } from "../../../context/AppContext";
import { Person } from "../GroupOrderPage"; // Import the Person interface from GroupOrderPage

interface PersonOrderProps {
  person: Person; // Use the imported Person interface here
  index: number;
  menuCategories: { [category: string]: MenuItemType[] };
  menu: MenuItemType[];
  onAddItemToPerson: (personIndex: number, item: MenuItemType) => void;
  onPersonOrderItemQuantityChange: (
    personIndex: number,
    itemId: string,
    quantity: number
  ) => void;
  onRemoveItemFromPerson: (personIndex: number, itemId: string) => void;
  calculateSubtotal: (
    personItems: { id: string; quantity: number }[]
  ) => number;
  personOrderSummaryRef: React.RefObject<HTMLDivElement>;
  activeTab: string;
  onPersonFinishedOrder: (personIndex: number) => void;
  isFinished: boolean;
  personLocked: boolean; // Prop to indicate if the tab is locked
  isCurrentUserTab: boolean; // Prop to check if it's the current user's tab
  personIndex: number;
  disabled?: boolean; // Prop to disable interactions
}

const PersonOrder: React.FC<PersonOrderProps> = ({
  person,
  index,
  menuCategories,
  menu,
  onAddItemToPerson,
  onPersonOrderItemQuantityChange,
  onRemoveItemFromPerson,
  calculateSubtotal,
  personOrderSummaryRef,
  onPersonFinishedOrder,
  isFinished,
  personLocked,
  isCurrentUserTab,
  personIndex,
  disabled = false, // Default to false
}) => {
  // Function to format price to Colombian Pesos
  const formatPriceCOP = (price: number) => {
    return price.toLocaleString("es-CO", {
      style: "currency",
      currency: "COP",
      minimumFractionDigits: 0, // Remove cents if whole number
      maximumFractionDigits: 0,
    });
  };

  const isControlEnabled = (!personLocked || isCurrentUserTab) && !disabled; // Add disabled prop check

  return (
    <div key={person.personIndex} className="mb-8" ref={personOrderSummaryRef}>
      <div
        className={`sticky top-16 bg-white p-4 shadow-md z-20 rounded-md transition-transform duration-200 ease-out transform translate-y-0 hover:translate-y-[-2px] ring-2 ring-indigo-500 ring-opacity-50 hover:ring-opacity-100`}
      >
        <h2 className="text-xl font-semibold text-gray-900 mb-4 text-center">
          Pedido de {person.name || `Persona ${index + 1}`} 😋
          {personLocked && !isCurrentUserTab && (
            <span className="ml-2 text-red-500">🔒 (Viendo)</span>
          )}
        </h2>
        <ul className="mb-4">
          {person.items.map((it) => {
            const menuItem = menu.find((m) => m.id === it.id);
            return menuItem ? (
              <li
                key={it.id} // Added key prop here
                className="flex justify-between items-center py-2 border-b border-gray-200"
              >
                <span className="flex-1 min-w-0">{menuItem.name}</span>
                <div className="flex items-center space-x-2">
                  <button
                    onClick={() =>
                      onPersonOrderItemQuantityChange(
                        personIndex,
                        it.id,
                        it.quantity - 1
                      )
                    }
                    className="p-1 rounded-full hover:bg-gray-200 transition-colors duration-200"
                    disabled={!isControlEnabled}
                  >
                    -
                  </button>
                  <span className="w-6 text-center">{it.quantity}</span>
                  <button
                    onClick={() =>
                      onPersonOrderItemQuantityChange(
                        personIndex,
                        it.id,
                        it.quantity + 1
                      )
                    }
                    className="p-1 rounded-full hover:bg-gray-200 transition-colors duration-200"
                    disabled={!isControlEnabled}
                  >
                    +
                  </button>
                  <button
                    onClick={() => onRemoveItemFromPerson(personIndex, it.id)}
                    className="text-red-500 hover:text-red-700 transition-colors duration-200"
                    disabled={!isControlEnabled}
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                      strokeWidth="1.5"
                      stroke="currentColor"
                      className="w-5 h-5"
                    >
                      <path
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        d="M14.74 9l-.346 9m-.478 0l-.345-9m7.021-2.01C18.692 6.905 17.127 5.536 15.313 5.536H8.687C6.873 5.536 5.308 6.905 5.308 8.72v.81c0 1.18.914 2.12 2.094 2.201l1.652.072m7.324 0l1.652-.072a2.094 2.094 0 002.094-2.201v-.81c0-1.814-1.365-3.183-3.187-3.183zm-2.961 8.903L15.7 11.855m-2.606 5.15l-2.796-5.15m5.136 0l-2.794 5.15z"
                      />
                    </svg>
                  </button>
                </div>
                <span className="w-12 text-right">
                  {formatPriceCOP(menuItem.price * it.quantity)}
                </span>
              </li>
            ) : null;
          })}
          {person.items.length > 0 && (
            <li className="font-semibold text-right mt-2">
              Subtotal:{" "}
              <span className="text-indigo-700">
                {formatPriceCOP(calculateSubtotal(person.items))}
              </span>
            </li>
          )}
        </ul>
        <div className="flex justify-end">
          {" "}
          {/* Container for button at the bottom */}
          {!isFinished && (
            <button
              onClick={() => onPersonFinishedOrder(personIndex)}
              className="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
              disabled={!isControlEnabled || isFinished} // Disable if PedidoForm is open or already finished
            >
              He Terminado!
            </button>
          )}
          {isFinished && (
            <span className="text-green-600 font-semibold">
              ¡Pedido Terminado! ✅
            </span>
          )}
        </div>
      </div>

      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        {Object.entries(menuCategories).map(([categoryName, items]) => (
          <div
            key={categoryName}
            className="transition-all duration-300 transform hover:scale-105"
          >
            <h3 className="font-bold text-lg text-gray-900 mb-2 text-indigo-500">
              {categoryName}
            </h3>
            <div className="flex flex-col space-y-2">
              {items.map(
                (
                  menuItem // Changed parameter name to menuItem here
                ) => (
                  <button
                    key={menuItem.id}
                    disabled={
                      menuItem.availabilityStatus !== "disponible" ||
                      !isControlEnabled
                    }
                    className={`bg-gray-100 hover:bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded focus:outline-none focus:shadow-outline text-left transition-colors duration-300 ${
                      menuItem.availabilityStatus !== "disponible"
                        ? "opacity-50 cursor-not-allowed line-through pointer-events-none"
                        : ""
                    }`}
                    onClick={() => {
                      console.log(
                        "PersonOrder - onAddItemToPerson CALL",
                        personIndex,
                        menuItem
                      ); // ADD THIS LOG - Log in PersonOrder.tsx
                      onAddItemToPerson(personIndex, menuItem);
                    }}
                  >
                    {menuItem.name} - {formatPriceCOP(menuItem.price)}{" "}
                    {/* Use menuItem here */}
                    {menuItem.availabilityStatus === "noDisponibleMomento" && (
                      <span className="ml-2 text-yellow-500 font-normal italic">
                        (No disponible ahora)
                      </span>
                    )}
                    {menuItem.availabilityStatus ===
                      "noDisponibleLargoPlazo" && (
                      <span className="ml-2 text-red-500 font-normal italic">
                        (Ya no disponible)
                      </span>
                    )}
                  </button>
                )
              )}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

export default PersonOrder;

/* Fin src\components\menu\partials\PersonOrder.tsx */

/* Fin src\components\menu\partials\PersonOrder.tsx */

/* Inicio src\components\menu\partials\SharedOrder.tsx */
/* Inicio src\components\menu\partials\SharedOrder.tsx */
import React from "react";
import { MenuItem as MenuItemType } from "../../../context/AppContext";

interface SharedOrderProps {
  menuCategories: { [category: string]: MenuItemType[] };
  sharedOrderItems: { itemId: string; quantity: number; personIds: string[] }[];
  onAddToSharedOrder: (item: MenuItemType) => void;
  onSharedOrderItemQuantityChange: (itemId: string, quantity: number) => void;
  onRemoveSharedOrderItem: (itemId: string) => void;
  calculateSharedSubtotal: () => number;
  sharedOrderSummaryRef: React.RefObject<HTMLDivElement>;
  activeTab: string;
  menu: MenuItemType[];
  disabled?: boolean; // Prop to disable interactions
}

const SharedOrder: React.FC<SharedOrderProps> = ({
  menuCategories,
  sharedOrderItems,
  onAddToSharedOrder,
  onSharedOrderItemQuantityChange,
  onRemoveSharedOrderItem,
  calculateSharedSubtotal,
  sharedOrderSummaryRef,
  menu,
  disabled = false, // Default to false
}) => {
  // Function to format price to Colombian Pesos
  const formatPriceCOP = (price: number) => {
    return price.toLocaleString("es-CO", {
      style: "currency",
      currency: "COP",
      minimumFractionDigits: 0, // Remove cents if whole number
      maximumFractionDigits: 0,
    });
  };

  return (
    <div className="mb-8">
      <div
        className="sticky top-16 bg-white p-4 shadow-md z-20 rounded-md transition-transform duration-200 ease-out transform translate-y-0 hover:translate-y-[-2px] ring-2 ring-indigo-500 ring-opacity-50 hover:ring-opacity-100"
        ref={sharedOrderSummaryRef}
      >
        <h2 className="text-2xl font-bold text-gray-900 mb-4 text-center">
          Pedido para Compartir 🤝
        </h2>
        <ul className="mb-4">
          {sharedOrderItems.map((sharedItem) => {
            const menuItem = menu.find((m) => m.id === sharedItem.itemId);
            return menuItem ? (
              <li
                key={sharedItem.itemId}
                className="flex justify-between items-center py-2 border-b border-gray-200"
              >
                <span className="flex-1 min-w-0">{menuItem.name}</span>
                <div className="flex items-center space-x-2">
                  <button
                    onClick={() =>
                      onSharedOrderItemQuantityChange(
                        sharedItem.itemId,
                        sharedItem.quantity - 1
                      )
                    }
                    className="p-1 rounded-full hover:bg-gray-200 transition-colors duration-200"
                    disabled={disabled} // Disable button if prop disabled is true
                  >
                    -
                  </button>
                  <span className="w-6 text-center">{sharedItem.quantity}</span>
                  <button
                    onClick={() =>
                      onSharedOrderItemQuantityChange(
                        sharedItem.itemId,
                        sharedItem.quantity + 1
                      )
                    }
                    className="p-1 rounded-full hover:bg-gray-200 transition-colors duration-200"
                    disabled={disabled} // Disable button if prop disabled is true
                  >
                    +
                  </button>
                  <button
                    onClick={() => onRemoveSharedOrderItem(sharedItem.itemId)}
                    className="text-red-500 hover:text-red-700 transition-colors duration-200"
                    disabled={disabled} // Disable button if prop disabled is true
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                      strokeWidth="1.5"
                      stroke="currentColor"
                      className="w-5 h-5"
                    >
                      <path
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        d="M14.74 9l-.346 9m-.478 0l-.345-9m7.021-2.01C18.692 6.905 17.127 5.536 15.313 5.536H8.687C6.873 5.536 5.308 6.905 5.308 8.72v.81c0 1.18.914 2.12 2.094 2.201l1.652.072m7.324 0l1.652-.072a2.094 2.094 0 002.094-2.201v-.81c0-1.814-1.365-3.183-3.187-3.183zm-2.961 8.903L15.7 11.855m-2.606 5.15l-2.796-5.15m5.136 0l-2.794 5.15z"
                      />
                    </svg>
                  </button>
                </div>
                <span className="w-12 text-right">
                  {formatPriceCOP(menuItem.price * sharedItem.quantity)}
                </span>
              </li>
            ) : null;
          })}
          {sharedOrderItems.length > 0 && (
            <li className="font-semibold text-right mt-2">
              Subtotal:{" "}
              <span className="text-indigo-700">
                {formatPriceCOP(calculateSharedSubtotal())}
              </span>
            </li>
          )}
        </ul>
      </div>
      <p className="text-gray-600 mb-4 text-center mt-4">
        ¿Algo más para compartir? ¡Elige del menú!
      </p>
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-4">
        {Object.entries(menuCategories).map(([categoryName, items]) => (
          <div
            key={categoryName}
            className="transition-all duration-300 transform hover:scale-105"
          >
            <h3 className="font-bold text-lg text-gray-900 mb-2 text-indigo-500">
              {categoryName}
            </h3>
            <div className="flex flex-col space-y-2">
              {items.map((item) => (
                <button
                  key={item.id}
                  disabled={
                    item.availabilityStatus !== "disponible" || disabled
                  } // Disable button if prop disabled is true or item not available
                  className={`bg-gray-100 hover:bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded focus:outline-none focus:shadow-outline text-left transition-colors duration-300 ${
                    item.availabilityStatus !== "disponible"
                      ? "opacity-50 cursor-not-allowed line-through pointer-events-none"
                      : ""
                  }`}
                  onClick={
                    item.availabilityStatus === "disponible" && !disabled // Only allow click if available and not disabled
                      ? () => onAddToSharedOrder(item)
                      : undefined
                  }
                >
                  {item.name} - {formatPriceCOP(item.price)}
                  {item.availabilityStatus === "noDisponibleMomento" && (
                    <span className="ml-2 text-yellow-500 font-normal italic">
                      (No disponible ahora)
                    </span>
                  )}
                  {item.availabilityStatus === "noDisponibleLargoPlazo" && (
                    <span className="ml-2 text-red-500 font-normal italic">
                      (Ya no disponible)
                    </span>
                  )}
                </button>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

export default SharedOrder;

/* Fin src\components\menu\partials\SharedOrder.tsx */

/* Fin src\components\menu\partials\SharedOrder.tsx */

/* Inicio src\components\menu\PersonMenuModal.tsx */
/* eslint-disable @typescript-eslint/no-misused-promises */
// src/components/menu/PersonMenuModal.tsx
import { Timestamp, addDoc, collection } from 'firebase/firestore'
import React, { useEffect, useState } from 'react'
import { v4 as uuidv4 } from 'uuid'
import { useAuth } from '../../hooks/useAuth'
import { useMenu } from '../../hooks/useMenu'
import { db } from '../../utils/firebase'

interface PedidoFormProps {
  onClose: () => void
  people?: {
    id: string
    name: string
    items: { id: string; quantity: number }[]
  }[]
  sharedOrderItems?: {
    itemId: string
    quantity: number
    personIds: string[]
  }[]
}

const PersonMenuModal: React.FC<PedidoFormProps> = ({ onClose, people, sharedOrderItems }) => {
  const { menu } = useMenu()
  const { user, addPoints } = useAuth()
  const [items, setItems] = useState<
    {
      id: string
      quantity: number
      assignedTo: string
    }[]
  >([])

  const [peopleOrder, setPeopleOrder] = useState<{ id: string; name: string }[]>([])
  const [sede, setSede] = useState('')
  const [deliveryFee, setDeliveryFee] = useState(0)
  const [deliveryIncluded, setDeliveryIncluded] = useState(true)
  const [paymentMethod, setPaymentMethod] = useState('contraentrega')

  useEffect(() => {
    if (people) {
      setPeopleOrder(people.map((person) => ({ id: person.id, name: person.name })))
      const newItems = people.flatMap((person) =>
        person.items.map((item) => ({
          id: item.id,
          quantity: item.quantity,
          assignedTo: person.name,
        })),
      )
      setItems(newItems)
    }
  }, [people])

  // Simulación de sedes
  const sedesDisponibles = ['Sede Norte', 'Sede Sur', 'Sede Centro']
  useEffect(() => {
    if (sedesDisponibles.length === 1) {
      setSede(sedesDisponibles[0])
    }
  }, [sedesDisponibles])

  const calculateTotal = () => {
    let total = 0
    items.forEach((item) => {
      const menuItem = menu.find((m) => m.id === item.id)
      if (menuItem) {
        total += menuItem.price * item.quantity
      }
    })
    return total + deliveryFee
  }

  const handleSubmit = async (event: React.FormEvent) => {
    event.preventDefault()
    // Permitir envío aunque no se esté autenticado
    const uid = user ? user.uid : null
    try {
      const total = calculateTotal()
      const orderId = uuidv4()
      const orderData = {
        userId: uid,
        items: items.map((item) => ({
          id: item.id,
          quantity: item.quantity,
          assignedTo: item.assignedTo,
        })),
        people: peopleOrder,
        sede,
        status: 'pendiente',
        total,
        deliveryFee,
        deliveryIncluded,
        paymentMethod,
        orderDate: Timestamp.now(),
        orderId,
        sharedItems: sharedOrderItems
          ? sharedOrderItems.map((si) => ({
              itemId: si.itemId,
              personIds: si.personIds,
            }))
          : [],
      }

      await addDoc(collection(db, 'pedidos'), orderData)
      if (user) {
        await addPoints()
        alert('Pedido realizado con éxito y puntos sumados.')
      } else {
        alert('Pedido realizado con éxito.')
      }
      onClose()
    } catch (error) {
      console.error('Error al agregar el pedido:', error)
    }
  }

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      <h2 className="text-xl font-bold text-gray-900">Realizar Pedido</h2>
      <div>
        <label htmlFor="sede" className="block text-sm font-medium text-gray-700">
          Sede
        </label>
        <select
          id="sede"
          value={sede}
          onChange={(e) => setSede(e.target.value)}
          required
          className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
        >
          {sedesDisponibles.map((sedeItem) => (
            <option key={sedeItem} value={sedeItem}>
              {sedeItem}
            </option>
          ))}
        </select>
      </div>
      <div>
        <label htmlFor="deliveryFee" className="block text-sm font-medium text-gray-700">
          Costo de Envío
        </label>
        <input
          type="number"
          id="deliveryFee"
          value={deliveryFee}
          onChange={(e) => setDeliveryFee(parseFloat(e.target.value))}
          required
          min="0"
          className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
        />
      </div>
      <div className="flex items-start">
        <div className="flex items-center h-5">
          <input
            id="deliveryIncluded"
            name="deliveryIncluded"
            type="checkbox"
            checked={deliveryIncluded}
            onChange={(e) => setDeliveryIncluded(e.target.checked)}
            className="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded"
          />
        </div>
        <div className="ml-2 text-sm">
          <label htmlFor="deliveryIncluded" className="font-medium text-gray-700">
            ¿El domicilio está incluido?
          </label>
        </div>
      </div>
      <div>
        <label htmlFor="paymentMethod" className="block text-sm font-medium text-gray-700">
          Método de Pago
        </label>
        <select
          id="paymentMethod"
          value={paymentMethod}
          onChange={(e) => setPaymentMethod(e.target.value)}
          required
          className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
        >
          <option value="contraentrega">Contraentrega</option>
        </select>
      </div>
      <div>
        <button
          type="submit"
          className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-500 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"
        >
          Realizar Pedido
        </button>
      </div>
    </form>
  )
}

export default PersonMenuModal

/* Fin src\components\menu\PersonMenuModal.tsx */

/* Inicio src\components\payment\PaymentForm.tsx */
import { Alert, Button } from "@mui/material";
import React, { useEffect, useState } from "react";
import {
  createCheckoutSession,
  handlePaymentNotification,
  processPayment,
} from "../../payment/payment";

interface PaymentFormProps {
  amount: number;
  orderId: string;
  onSuccess: () => void;
}
const PaymentForm: React.FC<PaymentFormProps> = ({
  amount,
  onSuccess,
  orderId,
}) => {
  const [loading, setLoading] = useState<boolean>(false);
  const [error, setError] = useState<string | null>(null);
  const [publicKey, setPublicKey] = useState<string | null>(null);
  const [paymentResult] = useState<string | null>(null);
  useEffect(() => {
    const loadPublicKey = async () => {
      setPublicKey("YOUR_STRIPE_PUBLIC_KEY");
    };
    loadPublicKey();
  }, []);

  const handlePayment = async () => {
    setLoading(true);
    setError(null);
    try {
      if (!publicKey) {
        setError("Clave publica no encontrada");
        setLoading(false);
        setTimeout(() => setError(null), 5000);
        return;
      }
      const sessionId = await createCheckoutSession(amount, orderId);
      await processPayment(sessionId, publicKey);
      const response = await handlePaymentNotification(sessionId);
      if (response) {
        setLoading(false);
        onSuccess();
      } else {
        throw new Error("Error al procesar el pago");
      }
    } catch (error) {
      setError(error.message);
      setLoading(false);
      setTimeout(() => setError(null), 5000);
    }
  };

  return (
    <>
      {error && <Alert severity="error">{error}</Alert>}
      {paymentResult === "success" && (
        <Alert severity="success">Pago Exitoso</Alert>
      )}
      {paymentResult === "failure" && (
        <Alert severity="error">Pago Fallido</Alert>
      )}
      {paymentResult === "pending" && (
        <Alert severity="info">Pago Pendiente</Alert>
      )}
      <Button
        variant="contained"
        color="primary"
        onClick={handlePayment}
        disabled={loading}
      >
        {loading ? "Procesando" : "Pagar"}
      </Button>
    </>
  );
};
export default PaymentForm;

/* Fin src\components\payment\PaymentForm.tsx */

/* Inicio src\components\pedidos\PedidoForm.tsx */
// src/components/pedidos/PedidoForm.tsx
import { Timestamp, addDoc, collection } from 'firebase/firestore'
import React, { useEffect, useState } from 'react'
import { v4 as uuidv4 } from 'uuid'
import { useAuth } from '../../hooks/useAuth'
import { useMenu } from '../../hooks/useMenu'
import { db } from '../../utils/firebase'

/** Mismo tipo que uses en GroupOrderPage */
interface Person {
  personIndex: number
  userId: string | null
  name: string
  items: { id: string; quantity: number }[]
  locked?: boolean
  finished?: boolean
}

interface SharedOrderItem {
  itemId: string
  quantity: number
  personIds: string[]
}

interface PedidoFormProps {
  onClose: () => void
  people?: Person[] // Aquí usamos la interface Person
  sharedOrderItems?: SharedOrderItem[]
}

const PedidoForm: React.FC<PedidoFormProps> = ({ onClose, people, sharedOrderItems }) => {
  const { menu } = useMenu()
  const { user, addPoints } = useAuth()
  const [items, setItems] = useState<
    {
      id: string
      quantity: number
      assignedTo: string
    }[]
  >([])

  const [peopleOrder, setPeopleOrder] = useState<{ userId: string | null; name: string }[]>([])
  const [sede, setSede] = useState('')
  const [deliveryFee, setDeliveryFee] = useState(0)
  const [deliveryIncluded, setDeliveryIncluded] = useState(true)
  const [paymentMethod, setPaymentMethod] = useState('contraentrega')

  useEffect(() => {
    // Convertimos people en un estado con 'peopleOrder'
    if (people) {
      const mapped = people.map((p) => ({
        userId: p.userId,
        name: p.name,
      }))
      setPeopleOrder(mapped)

      // Flatten person items
      const personItems = people.flatMap((person) =>
        person.items.map((item) => ({
          id: item.id,
          quantity: item.quantity,
          assignedTo: person.name,
        })),
      )
      setItems(personItems)
    }
  }, [people])

  useEffect(() => {
    if (sharedOrderItems) {
      // Flatten shared items -> assignedTo: 'Compartido'
      const sharedItemsForDisplay = sharedOrderItems.flatMap((sharedItem) =>
        Array(sharedItem.quantity)
          .fill(null)
          .map(() => ({
            id: sharedItem.itemId,
            quantity: 1,
            assignedTo: 'Compartido',
          })),
      )
      setItems((prev) => [...prev, ...sharedItemsForDisplay])
    }
  }, [sharedOrderItems])

  // Simulación sedes
  const sedesDisponibles = ['Sede Norte', 'Sede Sur', 'Sede Centro']
  useEffect(() => {
    if (sedesDisponibles.length === 1) {
      setSede(sedesDisponibles[0])
    }
  }, [sedesDisponibles])

  const calculateTotal = () => {
    let total = 0
    items.forEach((item) => {
      const menuItem = menu.find((m) => m.id === item.id)
      if (menuItem) {
        total += menuItem.price * item.quantity
      }
    })
    return total + deliveryFee
  }

  const handleSubmit = async (event: React.FormEvent) => {
    event.preventDefault()
    if (!user) return

    try {
      const total = calculateTotal()
      const orderId = uuidv4()
      const orderData = {
        userId: user.uid,
        items: items.map((item) => ({
          id: item.id,
          quantity: item.quantity,
          assignedTo: item.assignedTo,
        })),
        people: peopleOrder,
        sede,
        status: 'pendiente',
        total,
        deliveryFee,
        deliveryIncluded,
        paymentMethod,
        orderDate: Timestamp.now(),
        orderId,
        sharedItems: sharedOrderItems
          ? sharedOrderItems.map((si) => ({
              itemId: si.itemId,
              quantity: si.quantity,
              personIds: si.personIds,
            }))
          : [],
      }

      await addDoc(collection(db, 'pedidos'), orderData)
      void handlePaymentSuccess()
    } catch (error) {
      console.error('Error al agregar el pedido:', error)
    }
  }

  const handlePaymentSuccess = async () => {
    await addPoints()
    alert('Pedido realizado con éxito y puntos sumados.')
    onClose()
  }

  return (
    <form onSubmit={void handleSubmit} className="space-y-6">
      <h2 className="text-xl font-bold text-gray-900">Realizar Pedido</h2>
      <div>
        <label htmlFor="sede" className="block text-sm font-medium text-gray-700">
          Sede
        </label>
        <select
          id="sede"
          value={sede}
          onChange={(e) => setSede(e.target.value)}
          required
          className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
        >
          {sedesDisponibles.map((sedeItem) => (
            <option key={sedeItem} value={sedeItem}>
              {sedeItem}
            </option>
          ))}
        </select>
      </div>
      <div>
        <label htmlFor="deliveryFee" className="block text-sm font-medium text-gray-700">
          Costo de Envío
        </label>
        <input
          type="number"
          id="deliveryFee"
          value={deliveryFee}
          onChange={(e) => setDeliveryFee(parseFloat(e.target.value))}
          required
          min="0"
          className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
        />
      </div>
      <div className="flex items-start">
        <div className="flex items-center h-5">
          <input
            id="deliveryIncluded"
            name="deliveryIncluded"
            type="checkbox"
            checked={deliveryIncluded}
            onChange={(e) => setDeliveryIncluded(e.target.checked)}
            className="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded"
          />
        </div>
        <div className="ml-2 text-sm">
          <label htmlFor="deliveryIncluded" className="font-medium text-gray-700">
            ¿El domicilio está incluido?
          </label>
        </div>
      </div>
      <div>
        <label htmlFor="paymentMethod" className="block text-sm font-medium text-gray-700">
          Método de Pago
        </label>
        <select
          id="paymentMethod"
          value={paymentMethod}
          onChange={(e) => setPaymentMethod(e.target.value)}
          required
          className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
        >
          <option value="contraentrega">Contraentrega</option>
        </select>
      </div>
      <div>
        <button
          type="submit"
          className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-500 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"
        >
          Realizar Pedido3
        </button>
      </div>
    </form>
  )
}

export default PedidoForm

/* Fin src\components\pedidos\PedidoForm.tsx */

/* Inicio src\components\pedidos\PedidoItem.tsx */
import React from "react";

const PedidoItem: React.FC = () => {
    return (
        <div>Pedido Item</div>
    )
}

export default PedidoItem;
/* Fin src\components\pedidos\PedidoItem.tsx */

/* Inicio src\components\pedidos\PedidoList.tsx */
/* Directorio: src\components\pedidos */
/* Inicio src\components\pedidos\PedidoList.tsx */
// src/components/pedidos/PedidoList.tsx
import {
  collection,
  doc,
  onSnapshot,
  query,
  updateDoc,
  where,
} from "firebase/firestore";
import React, { useEffect, useState } from "react";
import { useAuth } from "../../hooks/useAuth";
import { useMenu } from "../../hooks/useMenu"; // Import useMenu hook
import { COLLECTIONS } from "../../utils/constants";
import { db } from "../../utils/firebase";

interface Pedido {
  id: string;
  userId: string;
  items: { id: string; quantity: number; assignedTo: string }[];
  people: { id: string; name: string }[];
  sede: string;
  status: string;
  total: number;
  deliveryFee: number;
  deliveryIncluded: boolean;
  paymentMethod: string;
  orderDate: Date;
  orderId: string;
  sharedItems?: {
    itemId: string;
    quantity: number;
    personIds: string[];
  }[];
}

const PedidoList: React.FC = () => {
  const [pedidos, setPedidos] = useState<Pedido[]>([]);
  const { user, userRole } = useAuth();
  const { menu } = useMenu(); // Use useMenu hook to get menu data
  const [selectedStatus, setSelectedStatus] = useState("pendiente");
  const [openDetails, setOpenDetails] = useState(false);
  const [selectedPedidoDetails, setSelectedPedidoDetails] =
    useState<Pedido | null>(null);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    if (!user) return;

    setLoading(true);
    let pedidosQuery = query(collection(db, COLLECTIONS.PEDIDOS));

    if (userRole === "client") {
      pedidosQuery = query(
        collection(db, COLLECTIONS.PEDIDOS),
        where("userId", "==", user.uid)
      );
    } else if (userRole === "admin" || userRole === "encargado") {
      pedidosQuery = query(
        collection(db, COLLECTIONS.PEDIDOS),
        where("status", "==", selectedStatus)
      );
    }

    const unsubscribe = onSnapshot(pedidosQuery, (snapshot) => {
      const pedidosData = snapshot.docs.map((doc) => {
        const data = doc.data();
        return {
          id: doc.id,
          userId: data.userId,
          items: data.items || [],
          people: data.people || [],
          sede: data.sede,
          status: data.status,
          total: data.total,
          deliveryFee: data.deliveryFee,
          deliveryIncluded: data.deliveryIncluded,
          paymentMethod: data.paymentMethod,
          orderDate: data.orderDate ? data.orderDate.toDate() : new Date(),
          orderId: data.orderId,
          sharedItems: data.sharedItems || [],
        } as Pedido;
      });
      setPedidos(pedidosData);
      setLoading(false);
    });

    return () => unsubscribe();
  }, [user, userRole, selectedStatus]);

  const handleStatusChange = (event: React.ChangeEvent<HTMLSelectElement>) => {
    setSelectedStatus(event.target.value);
  };

  const handleStatusUpdate = async (orderId: string, newStatus: string) => {
    try {
      await updateDoc(doc(db, COLLECTIONS.PEDIDOS, orderId), {
        status: newStatus,
      });
    } catch (error) {
      console.error(
        "Error updating order status:",
        (error as { message: string }).message
      );
    }
  };

  const handleOpenDetails = (order: Pedido) => {
    setSelectedPedidoDetails(order);
    setOpenDetails(true);
  };

  const handleCloseDetails = () => {
    setSelectedPedidoDetails(null);
    setOpenDetails(false);
  };

  // Function to format price to Colombian Pesos
  const formatPriceCOP = (price: number) => {
    if (typeof price === "number") {
      return price.toLocaleString("es-CO", {
        style: "currency",
        currency: "COP",
        minimumFractionDigits: 0,
        maximumFractionDigits: 0,
      });
    } else {
      return "N/A";
    }
  };

  const getStatusBadgeClass = (status: string) => {
    switch (status) {
      case "pendiente":
        return "bg-yellow-200 text-yellow-800";
      case "atendiendo":
        return "bg-blue-200 text-blue-800";
      case "preparando":
        return "bg-orange-200 text-orange-800";
      case "enviado":
        return "bg-green-200 text-green-800";
      default:
        return "bg-gray-200 text-gray-800";
    }
  };

  return (
    <div className="container mx-auto my-8 p-4">
      <h2 className="text-2xl font-bold text-gray-900 mb-4">
        Lista de Pedidos
      </h2>

      {userRole !== "client" && (
        <div className="mb-6">
          <label
            htmlFor="status-filter"
            className="block text-gray-700 text-sm font-bold mb-2"
          >
            Filtrar por estado:
          </label>
          <select
            id="status-filter"
            value={selectedStatus}
            onChange={handleStatusChange}
            className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
          >
            <option value="pendiente">Pendiente</option>
            <option value="atendiendo">Atendiendo</option>
            <option value="preparando">Preparando</option>
            <option value="enviado">Enviado</option>
          </select>
        </div>
      )}

      {loading ? (
        <div className="flex justify-center">
          <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500"></div>
        </div>
      ) : (
        <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
          {pedidos.map((order) => (
            <div key={order.id} className="bg-white rounded-lg shadow-md p-4">
              <h3 className="text-lg font-semibold text-gray-900 mb-2">
                Orden No. {order.orderId.substring(0, 8)}
              </h3>
              <div className="flex items-center mb-2">
                <span className="text-gray-700 mr-2">Estado:</span>
                <span
                  className={`inline-block px-2 py-1 font-semibold text-sm rounded-full ${getStatusBadgeClass(
                    order.status
                  )}`}
                >
                  {order.status}
                </span>
              </div>
              <p className="text-gray-700 mb-2">Sede: {order.sede}</p>
              <p className="text-gray-700 mb-2">
                Fecha: {order.orderDate.toLocaleDateString()}{" "}
                {order.orderDate.toLocaleTimeString()}
              </p>
              <p className="text-gray-700 mb-3 font-semibold">
                Total: {formatPriceCOP(order.total)}
              </p>

              <div className="flex justify-between">
                <button
                  onClick={() => handleOpenDetails(order)}
                  className="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline text-sm"
                >
                  Ver Detalles
                </button>
                {(userRole === "admin" || userRole === "encargado") && (
                  <div className="space-x-2">
                    <button
                      onClick={() => handleStatusUpdate(order.id, "atendiendo")}
                      disabled={order.status === "atendiendo"}
                      className="bg-indigo-500 hover:bg-indigo-700 text-white font-bold py-2 px-2 rounded focus:outline-none focus:shadow-outline text-xs"
                    >
                      Atender
                    </button>
                    <button
                      onClick={() => handleStatusUpdate(order.id, "preparando")}
                      disabled={order.status === "preparando"}
                      className="bg-yellow-500 hover:bg-yellow-700 text-gray-800 font-bold py-2 px-2 rounded focus:outline-none focus:shadow-outline text-xs"
                    >
                      Preparar
                    </button>
                    <button
                      onClick={() => handleStatusUpdate(order.id, "enviado")}
                      disabled={order.status === "enviado"}
                      className="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-2 rounded focus:outline-none focus:shadow-outline text-xs"
                    >
                      Enviar
                    </button>
                  </div>
                )}
              </div>
            </div>
          ))}
        </div>
      )}

      {openDetails && selectedPedidoDetails && (
        <div
          className="fixed z-50 inset-0 overflow-y-auto"
          aria-labelledby="modal-title"
          role="dialog"
          aria-modal="true"
        >
          <div className="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div
              className="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
              aria-hidden="true"
              onClick={handleCloseDetails}
            ></div>
            <span
              className="hidden sm:inline-block sm:align-middle sm:h-screen"
              aria-hidden="true"
            ></span>
            <div className="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
              <div className="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                <h3
                  className="text-lg leading-6 font-medium text-gray-900"
                  id="modal-title"
                >
                  Detalle Completo de la Orden No.{" "}
                  {selectedPedidoDetails.orderId.substring(0, 8)}
                </h3>
                <div className="mt-4">
                  <div className="grid grid-cols-1 gap-4">
                    <div>
                      <p>
                        <strong>Order ID:</strong> {selectedPedidoDetails.id}
                      </p>
                      <p>
                        <strong>Estado:</strong>{" "}
                        <span
                          className={`inline-block px-2 py-1 font-semibold text-sm rounded-full ${getStatusBadgeClass(
                            selectedPedidoDetails.status
                          )}`}
                        >
                          {selectedPedidoDetails.status}
                        </span>
                      </p>
                      <p>
                        <strong>Total:</strong>{" "}
                        {formatPriceCOP(selectedPedidoDetails.total)}
                      </p>
                      <p>
                        <strong>Costo de Envío:</strong>{" "}
                        {formatPriceCOP(selectedPedidoDetails.deliveryFee)}
                      </p>
                      <p>
                        <strong>Método de Pago:</strong>{" "}
                        {selectedPedidoDetails.paymentMethod}
                      </p>
                      <p>
                        <strong>Domicilio Incluido:</strong>{" "}
                        {selectedPedidoDetails.deliveryIncluded ? "Sí" : "No"}
                      </p>
                      <p>
                        <strong>Sede:</strong> {selectedPedidoDetails.sede}
                      </p>
                      <p>
                        <strong>Fecha del Pedido:</strong>{" "}
                        {selectedPedidoDetails.orderDate.toLocaleString()}
                      </p>
                      <p>
                        <strong>Personas:</strong>{" "}
                        {selectedPedidoDetails.people
                          .map((p) => p.name)
                          .join(", ")}
                      </p>
                    </div>
                    <div>
                      <h4 className="font-semibold mb-2">
                        Pedidos por Persona:
                      </h4>
                      {selectedPedidoDetails.people.map((person) => (
                        <div
                          key={person.id}
                          className="mb-3 p-2 rounded border border-gray-200"
                        >
                          <h5 className="font-semibold">{person.name}</h5>
                          <ul className="list-disc pl-5">
                            {selectedPedidoDetails.items
                              .filter((item) => item.assignedTo === person.name)
                              .map((item, index) => {
                                const menuItem = menu.find(
                                  (menuItem) => menuItem.id === item.id
                                ); // Find menu item by id
                                return (
                                  <li key={index}>
                                    {menuItem
                                      ? menuItem.name
                                      : "Producto no encontrado"}{" "}
                                    (Cantidad: {item.quantity})
                                    {/* Display item name */}
                                  </li>
                                );
                              })}
                          </ul>
                        </div>
                      ))}
                      {selectedPedidoDetails.sharedItems &&
                        selectedPedidoDetails.sharedItems.length > 0 && (
                          <div className="mb-3 p-2 rounded border border-gray-200">
                            <h5 className="font-semibold">Pedido Compartido</h5>
                            <ul className="list-disc pl-5">
                              {selectedPedidoDetails.sharedItems.map(
                                (sharedItem, index) => {
                                  const menuItem = menu.find(
                                    (menuItem) =>
                                      menuItem.id === sharedItem.itemId
                                  ); // Find shared menu item by id
                                  return (
                                    <li key={index}>
                                      {menuItem
                                        ? menuItem.name
                                        : "Producto no encontrado"}{" "}
                                      (Cantidad Compartida:{" "}
                                      {sharedItem.quantity})
                                      {/* Display shared item name */}
                                    </li>
                                  );
                                }
                              )}
                            </ul>
                          </div>
                        )}
                    </div>
                  </div>
                </div>
              </div>
              <div className="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                <button
                  type="button"
                  className="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-gray-100 text-base font-medium text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
                  onClick={handleCloseDetails}
                >
                  Cerrar
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default PedidoList;
/* Fin src\components\pedidos\PedidoList.tsx */

/* Fin src\components\pedidos\PedidoList.tsx */

/* Inicio src\components\splash\SplashScreen.tsx */
// src/components/splash/SplashScreen.tsx
import React, { useEffect, useState } from 'react'
import { useNavigate } from 'react-router-dom'
// Importa el logo como una URL

import { useAuth } from '../../hooks/useAuth'
import './../../styles/SplashScreen.css' // Importa el archivo CSS de estilos

const SplashScreen: React.FC = () => {
  const [logoAnimation, setLogoAnimation] = useState(false)
  const [textAnimation, setTextAnimation] = useState(false)
  const [fadeOut, setFadeOut] = useState(false)
  const { user, loading } = useAuth()
  const navigate = useNavigate()

  useEffect(() => {
    // Inicia la animación del logo
    setLogoAnimation(true)

    // Después de que la animación del logo termine (0.8 segundo), inicia la del texto
    const logoTimeout = setTimeout(() => {
      setTextAnimation(true)
    }, 100)

    // Después de 2.2 segundos, inicia el fade out
    const fadeTimeout = setTimeout(() => {
      setFadeOut(true)
    }, 5000)

    // Después de que el fade out termine (0.8 segundos), redirige
    const redirectTimeout = setTimeout(() => {
      if (!loading) {
        navigate(user ? '/' : '/login')
      }
    }, 100)

    // Limpia los timeouts para evitar problemas si el componente se desmonta
    return () => {
      clearTimeout(logoTimeout)
      clearTimeout(fadeTimeout)
      clearTimeout(redirectTimeout)
    }
  }, [user, loading, navigate])

  // Renderiza el splash screen
  return (
    <div className={`splash-screen ${fadeOut ? 'fade-out' : ''}`}>
      <div className="splash-content">
        <img
          src="/SrPol.png"
          alt="SrPol Logo"
          className={`splash-logo ${logoAnimation ? 'scale-up' : ''}`}
        />
        <div className={`splash-text ${textAnimation ? 'fade-in' : ''}`}>
          <p className="splash-subtitle">Pollo de rechupete</p>
        </div>
      </div>
    </div>
  )
}

export default SplashScreen

/* Fin src\components\splash\SplashScreen.tsx */

/* Inicio src\components\ui\Button.tsx */
/* src\components\ui\Button.tsx */
import React, { ButtonHTMLAttributes, ReactNode } from "react";

type ButtonProps = ButtonHTMLAttributes<HTMLButtonElement> & {
  children: ReactNode;
  variant?: "primary" | "secondary" | "text" | "outlined" | "contained"; // Define variants if needed
  color?:
    | "primary"
    | "secondary"
    | "error"
    | "warning"
    | "info"
    | "success"
    | "inherit"; // Define colors if needed
};

const Button: React.FC<ButtonProps> = ({
  children,
  variant = "contained", // Default variant
  color = "primary", // Default color
  className,
  ...props
}) => {
  let buttonClasses =
    "font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline disabled:opacity-50";

  // Color and variant styles (customize as needed)
  if (variant === "contained") {
    if (color === "primary") {
      buttonClasses += " bg-blue-500 hover:bg-blue-700 text-white";
    } else if (color === "secondary") {
      buttonClasses += " bg-red-500 hover:bg-red-700 text-white";
    } else if (color === "error") {
      buttonClasses += " bg-red-600 hover:bg-red-800 text-white";
    } else if (color === "warning") {
      buttonClasses += " bg-yellow-500 hover:bg-yellow-700 text-gray-800";
    } else if (color === "success") {
      buttonClasses += " bg-green-500 hover:bg-green-700 text-white";
    } else {
      // Default primary
      buttonClasses += " bg-blue-500 hover:bg-blue-700 text-white";
    }
  } else if (variant === "outlined") {
    if (color === "primary") {
      buttonClasses +=
        " border border-blue-500 hover:bg-blue-100 text-blue-700";
    } else if (color === "secondary") {
      buttonClasses += " border border-red-500 hover:bg-red-100 text-red-700";
    } else if (color === "error") {
      buttonClasses += " border border-red-600 hover:bg-red-100 text-red-800";
    } else if (color === "warning") {
      buttonClasses +=
        " border border-yellow-500 hover:bg-yellow-100 text-yellow-700";
    } else if (color === "success") {
      buttonClasses +=
        " border border-green-500 hover:bg-green-100 text-green-700";
    } else {
      // Default primary
      buttonClasses +=
        " border border-blue-500 hover:bg-blue-100 text-blue-700";
    }
  } else {
    // Default contained
    if (color === "primary") {
      buttonClasses += " bg-blue-500 hover:bg-blue-700 text-white";
    } else {
      // Default primary
      buttonClasses += " bg-blue-500 hover:bg-blue-700 text-white";
    }
  }

  return (
    <button {...props} className={`${buttonClasses} ${className || ""}`}>
      {children}
    </button>
  );
};

export default Button;
/* Fin src\components\ui\Button.tsx */

/* Inicio src\components\ui\Container.tsx */
// src/components/ui/Container.tsx
import React, { ReactNode } from 'react';

interface ContainerProps {
  children: ReactNode;
  className?: string; // Para clases adicionales de Tailwind si las necesitas
}

const Container: React.FC<ContainerProps> = ({ children, className }) => {
  return (
    <div className={`container mx-auto px-4 ${className || ''}`}> {/* Clases container, margen horizontal automático y padding x por defecto, y clases adicionales */}
      {children}
    </div>
  );
};

export default Container;
/* Fin src\components\ui\Container.tsx */

/* Inicio src\components\ui\CurrencyInput.tsx */
// src/components/CurrencyInput.tsx
import React, { useEffect, useState } from 'react'

interface CurrencyInputProps {
  value: number
  onChange: (value: number) => void
  placeholder?: string
}

const formatCurrency = (value: number): string => {
  if (isNaN(value)) return ''
  // Siempre formatea sin decimales
  return value.toLocaleString('es-CO', { minimumFractionDigits: 0, maximumFractionDigits: 0 })
}

const CurrencyInput: React.FC<CurrencyInputProps> = ({ value, onChange, placeholder }) => {
  const [rawValue, setRawValue] = useState<string>(formatCurrency(value))

  useEffect(() => {
    setRawValue(formatCurrency(value))
  }, [value])

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const input = e.target.value
    // Permitir solo dígitos, comas y puntos
    const cleaned = input.replace(/[^0-9,.]/g, '')
    setRawValue(cleaned)

    let normalized = ''
    if (cleaned.includes(',')) {
      // Si hay coma, se asume separador decimal: elimina todos los puntos y cambia la coma por punto
      normalized = cleaned.replace(/\./g, '')
      normalized = normalized.replace(',', '.')
    } else {
      // Si no hay coma, elimina los puntos (que serían separadores de miles)
      normalized = cleaned.replace(/\./g, '')
    }
    const parsed = parseFloat(normalized)
    if (!isNaN(parsed)) {
      onChange(parsed)
    } else {
      onChange(0)
    }
  }

  const handleBlur = () => {
    // Al perder el foco se formatea el valor para mostrarlo sin decimales y con separadores de miles
    setRawValue(formatCurrency(value))
  }

  return (
    <input
      type="text"
      value={rawValue}
      onChange={handleChange}
      onBlur={handleBlur}
      placeholder={placeholder}
      className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
    />
  )
}

export default CurrencyInput

/* Fin src\components\ui\CurrencyInput.tsx */

/* Inicio src\components\ui\ErrorBoundry.tsx */
// src/components/ui/ErrorBoundry.tsx
import { Alert } from "@mui/material";
import React, { Component, ErrorInfo, ReactNode } from "react";

interface Props {
  children: ReactNode;
}

interface State {
  hasError: boolean;
  error: Error | null;
  errorInfo: ErrorInfo | null;
}

class ErrorBoundary extends Component<Props, State> {
  constructor(props: Props) {
    super(props);
    this.state = { hasError: false, error: null, errorInfo: null };
  }

  static getDerivedStateFromError(error: Error) {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error("Error caught by error boundary", error, errorInfo);
    this.setState({ errorInfo });
  }

  render() {
    if (this.state.hasError) {
      return (
        <Alert severity="error" className="mt-4 rounded-md shadow-sm">
          {" "}
          {/* Added Tailwind classes to Alert */}
          Algo salió mal
        </Alert>
      );
    }

    return this.props.children;
  }
}

export default ErrorBoundary;

/* Fin src\components\ui\ErrorBoundry.tsx */

/* Inicio src\components\ui\ListItem.tsx */
/* src\components\ui\ListItem.tsx */
import React, { forwardRef, ReactNode } from "react";
import { Link } from "react-router-dom";

interface ListItemProps extends React.LiHTMLAttributes<HTMLLIElement> {
  children: ReactNode;
  onClick?: () => void;
  to?: string;
  href?: string;
  button?: boolean;
}

const ListItem = forwardRef<HTMLLIElement, ListItemProps>(
  ({ children, onClick, to, href, button, className, ...props }, ref) => {
    const handleClick = () => {
      if (onClick) {
        onClick();
      }
    };

    const commonClasses = `block py-2 px-4 text-sm hover:bg-gray-100 text-gray-700`;
    const buttonClasses = button
      ? `${commonClasses} cursor-pointer`
      : commonClasses;

    const listItemContent = (
      <li
        ref={ref}
        onClick={handleClick}
        className={`${buttonClasses} ${className || ""}`}
        {...props}
      >
        {children}
      </li>
    );

    if (to) {
      return (
        <li ref={ref} className={className} {...props}>
          <Link to={to} className={`${commonClasses} block`}>
            {children}
          </Link>
        </li>
      );
    }

    if (href) {
      return (
        <li ref={ref} className={className} {...props}>
          <a href={href} className={`${commonClasses} block`}>
            {children}
          </a>
        </li>
      );
    }

    return listItemContent;
  }
);

ListItem.displayName = "ListItem";

export default ListItem;

/* Fin src\components\ui\ListItem.tsx */

/* Inicio src\components\ui\TextField.tsx */
/* src\components\ui\TextField.tsx */
import React, { InputHTMLAttributes } from "react";

type TextFieldProps = InputHTMLAttributes<HTMLInputElement> & {
  label?: string;
};

const TextField: React.FC<TextFieldProps> = ({
  label,
  className,
  ...props
}) => {
  return (
    <div>
      {label && (
        <label
          htmlFor={props.id}
          className="block text-sm font-medium text-gray-700"
        >
          {label}
        </label>
      )}
      <input
        {...props}
        className={`mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${
          className || ""
        }`}
      />
    </div>
  );
};

export default TextField;

/* Fin src\components\ui\TextField.tsx */

/* Inicio src\context\AppContext.tsx */
/* src\context\AppContext.tsx */
/* src\context\AppContext.tsx */
import { CircularProgress } from "@mui/material";
import { collection, onSnapshot } from "firebase/firestore";
import React, { createContext, ReactNode, useEffect, useState } from "react";
import ErrorBoundary from "../components/ui/ErrorBoundry";
import { COLLECTIONS } from "../utils/constants";
import { db } from "../utils/firebase";

export interface MenuItem {
  // Exporta la interfaz MenuItem
  id: string;
  name: string;
  description: string;
  price: number;
  imageUrl: string;
  available: boolean;
  recommendation: string;
  observations: string;
  availabilityStatus:
    | "disponible"
    | "noDisponibleMomento"
    | "noDisponibleLargoPlazo";
  cost: number;
  points: number;
  imageUrls: string[];
  isCombo: boolean;
  components: string[];
  minimumPrice: number;
  comboSellingPrice: number;
  comboPoints: number;
  additionalCosts: AdditionalCost[];
}
export interface AdditionalCost {
  nombre: string;
  valor: number;
}
export type MenuItemType = MenuItem; // Define y exporta MenuItemType como alias de MenuItem

export interface AppContextProps {
  menu: MenuItemType[]; // Usa MenuItemType aquí
  loading: boolean;
}

export const AppContext = createContext<AppContextProps>({
  menu: [],
  loading: true,
});

interface AppProviderProps {
  children: ReactNode;
}

export const AppProvider: React.FC<AppProviderProps> = ({ children }) => {
  const [menu, setMenu] = useState<MenuItemType[]>([]); // Usa MenuItemType aquí
  const [loading, setLoading] = useState(true);
  useEffect(() => {
    let unsubscribe: () => void;
    try {
      const menuCollection = collection(db, COLLECTIONS.MENU);
      unsubscribe = onSnapshot(menuCollection, (snapshot) => {
        const menuData = snapshot.docs.map(
          (doc) => ({ id: doc.id, ...doc.data() } as MenuItemType) // Cassting a MenuItemType
        );
        setMenu(menuData);
        setLoading(false);
      });
    } catch (error) {
      console.error(error);
      setLoading(false);
    }
    return () => unsubscribe && unsubscribe();
  }, []);

  return (
    <AppContext.Provider value={{ menu, loading }}>
      <ErrorBoundary>{loading ? <CircularProgress /> : children}</ErrorBoundary>
    </AppContext.Provider>
  );
};

/* Fin src\context\AppContext.tsx */

/* Inicio src\context\AuthContext.tsx */
/* eslint-disable @typescript-eslint/no-unsafe-argument */
/* eslint-disable @typescript-eslint/no-misused-promises */
/* src/context/AuthContext.tsx */
import {
  User,
  createUserWithEmailAndPassword,
  onAuthStateChanged,
  signInWithEmailAndPassword,
  signOut,
} from 'firebase/auth'
import { doc, getDoc, setDoc, updateDoc } from 'firebase/firestore'
import React, { ReactNode, createContext, useEffect, useState } from 'react'
import { auth, db } from '../utils/firebase'

export interface AuthContextProps {
  user: User | null
  loading: boolean
  login: (email: string, password: string) => Promise<void>
  register: (email: string, password: string) => Promise<void>
  logout: () => Promise<void>
  userRole: string | null
  points: number
  addPoints: () => Promise<void>
}

export const AuthContext = createContext<AuthContextProps>({
  user: null,
  loading: false,
  login: async () => {},
  register: async () => {},
  logout: async () => {},
  userRole: null,
  points: 0,
  addPoints: async () => {},
})

interface AuthProviderProps {
  children: ReactNode
}

export const AuthProvider: React.FC<AuthProviderProps> = ({ children }) => {
  const [user, setUser] = useState<User | null>(null)
  const [loading, setLoading] = useState(true)
  const [userRole, setUserRole] = useState<string | null>(null)
  const [points, setPoints] = useState<number>(0)

  useEffect(() => {
    const unsubscribe = onAuthStateChanged(auth, async (currentUser) => {
      if (currentUser) {
        const userDocRef = doc(db, 'users', currentUser.uid)
        try {
          const userDoc = await getDoc(userDocRef)
          if (userDoc.exists()) {
            setUserRole(userDoc.data().role)
            setPoints(userDoc.data().points || 0)
          } else {
            await setDoc(userDocRef, {
              role: 'client',
              points: 0,
              email: currentUser.email,
            })
            setUserRole('client')
            setPoints(0)
          }
          setUser(currentUser)
        } catch (error) {
          console.error('Error fetching user document:', error)
          setUser(currentUser)
        } finally {
          setLoading(false)
        }
      } else {
        setUser(null)
        setUserRole(null)
        setPoints(0)
        setLoading(false)
      }
    })

    return () => unsubscribe()
  }, [])

  const login = async (email: string, password: string) => {
    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, password)
      const user = userCredential.user

      const userDoc = await getDoc(doc(db, 'users', user.uid))
      if (userDoc.exists()) {
        setUserRole(userDoc.data().role)
        setPoints(userDoc.data().points || 0)
      } else {
        setUserRole('client')
        setPoints(0)
      }
    } catch (error) {
      throw new Error((error as { message: string }).message)
    }
  }

  const register = async (email: string, password: string) => {
    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password)
      const user = userCredential.user

      await setDoc(doc(db, 'users', user.uid), {
        role: 'client',
        points: 0,
        email: email,
      })

      setUserRole('client')
      setPoints(0)
    } catch (error) {
      console.error('Error en el registro:', (error as { message: string }).message)
      throw new Error((error as { message: string }).message)
    }
  }

  const addPoints = async () => {
    if (!user) return // No sumar puntos para usuarios no autenticados

    try {
      await updateDoc(doc(db, 'users', user.uid), {
        points: points + 10,
      })
      setPoints((prevPoints) => prevPoints + 10)
    } catch (error) {
      console.error('Error al sumar puntos', error)
    }
  }

  const logout = async () => {
    try {
      await signOut(auth)
      setUserRole(null)
      setPoints(0)
    } catch (error) {
      throw new Error((error as { message: string }).message)
    }
  }

  return (
    <AuthContext.Provider
      value={{
        user,
        loading,
        login,
        register,
        logout,
        userRole,
        points,
        addPoints,
      }}
    >
      {children}
    </AuthContext.Provider>
  )
}

/* Fin src\context\AuthContext.tsx */

/* Inicio src\hooks\useAuth.ts */
/* src/hooks/useAuth.ts */
import { useContext } from 'react';
import { AuthContext, AuthContextProps } from '../context/AuthContext';

export const useAuth = (): AuthContextProps => {
    const context = useContext<AuthContextProps>(AuthContext);
    if (!context) {
        throw new Error("useAuth must be used within a AuthProvider");
    }
    return context;
};
/* Fin src\hooks\useAuth.ts */

/* Inicio src\hooks\useMenu.ts */
import { useContext } from 'react';
import { AppContext, AppContextProps } from '../context/AppContext';

export const useMenu = (): AppContextProps => {
  const context = useContext(AppContext);
  if (!context) {
    throw new Error("useMenu must be used within a AppProvider")
  }
  return context;
};
/* Fin src\hooks\useMenu.ts */

/* Inicio src\main.tsx */
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import App from './App'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <App />
  </StrictMode>,
)

/* Fin src\main.tsx */

/* Inicio src\pages\ContabilidadDetail.tsx */
/* src\pages\ContabilidadDetail.tsx */
/* eslint-disable @typescript-eslint/no-floating-promises */
/* eslint-disable @typescript-eslint/no-misused-promises */
// src/pages/ContabilidadDetail.tsx
import {
  arrayRemove,
  arrayUnion,
  collection,
  doc,
  getDocs,
  onSnapshot,
  query,
  updateDoc,
  where,
} from 'firebase/firestore'
import React, { useEffect, useState } from 'react'
import { useNavigate, useParams } from 'react-router-dom'
import MainLayout from '../components/layout/MainLayout'
import CurrencyInput from '../components/ui/CurrencyInput'
import { useAuth } from '../hooks/useAuth'
import { COLLECTIONS } from '../utils/constants'
import { db } from '../utils/firebase'

import { formatPriceCOP } from './ContabilidadPage'
import { Pedido } from './Dashboard'

// Interfaces - Asegúrate de que Movement y DailyCashRegister estén definidas en global.d.ts o impórtalas si las has definido en otro archivo.

const ContabilidadDetail: React.FC = () => {
  const { user } = useAuth()
  const params = useParams<{ id: string }>()
  const navigate = useNavigate()

  const [registerData, setRegisterData] = useState<DailyCashRegister | null>(null)
  const [loading, setLoading] = useState(true)
  const [ordersOfTheDay, setOrdersOfTheDay] = useState<Pedido[]>([]) // Nuevo estado para pedidos del día

  // Estados para registrar un movimiento
  const [movementType, setMovementType] = useState<'entry' | 'exit'>('entry')
  const [movementAmount, setMovementAmount] = useState<number>(0)
  const [movementConcept, setMovementConcept] = useState<string>('')
  const [movementDescription, setMovementDescription] = useState<string>('')
  const [movementCategory, setMovementCategory] = useState<string>('venta')
  const [movementMethod, setMovementMethod] = useState<string>('efectivo')

  // Estados para el cierre de caja
  const [closingAmount, setClosingAmount] = useState<number>(0)
  const [realClosingAmount, setRealClosingAmount] = useState<number>(0)
  const [dailySalesRevenue, setDailySalesRevenue] = useState<number>(0) // Nuevo estado para ingresos de ventas diarias
  const [dailyStaffPayments, setDailyStaffPayments] = useState<number>(0) // Nuevo estado para pagos diarios al personal
  const [baseAmount, setBaseAmount] = useState<number>(0) // Nuevo estado para la base diaria

  useEffect(() => {
    if (!params.id) {
      setLoading(false)
      return
    }
    const docRef = doc(db, 'caja', params.id)
    const unsubscribe = onSnapshot(
      docRef,
      async (snapshot) => {
        if (!snapshot.exists()) {
          setLoading(false)
          return
        }
        const data = snapshot.data() as Omit<DailyCashRegister, 'id'>
        setRegisterData({
          id: snapshot.id,
          ...data,
        } as DailyCashRegister)
        setDailySalesRevenue(data.dailySalesRevenue || 0)
        setDailyStaffPayments(data.dailyStaffPayments || 0)
        setBaseAmount(data.baseAmount || 0)

        // Corregido: se interpreta la fecha en horario local
        const startOfDay = new Date(`${data.date}T00:00:00`)
        const endOfDay = new Date(`${data.date}T23:59:59.999`)

        const ordersQuery = query(
          collection(db, COLLECTIONS.PEDIDOS),
          where('orderDate', '>=', startOfDay),
          where('orderDate', '<=', endOfDay),
        )
        const ordersSnapshot = await getDocs(ordersQuery)
        let ordersData = ordersSnapshot.docs.map((doc) => ({
          id: doc.id,
          ...doc.data(),
        })) as Pedido[]

        ordersData = ordersData.map((order) => ({
          ...order,
          total: typeof order.total === 'number' ? order.total : 0,
        }))
        setOrdersOfTheDay(ordersData)
        console.log('Orders of the day:', ordersData)

        setLoading(false)
      },
      (error) => {
        console.error('Error al suscribirse al pedido grupal:', error)
        setLoading(false)
      },
    )
    return () => unsubscribe()
  }, [params.id])

  if (loading) {
    return (
      <MainLayout>
        <div className="p-4 text-center">Cargando detalle...</div>
      </MainLayout>
    )
  }

  if (!registerData) {
    return (
      <MainLayout>
        <div className="p-4 text-center">No se encontró el registro de caja.</div>
      </MainLayout>
    )
  }

  // Cálculo en tiempo real
  const totalEntries = registerData.movements
    .filter((m) => m.type === 'entry')
    .reduce((acc, cur) => acc + cur.amount, 0)
  const totalExits = registerData.movements
    .filter((m) => m.type === 'exit')
    .reduce((acc, cur) => acc + cur.amount, 0)
  const expectedOrdersIncome = ordersOfTheDay.reduce((acc, order) => {
    return acc + (order.total || 0) // Ensure order.total is treated as number
  }, 0) // Ingresos esperados de pedidos
  const expectedClose =
    registerData.openingAmount + totalEntries - totalExits + expectedOrdersIncome

  // Cálculo del ahorro
  const calculateSavings = () => {
    const savings = dailySalesRevenue - baseAmount - dailyStaffPayments
    return Math.max(0, savings) // Asegura que el ahorro no sea negativo
  }

  const savingsAmount = calculateSavings()

  const handleAddMovement = async () => {
    if (!user) return
    if (registerData.status === 'closed') {
      alert('Día cerrado, no se pueden agregar movimientos.')
      return
    }
    const movement: Movement = {
      movementId: crypto.randomUUID(),
      type: movementType,
      amount: movementAmount,
      concept: movementConcept.trim() || 'Sin concepto',
      description: movementDescription.trim(),
      category: movementCategory,
      method: movementMethod,
      createdAt: new Date().toISOString(), // Guarda la fecha como ISO string
      createdBy: user.uid,
    }
    try {
      const docRef = doc(db, 'caja', registerData.id)
      await updateDoc(docRef, {
        movements: arrayUnion(movement),
      })
      // Limpiar campos
      setMovementAmount(0)
      setMovementConcept('')
      setMovementDescription('')
      setMovementMethod('efectivo')
      setMovementCategory('venta')
      // Recalcular y actualizar los ingresos por ventas diarias si es una entrada de 'venta'
      if (movement.type === 'entry' && movement.category === 'venta') {
        const updatedSalesRevenue = dailySalesRevenue + movement.amount
        setDailySalesRevenue(updatedSalesRevenue)
        await updateDoc(docRef, { dailySalesRevenue: updatedSalesRevenue })
      }
    } catch (error) {
      console.error('Error al guardar movimiento:', error)
      alert('Error al guardar movimiento')
    }
  }

  const handleRemoveMovement = async (mov: Movement) => {
    if (!user) return
    if (registerData.status === 'closed') {
      alert('Día cerrado, no se pueden eliminar movimientos.')
      return
    }
    const confirmDelete = confirm(`¿Eliminar movimiento: "${mov.concept}" por ${mov.amount} COP?`)
    if (!confirmDelete) return
    try {
      const docRef = doc(db, 'caja', registerData.id)
      await updateDoc(docRef, {
        movements: arrayRemove(mov),
      })
      // Recalcular y actualizar los ingresos por ventas diarias si se elimina una entrada de 'venta'
      if (mov.type === 'entry' && mov.category === 'venta') {
        const updatedSalesRevenue = dailySalesRevenue - mov.amount
        setDailySalesRevenue(updatedSalesRevenue)
        await updateDoc(docRef, { dailySalesRevenue: updatedSalesRevenue })
      }
    } catch (error) {
      console.error('Error al eliminar movimiento:', error)
      alert('Error al eliminar movimiento')
    }
  }

  const handleCloseDay = async () => {
    if (!user) return
    if (registerData.status === 'closed') {
      alert('Este día ya está cerrado.')
      return
    }
    const discrepancy = realClosingAmount - expectedClose // Corrección en el cálculo de discrepancia
    try {
      const docRef = doc(db, 'caja', registerData.id)
      await updateDoc(docRef, {
        closingAmount,
        realClosingAmount,
        discrepancy,
        status: 'closed',
        closedBy: user.uid,
        savings: savingsAmount, // Guarda el ahorro al cerrar el día
      })
      alert('Día cerrado con éxito.')
      navigate('/contabilidad')
    } catch (error) {
      console.error('Error al cerrar el día:', error)
      alert('Error al cerrar el día')
    }
  }

  const handleUpdateBaseAmount = async () => {
    if (!user || !registerData) return
    if (registerData.status === 'closed') {
      alert('No puedes modificar la base después de cerrar el día.')
      return
    }
    try {
      const docRef = doc(db, 'caja', registerData.id)
      await updateDoc(docRef, { baseAmount: baseAmount })
      alert('Base diaria actualizada.')
    } catch (error) {
      console.error('Error al actualizar la base diaria:', error)
      alert('Error al actualizar la base diaria.')
    }
  }

  const handleUpdateDailyStaffPayments = async () => {
    if (!user || !registerData) return
    if (registerData.status === 'closed') {
      alert('No puedes modificar los pagos al personal después de cerrar el día.')
      return
    }
    try {
      const docRef = doc(db, 'caja', registerData.id)
      await updateDoc(docRef, { dailyStaffPayments: dailyStaffPayments })
      alert('Pagos diarios al personal actualizados.')
    } catch (error) {
      console.error('Error al actualizar los pagos diarios al personal:', error)
      alert('Error al actualizar los pagos diarios al personal.')
    }
  }

  return (
    <MainLayout>
      <div className="p-4 max-w-5xl mx-auto">
        {' '}
        {/* Increased max-w for wider table */}
        <h1 className="text-2xl font-bold mb-4 text-center text-indigo-700">
          Detalle de Caja - {registerData.date}
        </h1>
        <div className="mb-6 bg-gray-100 p-4 rounded shadow">
          <p>
            <strong>Estado:</strong>{' '}
            <span className={registerData.status === 'open' ? 'text-green-600' : 'text-gray-600'}>
              {registerData.status.toUpperCase()}
            </span>
          </p>
          <p>
            <strong>Apertura:</strong> {formatPriceCOP(registerData.openingAmount)}
          </p>
          <p>
            <strong>Ventas del día (registradas):</strong> {formatPriceCOP(dailySalesRevenue)}
          </p>
          <div>
            <label className="block text-sm font-medium text-gray-700">Base Diaria</label>
            <div className="flex items-center">
              <CurrencyInput
                value={baseAmount}
                onChange={setBaseAmount}
                placeholder="Base diaria"
              />
              {registerData.status === 'open' && (
                <button
                  onClick={handleUpdateBaseAmount}
                  className="ml-2 bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs"
                >
                  Actualizar Base
                </button>
              )}
            </div>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700">
              Pagos diarios personal
            </label>
            <div className="flex items-center">
              <CurrencyInput
                value={dailyStaffPayments}
                onChange={setDailyStaffPayments}
                placeholder="Pagos personal"
              />
              {registerData.status === 'open' && (
                <button
                  onClick={handleUpdateDailyStaffPayments}
                  className="ml-2 bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs"
                >
                  Actualizar Pagos
                </button>
              )}
            </div>
          </div>
          <p>
            <strong>Ahorro del día (estimado):</strong> {formatPriceCOP(savingsAmount)}
          </p>
          <p>
            <strong>Entradas (Movimientos):</strong> {formatPriceCOP(totalEntries)}
          </p>
          <p>
            <strong>Salidas (Movimientos):</strong> {formatPriceCOP(totalExits)}
          </p>
          <p>
            <strong>Ingresos Esperados (Pedidos):</strong> {formatPriceCOP(expectedOrdersIncome)}{' '}
            {/* Mostrar ingresos esperados de pedidos */}
          </p>
          <p>
            <strong className="text-indigo-700">Cierre Esperado:</strong>{' '}
            {formatPriceCOP(expectedClose)}
          </p>
          {registerData.status === 'closed' && (
            <>
              <p>
                <strong>Declarado al Cerrar:</strong>{' '}
                {formatPriceCOP(registerData.closingAmount || 0)}
              </p>
              <p>
                <strong>Efectivo Real Contado:</strong>{' '}
                {formatPriceCOP(registerData.realClosingAmount || 0)}
              </p>
              <p>
                <strong>Discrepancia:</strong>{' '}
                <span
                  className={
                    registerData.discrepancy === 0
                      ? 'text-green-600 font-medium'
                      : 'text-red-600 font-medium'
                  }
                >
                  {registerData.discrepancy === 0
                    ? 'Todo cuadra'
                    : `${formatPriceCOP(registerData.discrepancy || 0)} (Sobrante/Pérdida)`}
                </span>
              </p>
              <p>
                <strong>Ahorro del día (cerrado):</strong>{' '}
                {formatPriceCOP(registerData.savings || 0)}
              </p>
            </>
          )}
        </div>
        {/* Tabla de Entradas y Salidas Esperadas */}
        <div className="mt-8 overflow-x-auto">
          <h2 className="text-xl font-bold text-gray-800 mb-4">Detalle de Entradas y Salidas</h2>
          <table className="min-w-full table-auto border-collapse border border-gray-200">
            <thead className="bg-gray-50">
              <tr>
                <th className="border border-gray-200 px-4 py-2">Pedido / Movimiento</th>
                <th className="border border-gray-200 px-4 py-2">Tipo</th>
                <th className="border border-gray-200 px-4 py-2">Monto</th>
              </tr>
            </thead>
            <tbody>
              {/* Pedidos del Día */}
              {ordersOfTheDay.length > 0 ? (
                ordersOfTheDay.map((order) => (
                  <tr key={order.id} className="hover:bg-gray-100">
                    <td className="border border-gray-200 px-4 py-2">
                      Pedido No. {order.orderId.substring(0, 8)}
                    </td>
                    <td className="border border-gray-200 px-4 py-2">Entrada Esperada (Pedido)</td>
                    <td className="border border-gray-200 px-4 py-2">
                      {formatPriceCOP(order.total)}
                    </td>
                  </tr>
                ))
              ) : (
                <tr>
                  <td className="border border-gray-200 px-4 py-2 text-center italic" colSpan={3}>
                    No hay pedidos para este día
                  </td>
                </tr>
              )}
              {/* Movimientos Registrados */}
              {registerData.movements.map((mov) => (
                <tr key={mov.movementId} className="hover:bg-gray-100">
                  <td className="border border-gray-200 px-4 py-2">{mov.concept}</td>
                  <td className="border border-gray-200 px-4 py-2">
                    {mov.type === 'entry' ? 'Entrada' : 'Salida'}
                  </td>
                  <td className="border border-gray-200 px-4 py-2">{formatPriceCOP(mov.amount)}</td>
                </tr>
              ))}
            </tbody>
            <tfoot className="font-semibold">
              <tr>
                <td className="border border-gray-200 px-4 py-2">Totales Esperados</td>
                <td className="border border-gray-200 px-4 py-2"></td>
                <td className="border border-gray-200 px-4 py-2">
                  {formatPriceCOP(expectedClose)}
                </td>
              </tr>
            </tfoot>
          </table>
        </div>
        {/* Sección para registrar un movimiento */}
        {registerData.status === 'open' && (
          <div className="mb-6 p-4 border rounded bg-gray-50 shadow-sm">
            <h3 className="font-semibold mb-2 text-indigo-600">Registrar Movimiento</h3>
            <div className="mb-3">
              <label className="block text-sm text-gray-700 mb-1">Tipo</label>
              <select
                className="border p-2 w-full rounded"
                value={movementType}
                onChange={(e) => setMovementType(e.target.value as 'entry' | 'exit')}
              >
                <option value="entry">Entrada</option>
                <option value="exit">Salida</option>
              </select>
            </div>
            <div className="mb-3">
              <label className="block text-sm text-gray-700 mb-1">Monto</label>
              <CurrencyInput
                value={movementAmount}
                onChange={setMovementAmount}
                placeholder="Ej: 10.000"
              />
            </div>
            <div className="mb-3">
              <label className="block text-sm text-gray-700 mb-1">Concepto</label>
              <input
                type="text"
                className="border p-2 w-full rounded"
                value={movementConcept}
                onChange={(e) => setMovementConcept(e.target.value)}
              />
            </div>
            <div className="mb-3">
              <label className="block text-sm text-gray-700 mb-1">Descripción (opcional)</label>
              <input
                type="text"
                className="border p-2 w-full rounded"
                value={movementDescription}
                onChange={(e) => setMovementDescription(e.target.value)}
              />
            </div>
            <div className="mb-3">
              <label className="block text-sm text-gray-700 mb-1">Categoría</label>
              <select
                className="border p-2 w-full rounded"
                value={movementCategory}
                onChange={(e) => setMovementCategory(e.target.value)}
              >
                {['venta', 'nomina', 'compra_insumos', 'pago_servicios', 'otros'].map((cat) => (
                  <option key={cat} value={cat}>
                    {cat}
                  </option>
                ))}
              </select>
            </div>
            <div className="mb-3">
              <label className="block text-sm text-gray-700 mb-1">Método de Pago</label>
              <select
                className="border p-2 w-full rounded"
                value={movementMethod}
                onChange={(e) => setMovementMethod(e.target.value)}
              >
                {['efectivo', 'transferencia', 'tarjeta'].map((method) => (
                  <option key={method} value={method}>
                    {method}
                  </option>
                ))}
              </select>
            </div>
            <button
              onClick={handleAddMovement}
              className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"
            >
              Agregar Movimiento
            </button>
          </div>
        )}
        {/* Sección para cerrar el día */}
        {registerData.status === 'open' && (
          <div className="mb-6 p-4 border rounded bg-gray-50 shadow-sm">
            <h3 className="font-semibold mb-2 text-indigo-600">Cerrar Día</h3>
            <div className="mb-3 grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm text-gray-700 mb-1">
                  Cierre Declarado (opcional)
                </label>
                <CurrencyInput
                  value={closingAmount}
                  onChange={setClosingAmount}
                  placeholder="Ej: 50.000"
                />
              </div>
              <div>
                <label className="block text-sm text-gray-700 mb-1">Efectivo Real Contado</label>
                <CurrencyInput
                  value={realClosingAmount}
                  onChange={setRealClosingAmount}
                  placeholder="Ej: 50.000"
                />
              </div>
            </div>
            <button
              onClick={handleCloseDay}
              className="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded"
            >
              Cerrar Día
            </button>
          </div>
        )}
        {/* Listado de movimientos */}
        <div className="mt-8">
          <h2 className="text-xl font-bold text-gray-800 mb-4">Movimientos Registrados</h2>
          {registerData.movements.length === 0 ? (
            <p className="text-gray-500 text-center">No hay movimientos aún.</p>
          ) : (
            <ul className="space-y-3">
              {registerData.movements.map((mov) => (
                <li
                  key={mov.movementId}
                  className="bg-white border p-3 rounded flex items-center justify-between shadow-sm hover:shadow-md transition-shadow duration-200"
                >
                  <div>
                    <p>
                      {mov.type === 'entry' ? (
                        <span className="text-green-600 font-medium">
                          +{formatPriceCOP(mov.amount)}
                        </span>
                      ) : (
                        <span className="text-red-600 font-medium">
                          -{formatPriceCOP(mov.amount)}
                        </span>
                      )}{' '}
                      - {mov.concept}
                    </p>
                    <p className="text-gray-600 text-xs">
                      <strong>Categoría:</strong> {mov.category} | <strong>Método:</strong>{' '}
                      {mov.method}
                    </p>
                    {mov.description && (
                      <p className="text-gray-500 text-sm mt-1">{mov.description}</p>
                    )}
                    <p className="text-xs text-gray-500">
                      {new Date(mov.createdAt).toLocaleString()} | Creado por: {mov.createdBy}
                    </p>
                  </div>
                  <button
                    onClick={() => handleRemoveMovement(mov)}
                    className="text-red-500 hover:text-red-700 ml-2 text-sm"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                      strokeWidth="1.5"
                      stroke="currentColor"
                      className="w-5 h-5"
                    >
                      <path
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        d="M14.74 9l-.346 9m-.478 0l-.345-9m7.021-2.01C18.692 6.905 17.127 5.536 15.313 5.536H8.687C6.873 5.536 5.308 6.905 5.308 8.72v.81c0 1.18.914 2.12 2.094 2.201l1.652.072m7.324 0l1.652-.072a2.094 2.094 0 002.094-2.201v-.81c0-1.814-1.365-3.183-3.187-3.183zm-2.961 8.903L15.7 11.855m-2.606 5.15l-2.796-5.15m5.136 0l-2.794 5.15z"
                      />
                    </svg>
                  </button>
                </li>
              ))}
            </ul>
          )}
        </div>
      </div>
    </MainLayout>
  )
}

export default ContabilidadDetail

/* Fin src\pages\ContabilidadDetail.tsx */

/* Inicio src\pages\ContabilidadPage.tsx */
/* src/pages/ContabilidadPage.tsx */
/* eslint-disable @typescript-eslint/no-misused-promises */
import { addDoc, collection, onSnapshot, query, where } from 'firebase/firestore'
import React, { useEffect, useState } from 'react'

import MainLayout from '../components/layout/MainLayout'
import { useAuth } from '../hooks/useAuth'
import { db } from '../utils/firebase'
// src/utils/formatting.ts
export const formatNumberInput = (value: string): string => {
  // Remueve puntos y luego formatea el número a string con separador de miles
  const numberValue = Number(value.replace(/\./g, ''))
  if (isNaN(numberValue)) return ''
  return numberValue.toLocaleString('es-CO')
}

export const parseNumberInput = (formattedValue: string): number => {
  // Quita los separadores y convierte a número
  return Number(formattedValue.replace(/\./g, ''))
}

export const formatPriceCOP = (price: number): string => {
  return price.toLocaleString('es-CO', {
    style: 'currency',
    currency: 'COP',
    minimumFractionDigits: 0,
    maximumFractionDigits: 0,
  })
}

// Nueva interfaz para la fila del balance
interface BalanceRow {
  cuenta: string
  debe: number
  haber: number
  saldo: number
}

const ContabilidadPage: React.FC = () => {
  const { user, userRole } = useAuth()
  const [cashRegisters, setCashRegisters] = useState<DailyCashRegister[]>([])
  const [loading, setLoading] = useState(true)
  const [openingAmountInput, setOpeningAmountInput] = useState<string>('') // Valor formateado (por ejemplo, "50.000")
  const [openDayError, setOpenDayError] = useState<string | null>(null)
  const [ordersTotal, setOrdersTotal] = useState<number>(0)
  const [balanceRows, setBalanceRows] = useState<BalanceRow[]>([]) // Estado para las filas del balance

  // Suscribirse a la colección de caja (registro diario)
  useEffect(() => {
    const qRef = query(collection(db, 'caja'))
    const unsubscribe = onSnapshot(qRef, (snapshot) => {
      const data: DailyCashRegister[] = snapshot.docs.map((doc) => {
        const docData = doc.data()
        return {
          id: doc.id,
          ...docData,
        } as DailyCashRegister
      })
      setCashRegisters(data)
      setLoading(false)
    })

    return () => unsubscribe()
  }, [])

  // Suscribirse a la colección de pedidos filtrando por el día actual para sumar sus totales
  useEffect(() => {
    const today = new Date()
    const startOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate())
    const endOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1)

    const ordersQuery = query(
      collection(db, 'pedidos'),
      where('orderDate', '>=', startOfDay),
      where('orderDate', '<', endOfDay),
    )

    const unsubscribeOrders = onSnapshot(ordersQuery, (snapshot) => {
      let total = 0
      snapshot.docs.forEach((doc) => {
        total += doc.data().total || 0
      })
      setOrdersTotal(total)
    })

    return () => unsubscribeOrders()
  }, [])

  // Procesar los registros de caja para generar las filas del balance
  useEffect(() => {
    if (!cashRegisters || cashRegisters.length === 0) {
      setBalanceRows([])
      return
    }

    const rowsMap: { [cuenta: string]: BalanceRow } = {}

    cashRegisters.forEach((register) => {
      register.movements.forEach((mov) => {
        let cuentaNombre = ''
        if (mov.category === 'venta') {
          cuentaNombre = 'Ingresos por Ventas'
        } else if (mov.category === 'nomina') {
          cuentaNombre = 'Gastos de Nómina'
        } else if (mov.category === 'compra_insumos') {
          cuentaNombre = 'Gastos de Insumos'
        } else if (mov.category === 'pago_servicios') {
          cuentaNombre = 'Gastos de Servicios'
        } else if (mov.category === 'otros') {
          cuentaNombre = mov.concept || 'Otros Gastos/Ingresos' // Usar concept como nombre si es 'otros'
        } else {
          cuentaNombre = 'Cuenta Desconocida'
        }

        if (!rowsMap[cuentaNombre]) {
          rowsMap[cuentaNombre] = { cuenta: cuentaNombre, debe: 0, haber: 0, saldo: 0 }
        }

        if (mov.type === 'entry') {
          rowsMap[cuentaNombre].haber += mov.amount
        } else if (mov.type === 'exit') {
          rowsMap[cuentaNombre].debe += mov.amount
        }
      })
    })

    // Calcular saldos y convertir el mapa a un array ordenado
    let saldoAcumulado = 0
    const rowsArray: BalanceRow[] = Object.values(rowsMap).map((row) => {
      saldoAcumulado = saldoAcumulado + row.haber - row.debe
      return { ...row, saldo: saldoAcumulado }
    })

    setBalanceRows(rowsArray)
  }, [cashRegisters])

  const handleOpenDay = async () => {
    if (!user) return

    const opening = parseNumberInput(openingAmountInput)

    if (isNaN(opening) || opening <= 0) {
      setOpenDayError('Por favor, ingrese un monto de apertura válido mayor que cero.')
      return
    }
    setOpenDayError(null)

    // Verificar si ya hay un registro "open"
    const alreadyOpen = cashRegisters.find((reg) => reg.status === 'open')
    if (alreadyOpen) {
      alert('Ya hay un día abierto, ciérralo primero antes de abrir otro.')
      return
    }

    const today = new Date()
    const dateStr = today.toISOString().split('T')[0] // Formato "YYYY-MM-DD"

    try {
      await addDoc(collection(db, 'caja'), {
        date: dateStr,
        openingAmount: opening,
        status: 'open',
        createdBy: user.uid,
        movements: [],
        dailySalesRevenue: 0, // Inicializa ingresos de ventas diarias
        dailyStaffPayments: 0, // Inicializa pagos diarios al personal
        baseAmount: 0, // Inicializa base diaria
      })
      alert('Día abierto exitosamente.')
      setOpeningAmountInput('') // Reinicia el input
    } catch (error) {
      console.error('Error al abrir el día:', error)
      alert('Ocurrió un error al abrir el día')
    }
  }

  const handleOpeningAmountInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    // Formatea el valor ingresado para mostrar separadores de miles
    setOpeningAmountInput(formatNumberInput(e.target.value))
  }

  const goToDetail = (id: string) => {
    window.location.href = `/contabilidad/${id}`
  }

  if (loading) {
    return (
      <MainLayout>
        <div className="p-4">Cargando datos de contabilidad...</div>
      </MainLayout>
    )
  }

  return (
    <MainLayout>
      <div className="p-4">
        <h1 className="text-2xl font-bold mb-4 text-center text-indigo-700">Contabilidad / Caja</h1>
        <p className="mb-4 text-gray-600 text-center">
          Aquí podrás abrir un nuevo día, registrar movimientos y cerrar la caja diaria.
        </p>

        {(userRole === 'admin' || userRole === 'encargado') && (
          <div className="text-center mb-4">
            {openDayError && (
              <div
                className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-3"
                role="alert"
              >
                <strong className="font-bold">Error!</strong>
                <span className="block sm:inline"> {openDayError}</span>
              </div>
            )}
            <div className="flex justify-center items-center space-x-2 mb-2">
              <label htmlFor="openingAmount" className="block text-sm font-bold text-gray-700">
                Monto de Apertura:
              </label>
              <input
                type="text"
                id="openingAmount"
                className="shadow appearance-none border rounded w-32 py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                placeholder="Ej: 50.000"
                value={openingAmountInput}
                onChange={handleOpeningAmountInputChange}
              />
            </div>
            <button
              onClick={handleOpenDay}
              className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition-colors duration-200"
            >
              Abrir Nuevo Día
            </button>
            {/* Mostrar el total de pedidos del día */}
            <div className="mt-4">
              <p className="text-lg font-medium">
                Total de Pedidos del Día: {formatPriceCOP(ordersTotal)}
              </p>
            </div>
          </div>
        )}

        {/* Nueva sección para la tabla de balance */}
        <div className="mt-8 overflow-x-auto">
          <h2 className="text-xl font-bold text-gray-800 mb-4">Balance General</h2>
          <table className="min-w-full table-auto border-collapse border border-gray-200">
            <thead className="bg-gray-50">
              <tr>
                <th className="border border-gray-200 px-4 py-2">Cuenta</th>
                <th className="border border-gray-200 px-4 py-2">Debe</th>
                <th className="border border-gray-200 px-4 py-2">Haber</th>
                <th className="border border-gray-200 px-4 py-2">Saldo</th>
              </tr>
            </thead>
            <tbody>
              {balanceRows.map((row, index) => (
                <tr key={index} className={`${index % 2 === 0 ? 'bg-gray-50' : ''}`}>
                  <td className="border border-gray-200 px-4 py-2">{row.cuenta}</td>
                  <td className="border border-gray-200 px-4 py-2 text-right">
                    {formatPriceCOP(row.debe)}
                  </td>
                  <td className="border border-gray-200 px-4 py-2 text-right">
                    {formatPriceCOP(row.haber)}
                  </td>
                  <td className="border border-gray-200 px-4 py-2 text-right">
                    {formatPriceCOP(row.saldo)}
                  </td>
                </tr>
              ))}
            </tbody>
            <tfoot className="font-semibold">
              <tr>
                <td className="border border-gray-200 px-4 py-2">Total</td>
                <td className="border border-gray-200 px-4 py-2 text-right">
                  {formatPriceCOP(balanceRows.reduce((sum, row) => sum + row.debe, 0))}
                </td>
                <td className="border border-gray-200 px-4 py-2 text-right">
                  {formatPriceCOP(balanceRows.reduce((sum, row) => sum + row.haber, 0))}
                </td>
                <td className="border border-gray-200 px-4 py-2 text-right">
                  {formatPriceCOP(balanceRows.slice(-1)[0]?.saldo || 0)}
                </td>
              </tr>
            </tfoot>
          </table>
        </div>

        <div className="mt-8 space-y-4">
          {cashRegisters.map((reg) => (
            <div
              key={reg.id}
              className="border p-4 rounded flex justify-between items-center shadow-sm hover:shadow-md transition-shadow duration-200 bg-gray-100"
            >
              <div>
                <p>
                  <strong>Fecha:</strong> {reg.date}
                </p>
                <p>
                  <strong>Estado:</strong>{' '}
                  <span className={reg.status === 'open' ? 'text-green-600' : 'text-gray-600'}>
                    {reg.status.toUpperCase()}
                  </span>
                </p>
                <p>
                  <strong>Apertura:</strong> {formatPriceCOP(reg.openingAmount)}
                </p>
                {reg.status === 'closed' && (
                  <>
                    <p>
                      <strong>Declarado al Cerrar:</strong> {formatPriceCOP(reg.closingAmount || 0)}
                    </p>
                    <p>
                      <strong>Efectivo Real Contado:</strong>{' '}
                      {formatPriceCOP(reg.realClosingAmount || 0)}
                    </p>
                    <p>
                      <strong>Discrepancia:</strong>{' '}
                      <span
                        className={
                          reg.discrepancy === 0
                            ? 'text-green-600 font-medium'
                            : 'text-red-600 font-medium'
                        }
                      >
                        {reg.discrepancy === 0
                          ? 'Todo cuadra'
                          : `${formatPriceCOP(reg.discrepancy || 0)} (Sobrante/Pérdida)`}
                      </span>
                    </p>
                    <p>
                      <strong>Ahorro del día:</strong> {formatPriceCOP(reg.savings || 0)}
                    </p>
                  </>
                )}
              </div>
              <button
                className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors duration-200"
                onClick={() => goToDetail(reg.id)}
              >
                Ver Detalle
              </button>
            </div>
          ))}
        </div>

        {cashRegisters.length === 0 && (
          <p className="mt-6 text-gray-500 text-center">No hay registros de caja todavía.</p>
        )}
      </div>
    </MainLayout>
  )
}

export default ContabilidadPage

/* Fin src\pages\ContabilidadPage.tsx */

/* Inicio src\pages\Dashboard.tsx */
/* eslint-disable @typescript-eslint/no-redundant-type-constituents */
import {
  ArcElement,
  BarElement,
  BubbleDataPoint,
  CategoryScale,
  Chart,
  Chart as ChartJS,
  ChartOptions,
  Legend,
  LinearScale,
  LineController,
  LineElement,
  Point,
  PointElement,
  Title,
  Tooltip,
} from 'chart.js'
import { collection, doc, onSnapshot, query, updateDoc, where } from 'firebase/firestore'
import React, { useEffect, useRef, useState } from 'react'
import { Bar, Line, Pie } from 'react-chartjs-2'
import { useAuth } from '../hooks/useAuth'
import { db } from '../utils/firebase'

ChartJS.register(
  CategoryScale,
  LinearScale,
  BarElement,
  LineElement,
  PointElement,
  Title,
  Tooltip,
  Legend,
  LineController,
  ArcElement,
)

export interface Pedido {
  orderId: string
  id: string
  status: string
  total: number
  orderDate: Date
  userId: string
}

interface Task {
  id: string
  taskId: string
  taskName: string
  taskType: 'daily' | 'periodic'
  dueDate?: Date | null
  dailyCompletions: { [date: string]: boolean }
  completionDate?: Date | null
  dayOfWeek?: number
  subtasks?: string[]
}

const ALL_STATUSES = ['pendiente', 'atendiendo', 'preparando', 'enviado', 'entregado']

// const defaultDailyTasks = [
//   {
//     taskName: 'Hacer el aseo del restaurante',
//     subtasks: [
//       'Barrer y trapear pisos',
//       'Limpiar mesas y sillas',
//       'Vaciar papeleras',
//       'Limpiar baños',
//     ],
//   },
//   { taskName: 'Lavar la freidora', subtasks: [] },
//   {
//     taskName: 'Revisar inventario y hacer pedidos si es necesario',
//     subtasks: [
//       'Verificar niveles de stock',
//       'Listar productos a pedir',
//       'Enviar pedido a proveedores',
//       'Recibir y organizar pedido',
//     ],
//   },
// ]

// const periodicTasksConfig = [
//   { dayOfMonth: 25, taskName: 'Pagar arriendo', taskType: 'periodic' },
//   { dayOfMonth: 25, taskName: 'Pagar factura de luz', taskType: 'periodic' },
//   { dayOfMonth: 25, taskName: 'Pagar factura de agua', taskType: 'periodic' },
// ]

interface Movement {
  movementId: string
  type: 'entry' | 'exit'
  amount: number
  concept: string
  description?: string
  category: string
  method: string
  createdAt: string
  createdBy: string
}

interface DailyCashRegister {
  id: string
  date: string
  openingAmount: number
  closingAmount?: number
  realClosingAmount?: number
  discrepancy?: number
  status: 'open' | 'closed'
  createdBy: string
  closedBy?: string
  movements: Movement[]
}

const Dashboard: React.FC = () => {
  const { user, userRole, points } = useAuth()
  const [pedidos, setPedidos] = useState<Pedido[]>([])
  const [loading, setLoading] = useState<boolean>(true)
  const [tasks, setTasks] = useState<Task[]>([])
  const [loadingTasks, setLoadingTasks] = useState<boolean>(true)

  // Filtro de estado de pedidos
  const [selectedStatus, setSelectedStatus] = useState<string | 'todos'>('todos')

  // Métricas generales
  const [todaySales, setTodaySales] = useState<number>(0)
  const [monthSales, setMonthSales] = useState<number>(0)
  const [pendingOrdersCount, setPendingOrdersCount] = useState<number>(0)
  const [totalOrders, setTotalOrders] = useState<number>(0)
  const [, setClientTotalOrders] = useState<number>(0)

  // Datos de contabilidad
  const [cashRegisters, setCashRegisters] = useState<DailyCashRegister[]>([])
  const [monthlyIncome, setMonthlyIncome] = useState(0)
  const [monthlyExpenses, setMonthlyExpenses] = useState(0)
  const [monthlyBalance, setMonthlyBalance] = useState(0)
  const [categoryData, setCategoryData] = useState<{
    labels: string[]
    income: number[]
    expenses: number[]
  } | null>(null)
  const [monthlyLabelsContabilidad, setMonthlyLabelsContabilidad] = useState<string[]>([])
  const [monthlyIncomeContabilidad, setMonthlyIncomeContabilidad] = useState<number[]>([])
  const [monthlyExpensesContabilidad, setMonthlyExpensesContabilidad] = useState<number[]>([])
  const [contabilityError, setContabilityError] = useState<boolean>(false)

  // Gráficos de ventas
  const [dailyLabels, setDailyLabels] = useState<string[]>([])
  const [dailyData, setDailyData] = useState<number[]>([])
  const [monthlyLabels, setMonthlyLabels] = useState<string[]>([])
  const [monthlyData, setMonthlyData] = useState<number[]>([])
  // const [selectedDateRange, setSelectedDateRange] = useState<{
  //   from: Date | null
  //   to: Date | null
  // }>({ from: null, to: null })

  const chartRef = useRef<Chart<
    'line',
    (number | [number, number] | Point | BubbleDataPoint)[],
    unknown
  > | null>(null)

  const categories = ['venta', 'compra_insumos', 'pago_servicios', 'nomina', 'otros']

  // Escucha la colección de caja para contabilidad
  useEffect(() => {
    setContabilityError(false)
    const qRef = query(collection(db, 'caja'))
    const unsubscribe = onSnapshot(
      qRef,
      (snapshot) => {
        const data: DailyCashRegister[] = snapshot.docs.map((docSnap) => {
          const docData = docSnap.data()
          return {
            id: docSnap.id,
            ...docData,
          } as DailyCashRegister
        })
        setCashRegisters(data)
      },
      (error) => {
        console.error('Error fetching contability data:', error)
        setContabilityError(true)
        setLoading(false)
      },
    )
    return () => unsubscribe()
  }, [])

  // UseEffect para calcular métricas de contabilidad
  useEffect(() => {
    if (!cashRegisters || cashRegisters.length === 0) {
      setMonthlyIncome(0)
      setMonthlyExpenses(0)
      setMonthlyBalance(0)
      setCategoryData(null)
      setMonthlyLabelsContabilidad([])
      setMonthlyExpensesContabilidad([])
      setMonthlyIncomeContabilidad([])
      return
    }

    const now = new Date()
    const firstDayOfMonth = new Date(now.getFullYear(), now.getMonth(), 1)
    const filteredRegisters = cashRegisters.filter((reg) => {
      const date = new Date(reg.date)
      return date >= firstDayOfMonth && date <= now
    })

    let totalIncome = 0
    let totalExpenses = 0
    // Inicializa categoryTotals con las categorías predefinidas
    const categoryTotals = categories.reduce(
      (acc, category) => {
        acc[category] = { income: 0, expenses: 0 }
        return acc
      },
      {} as Record<string, { income: number; expenses: number }>,
    )

    console.log('cashRegisters data inside categoryData useEffect:', cashRegisters)

    filteredRegisters.forEach((register) => {
      register.movements.forEach((mov) => {
        if (mov.type === 'entry') {
          totalIncome += mov.amount
          // Si la categoría no existe en categoryTotals, la inicializamos
          if (!categoryTotals[mov.category]) {
            categoryTotals[mov.category] = { income: 0, expenses: 0 }
          }
          categoryTotals[mov.category].income += mov.amount
        } else {
          totalExpenses += mov.amount
          if (!categoryTotals[mov.category]) {
            categoryTotals[mov.category] = { income: 0, expenses: 0 }
          }
          categoryTotals[mov.category].expenses += mov.amount
        }
      })
    })

    console.log('categoryTotals after processing movements:', categoryTotals)

    setMonthlyIncome(totalIncome)
    setMonthlyExpenses(totalExpenses)
    setMonthlyBalance(totalIncome - totalExpenses)

    // En lugar de iterar sobre las categorías predefinidas, usamos las claves de categoryTotals
    const labels: string[] = []
    const income: number[] = []
    const expenses: number[] = []

    Object.keys(categoryTotals).forEach((category) => {
      if (categoryTotals[category].income > 0 || categoryTotals[category].expenses > 0) {
        labels.push(category)
        income.push(categoryTotals[category].income)
        expenses.push(categoryTotals[category].expenses)
      }
    })

    const finalCategoryData = { labels, income, expenses }
    console.log('Final categoryData before setState:', finalCategoryData)
    setCategoryData(finalCategoryData)
  }, [cashRegisters])

  useEffect(() => {
    let pedidosQuery = collection(db, 'pedidos')
    if (userRole === 'client' && user) {
      pedidosQuery = query(pedidosQuery, where('userId', '==', user.uid)) as never
    }

    const unsubscribe = onSnapshot(
      pedidosQuery,
      (snapshot) => {
        const pedidosData: Pedido[] = snapshot.docs.map((doc) => {
          const data = doc.data() as {
            status: string
            total: number
            orderDate: { toDate: () => Date; toMillis: () => number }
            userId: string
          }
          return {
            id: doc.id,
            status: data.status,
            total: data.total,
            orderDate: data.orderDate?.toDate ? data.orderDate.toDate() : new Date(),
            userId: data.userId,
          } as Pedido
        })
        setPedidos(pedidosData)
        setLoading(false)
      },
      (error) => {
        console.error('Error en el listener de pedidos:', error)
        setLoading(false)
      },
    )
    return () => unsubscribe()
  }, [user, userRole])

  useEffect(() => {
    if (userRole === 'admin' || userRole === 'encargado') {
      const today = new Date()
      const todayDateString = today.toISOString().split('T')[0]

      const tasksCollection = collection(db, 'tasks')
      const unsubscribeTasks = onSnapshot(
        tasksCollection,
        (snapshot) => {
          let fetchedTasks: Task[] = snapshot.docs.map((doc) => {
            const data = doc.data() as {
              taskId: string
              taskName: string
              taskType: 'daily' | 'periodic'
              dueDate: { toDate: () => Date } | null
              dailyCompletions: { [date: string]: boolean }
              completionDate: { toDate: () => Date } | null
              subtasks: string[]
            }
            return {
              id: doc.id,
              taskId: data.taskId,
              taskName: data.taskName,
              taskType: data.taskType,
              dueDate: data.dueDate ? data.dueDate.toDate() : null,
              dailyCompletions: data.dailyCompletions || {},
              completionDate: data.completionDate ? data.completionDate.toDate() : null,
              subtasks: data.subtasks || [],
            } as Task
          })

          fetchedTasks = fetchedTasks.filter((task) => {
            if (task.taskType === 'daily') {
              return true
            } else if (task.taskType === 'periodic' && task.dueDate) {
              const taskDueDate = task.dueDate
              return taskDueDate.toISOString().split('T')[0] === todayDateString
            }
            return false
          })
          setTasks(fetchedTasks)
          setLoadingTasks(false)
        },
        (error) => {
          console.error('Error en el listener de tareas:', error)
          setLoadingTasks(false)
        },
      )
      return () => unsubscribeTasks()
    } else {
      setLoadingTasks(false)
    }
  }, [userRole])

  // const addDefaultTask = async (
  //   taskName: string,
  //   taskType: 'daily' | 'periodic',
  //   subtasks: string[] = [],
  //   dueDate: Date | null = null,
  // ) => {
  //   try {
  //     await setDoc(doc(collection(db, 'tasks'), uuidv4()), {
  //       taskId: uuidv4(),
  //       taskName: taskName,
  //       taskType: taskType,
  //       completed: false,
  //       dailyCompletions: {},
  //       subtasks: subtasks,
  //       dueDate: dueDate || null,
  //     })
  //   } catch (error) {
  //     console.error('Error adding default task:', error)
  //   }
  // }

  useEffect(() => {
    if (!pedidos.length) {
      setTodaySales(0)
      setMonthSales(0)
      setPendingOrdersCount(0)
      setTotalOrders(0)
      setDailyLabels([])
      setDailyData([])
      setMonthlyLabels([])
      setMonthlyData([])
      setClientTotalOrders(0)
      return
    }

    const filtered =
      selectedStatus === 'todos' ? pedidos : pedidos.filter((p) => p.status === selectedStatus)

    const now = new Date()
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime()

    let sumToday = 0
    let sumMonth = 0
    let pendingCount = 0
    const totalCount = filtered.length
    let clientOrderCount = 0

    filtered.forEach((pedido) => {
      const pedidoDate = new Date(
        pedido.orderDate.getFullYear(),
        pedido.orderDate.getMonth(),
        pedido.orderDate.getDate(),
      ).getTime()

      if (pedidoDate === today) {
        sumToday += pedido.total
      }

      const isThisMonth =
        pedido.orderDate.getMonth() === now.getMonth() &&
        pedido.orderDate.getFullYear() === now.getFullYear()
      if (isThisMonth) {
        sumMonth += pedido.total
      }

      if (pedido.status === 'pendiente') {
        pendingCount++
      }

      if (userRole === 'client' && user && pedido.userId === user.uid) {
        clientOrderCount++
      }
    })

    setTodaySales(sumToday)
    setMonthSales(sumMonth)
    setPendingOrdersCount(pendingCount)
    setTotalOrders(totalCount)
    setClientTotalOrders(clientOrderCount)

    const last7Dates = Array.from({ length: 7 }).map((_, i) => {
      const d = new Date()
      d.setDate(d.getDate() - (6 - i))
      return d
    })

    const daysLabels: string[] = []
    const daysData: number[] = []

    last7Dates.forEach((date) => {
      const dayKey = date.toLocaleDateString('es-ES', {
        day: '2-digit',
        month: '2-digit',
      })
      daysLabels.push(dayKey)

      let dayTotal = 0
      filtered.forEach((pedido) => {
        if (
          pedido.orderDate.getDate() === date.getDate() &&
          pedido.orderDate.getMonth() === date.getMonth() &&
          pedido.orderDate.getFullYear() === date.getFullYear()
        ) {
          dayTotal += pedido.total
        }
      })
      daysData.push(dayTotal)
    })

    setDailyLabels(daysLabels)
    setDailyData(daysData)

    const last6Months = Array.from({ length: 6 }).map((_, i) => {
      const d = new Date()
      d.setMonth(d.getMonth() - (5 - i))
      d.setDate(1)
      return d
    })

    const monthLabels: string[] = []
    const monthTotals: number[] = []

    last6Months.forEach((date) => {
      const label = date.toLocaleDateString('es-ES', { month: '2-digit', year: '2-digit' })
      monthLabels.push(label)

      let monthTotal = 0
      filtered.forEach((pedido) => {
        if (
          pedido.orderDate.getFullYear() === date.getFullYear() &&
          pedido.orderDate.getMonth() === date.getMonth()
        ) {
          monthTotal += pedido.total
        }
      })
      monthTotals.push(monthTotal)
    })

    setMonthlyLabels(monthLabels)
    setMonthlyData(monthTotals)
  }, [pedidos, selectedStatus, userRole, user])

  const categoryChartOptions: ChartOptions<'pie'> = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        display: false,
      },
      tooltip: {
        backgroundColor: '#1e293b',
        titleColor: '#fff',
        bodyColor: '#fff',
        callbacks: {
          label: (tooltipItem: import('chart.js').TooltipItem<'pie'>) => {
            let label = tooltipItem.label || ''
            if (label) {
              label += ': '
            }
            if (tooltipItem.parsed !== null) {
              label += new Intl.NumberFormat('es-CO', {
                style: 'currency',
                currency: 'COP',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0,
              }).format(tooltipItem.parsed)
            }
            return label
          },
        },
      },
    },
  }

  const monthlyContabilidadChartOptions: ChartOptions<'line'> = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        display: false,
      },
      tooltip: {
        backgroundColor: '#1e293b',
        titleColor: '#fff',
        bodyColor: '#fff',
        callbacks: {
          label: (context) => {
            let label = context.dataset.label || ''
            if (label) {
              label += ': '
            }
            if (context.parsed.y !== null) {
              label += new Intl.NumberFormat('es-CO', {
                style: 'currency',
                currency: 'COP',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0,
              }).format(context.parsed.y)
            }
            return label
          },
        },
      },
    },
  }

  const chartOptions: ChartOptions<'bar'> = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        display: false,
      },
      tooltip: {
        backgroundColor: '#1e293b',
        titleColor: '#fff',
        bodyColor: '#fff',
        callbacks: {
          label: (context) => {
            let label = context.dataset.label || ''
            if (label) {
              label += ': '
            }
            if (context.parsed.y !== null) {
              label += new Intl.NumberFormat('es-CO', {
                style: 'currency',
                currency: 'COP',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0,
              }).format(context.parsed.y)
            }
            return label
          },
        },
      },
    },
  }

  const dailyChartData = {
    labels: dailyLabels,
    datasets: [
      {
        label: 'Ventas diarias',
        data: dailyData,
        backgroundColor: '#4F46E5',
        borderRadius: 4,
      },
    ],
  }

  const monthlyChartData = {
    labels: monthlyLabels,
    datasets: [
      {
        label: 'Ventas mensuales',
        data: monthlyData,
        backgroundColor: '#22C55E',
        borderRadius: 4,
      },
    ],
  }

  const monthlyContabilidadChartData = {
    labels: monthlyLabelsContabilidad,
    datasets: [
      {
        label: 'Ingresos',
        data: monthlyIncomeContabilidad,
        borderColor: '#43D478',
        backgroundColor: '#43D478',
        fill: false,
        tension: 0.3,
      },
      {
        label: 'Egresos',
        data: monthlyExpensesContabilidad,
        borderColor: '#E53935',
        backgroundColor: '#E53935',
        fill: false,
        tension: 0.3,
      },
    ],
  }

  const categoryChartData =
    categoryData &&
    categoryData.labels &&
    categoryData.labels.length > 0 &&
    categoryData.income &&
    categoryData.expenses
      ? {
          labels: categoryData.labels,
          datasets: [
            {
              label: 'Ingresos',
              data: categoryData.income.map((val) => val || 0),
              backgroundColor: ['#00A86B', '#43D478', '#95E1D3', '#F7B731', '#F73D47', '#78103C'],
              hoverOffset: 4,
            },
            {
              label: 'Egresos',
              data: categoryData.expenses.map((val) => val || 0),
              backgroundColor: ['#E53935', '#870D17', '#F06292', '#A7004B', '#004772', '#0087D0'],
              hoverOffset: 4,
            },
          ],
        }
      : null

  const showAdminStats = userRole === 'admin' || userRole === 'encargado'
  const showChecklist = userRole === 'admin' || userRole === 'encargado'
  const showClientStats = userRole === 'client'

  const handleTaskCompletionChange = async (taskId: string, completed: boolean) => {
    const todayDate = new Date().toISOString().split('T')[0]
    try {
      const taskDocRef = doc(db, 'tasks', taskId)
      await updateDoc(taskDocRef, {
        [`dailyCompletions.${todayDate}`]: completed,
        completionDate: completed ? new Date() : null,
      })

      setTasks((currentTasks) =>
        currentTasks.map((task) => {
          if (task.id === taskId) {
            return {
              ...task,
              dailyCompletions: {
                ...task.dailyCompletions,
                [todayDate]: completed,
              },
              completionDate: completed ? new Date() : null,
            }
          }
          return task
        }),
      )
    } catch (error) {
      console.error('Error updating task completion:', error)
    }
  }

  const last7Days = Array.from({ length: 7 }, (_, i) => {
    const day = new Date()
    day.setDate(day.getDate() - i)
    return day
  }).reverse()

  const last7DaysFormatted = last7Days.map((day) => day.toISOString().split('T')[0])

  const formatPriceCOP = (price: number) => {
    return price.toLocaleString('es-CO', {
      style: 'currency',
      currency: 'COP',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    })
  }

  if (loading || loadingTasks) {
    return (
      <div className="pt-20 p-4 text-center">
        <p className="text-xl animate-pulse">Cargando Dashboard...</p>
      </div>
    )
  }

  if (showClientStats) {
    return (
      <div className="pt-20 p-4 md:p-6 bg-gray-100 min-h-screen">
        <h1 className="text-3xl font-bold text-gray-900 mb-4 transition-all duration-300 hover:scale-105">
          Bienvenido a SrPol! <span className="text-sm ml-2">({user?.email})</span>
        </h1>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
          <div className="bg-white rounded shadow p-4 text-center transition transform hover:scale-105">
            <p className="text-gray-700 font-semibold text-lg mb-2">Descubre nuestro Menú</p>
            <p className="text-gray-600">Explora deliciosos platos y arma tu pedido.</p>
            <p className="text-2xl font-bold text-indigo-600 mt-4">¡Haz tu pedido ahora!</p>
          </div>
          <div className="bg-white rounded shadow p-4 text-center transition transform hover:scale-105">
            <p className="text-gray-700 font-semibold text-lg mb-2">Acumula Puntos</p>
            <p className="text-gray-600">Cada pedido te da puntos para descuentos.</p>
            <p className="text-2xl font-bold text-green-600 mt-4">Tienes {points} puntos.</p>
          </div>
        </div>

        <div className="bg-white rounded shadow p-4 mb-6 text-center">
          <h2 className="text-xl font-semibold mb-4 text-gray-800">¿Listo para ordenar?</h2>
          <p className="text-gray-600 mb-4">
            Navega por nuestro menú, personaliza tu pedido y disfruta de la mejor comida.
          </p>
          <p className="text-lg text-indigo-700 font-semibold">
            ¡Empieza a explorar nuestro menú hoy mismo!
          </p>
        </div>
      </div>
    )
  }

  return (
    <div className="pt-20 p-4 md:p-6 bg-gray-100 min-h-screen">
      <h1 className="text-3xl font-bold text-gray-900 mb-4 transition-all duration-300 hover:scale-105">
        Dashboard {user?.email && <span className="text-sm ml-2">({user.email})</span>}
      </h1>

      {showAdminStats && (
        <div className="flex flex-wrap items-center mb-6 gap-2">
          <button
            onClick={() => setSelectedStatus('todos')}
            className={`px-4 py-2 rounded-md text-sm font-medium shadow-sm transition transform hover:scale-105
              ${
                selectedStatus === 'todos'
                  ? 'bg-indigo-600 text-white'
                  : 'bg-white text-gray-800 hover:bg-gray-200'
              }`}
          >
            Todos
          </button>
          {ALL_STATUSES.map((status) => (
            <button
              key={status}
              onClick={() => setSelectedStatus(status)}
              className={`px-4 py-2 rounded-md text-sm font-medium shadow-sm transition transform hover:scale-105
                  ${
                    selectedStatus === status
                      ? 'bg-indigo-600 text-white'
                      : 'bg-white text-gray-800 hover:bg-gray-200'
                  }`}
            >
              {status.charAt(0).toUpperCase() + status.slice(1)}
            </button>
          ))}
        </div>
      )}

      {showAdminStats && (
        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
          <div className="bg-white rounded shadow p-4 text-center transition transform hover:scale-105">
            <p className="text-gray-600">Total de Pedidos</p>
            <p className="text-2xl font-bold text-indigo-600">{totalOrders}</p>
          </div>
          <div className="bg-white rounded shadow p-4 text-center transition transform hover:scale-105">
            <p className="text-gray-600">Ventas Hoy</p>
            <p className="text-2xl font-bold text-indigo-600">{formatPriceCOP(todaySales)}</p>
          </div>
          <div className="bg-white rounded shadow p-4 text-center transition transform hover:scale-105">
            <p className="text-gray-600">Ventas del Mes</p>
            <p className="text-2xl font-bold text-indigo-600">{formatPriceCOP(monthSales)}</p>
          </div>
          <div className="bg-white rounded shadow p-4 text-center transition transform hover:scale-105">
            <p className="text-gray-600">Pedidos Pendientes</p>
            <p className="text-2xl font-bold text-indigo-600">{pendingOrdersCount}</p>
          </div>
        </div>
      )}

      {showAdminStats && (
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
          <div className="bg-white rounded shadow p-4">
            <h2 className="text-xl font-semibold mb-4 text-gray-800">
              Resumen de Contabilidad Mensual
            </h2>
            <p className="text-gray-700">
              <strong>Ingresos Totales:</strong> {formatPriceCOP(monthlyIncome)}
            </p>
            <p className="text-gray-700">
              <strong>Egresos Totales:</strong> {formatPriceCOP(monthlyExpenses)}
            </p>
            <p className="text-gray-700 font-semibold">
              <strong>Balance Neto:</strong> {formatPriceCOP(monthlyBalance)}
            </p>
            <div className="h-64">
              {monthlyBalance > 0 ? (
                <Bar
                  data={{
                    labels: ['Balance Neto'],
                    datasets: [
                      { label: 'Balance Neto', data: [monthlyBalance], backgroundColor: '#22C55E' },
                    ],
                  }}
                  options={chartOptions}
                />
              ) : (
                <Bar
                  data={{
                    labels: ['Balance Neto'],
                    datasets: [
                      { label: 'Balance Neto', data: [monthlyBalance], backgroundColor: '#E53935' },
                    ],
                  }}
                  options={chartOptions}
                />
              )}
            </div>
          </div>
          {showAdminStats &&
          categoryData &&
          categoryData.labels?.length &&
          Array.isArray(categoryData.income) &&
          Array.isArray(categoryData.expenses) ? (
            <div className="bg-white rounded shadow p-4">
              <h2 className="text-xl font-semibold mb-4 text-gray-800">Análisis por Categoría</h2>
              <div className="h-64 relative">
                {categoryChartData &&
                categoryChartData.labels &&
                Array.isArray(categoryChartData.labels) &&
                categoryChartData.datasets &&
                Array.isArray(categoryChartData.datasets) ? (
                  <Pie data={categoryChartData} options={categoryChartOptions} />
                ) : (
                  <p className="text-gray-500 italic text-center">
                    Error al preparar datos para el gráfico de categorías.
                  </p>
                )}
              </div>
            </div>
          ) : null}
          {contabilityError && (
            <div className="bg-white rounded shadow p-4 text-center">
              <p className="text-red-500 font-semibold">Error al cargar datos de contabilidad.</p>
              <p className="text-gray-600 text-sm">
                Por favor, intenta recargar la página o contacta al administrador.
              </p>
            </div>
          )}
        </div>
      )}

      {showAdminStats && (
        <div className="bg-white rounded shadow p-4 mb-6">
          <h2 className="text-xl font-semibold mb-4 text-gray-800">
            Comparativa de Ingresos y Egresos Mensuales
          </h2>
          <div className="h-64">
            <Line
              data={monthlyContabilidadChartData}
              options={monthlyContabilidadChartOptions}
              ref={chartRef}
            />
          </div>
        </div>
      )}

      {showAdminStats && (
        <div className="bg-white rounded shadow p-4 mb-6">
          <h2 className="text-xl font-semibold mb-4 text-gray-800">
            Ventas diarias (últimos 7 días)
          </h2>
          <div className="h-64">
            <Bar data={dailyChartData} options={chartOptions} />
          </div>
        </div>
      )}

      {showAdminStats && (
        <div className="bg-white rounded shadow p-4 mb-6">
          <h2 className="text-xl font-semibold mb-4 text-gray-800">
            Ventas mensuales (últimos 6 meses)
          </h2>
          <div className="h-64">
            <Bar data={monthlyChartData} options={chartOptions} />
          </div>
        </div>
      )}

      {showChecklist && (
        <div className="bg-white rounded shadow p-4 mb-6">
          <h2 className="text-xl font-semibold mb-4 text-gray-800">
            Checklist Diario de Tareas (Hoy)
          </h2>
          <ul>
            {tasks.map((task) => (
              <li key={task.id} className="py-2 border-b border-gray-200 last:border-b-0">
                <div className="flex items-center justify-between">
                  <label className="flex items-center">
                    <input
                      type="checkbox"
                      className="form-checkbox h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500"
                      checked={
                        task.dailyCompletions[new Date().toISOString().split('T')[0]] === true
                      }
                      onChange={(e) => {
                        const x = handleTaskCompletionChange(task.id, e.target.checked)
                        console.log(x)
                      }}
                    />
                    <span className="ml-2 text-gray-700">{task.taskName}</span>
                  </label>
                </div>
                {task.subtasks && task.subtasks.length > 0 && (
                  <ul className="ml-6 mt-1">
                    {task.subtasks.map((subtask, index) => (
                      <li key={index} className="text-sm text-gray-500 list-disc ml-4">
                        {subtask}
                      </li>
                    ))}
                  </ul>
                )}
              </li>
            ))}
          </ul>
        </div>
      )}

      {showChecklist && (
        <div className="bg-white rounded shadow p-4 mb-6 overflow-x-auto">
          <h2 className="text-xl font-semibold mb-4 text-gray-800">Estado de Tareas Semanal</h2>
          <div className="overflow-x-auto">
            <table className="min-w-full table-fixed border-collapse border border-gray-200">
              <thead>
                <tr>
                  <th className="border border-gray-200 px-4 py-2 text-left">Tarea</th>
                  {last7Days.map((day) => (
                    <th
                      key={day.toISOString().split('T')[0]}
                      className="border border-gray-200 px-4 py-2 text-center"
                    >
                      {day.toLocaleDateString('es-ES', { weekday: 'short' })}
                    </th>
                  ))}
                </tr>
              </thead>
              <tbody>
                {tasks.map((task) => (
                  <tr key={task.taskId}>
                    <td className="border border-gray-200 px-4 py-2">{task.taskName}</td>
                    {last7DaysFormatted.map((date) => (
                      <td
                        key={`${task.taskId}-${date}`}
                        className="border border-gray-200 px-4 py-2 text-center"
                      >
                        {task.dailyCompletions[date] ? '✅' : '❌'}
                      </td>
                    ))}
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      )}
    </div>
  )
}

export default Dashboard

/* Fin src\pages\Dashboard.tsx */

/* Inicio src\pages\GestionMenu.tsx */
/* eslint-disable @typescript-eslint/no-floating-promises */
/* eslint-disable @typescript-eslint/no-misused-promises */
/* Inicio src\pages\GestionMenu.tsx */
// src/pages/GestionMenu.tsx
import { addDoc, collection, deleteDoc, doc, getDocs, updateDoc } from 'firebase/firestore'
import React, { useEffect, useRef, useState } from 'react'
import { COLLECTIONS } from '../utils/constants'
import { db } from '../utils/firebase'

import { createDefaultMenuItemsAndCombos, deleteAllMenuItems } from '../utils/menu-scripts'; // Importa las funciones

/* =====================================================
   INTERFACES Y TIPOS
===================================================== */

// Para costos adicionales (aplica a ítems y combos)
export interface AdditionalCost {
  description: string
  amount: number
}

// Interfaz de producto (MenuItemType)
export interface MenuItemType {
  id?: string
  name: string
  description: string
  price: number // Precio de venta
  cost: number // Costo interno
  points: number // Puntos asignados
  imageUrls: string[]
  available: boolean
  recommendation: string
  observations: string
  availabilityStatus: 'disponible' | 'noDisponibleMomento' | 'noDisponibleLargoPlazo'
  // Para combos:
  isCombo?: boolean
  components?: string[] // IDs de productos individuales seleccionados
  minimumPrice?: number // Precio mínimo (suma de los costos base y adicionales)
  comboSellingPrice?: number // Precio de venta configurado para el combo
  comboPoints?: number // Puntos asignados para el combo
  // Costos adicionales (opcional)
  additionalCosts?: AdditionalCost[]
}

// Valores iniciales para el formulario
const initialFormValues: Partial<MenuItemType> = {
  name: '',
  description: '',
  price: 0,
  cost: 0,
  points: 0,
  imageUrls: [],
  available: true,
  recommendation: '',
  observations: '',
  availabilityStatus: 'disponible',
  isCombo: false,
  components: [],
  minimumPrice: 0,
  comboSellingPrice: 0,
  comboPoints: 0,
  additionalCosts: [],
}

/* =====================================================
   COMPONENTES AUXILIARES
===================================================== */

// Componente para agregar y eliminar imágenes individualmente
const ImageInputList: React.FC<{
  images: string[]
  onChange: (imgs: string[]) => void
}> = ({ images, onChange }) => {
  const [newUrl, setNewUrl] = useState<string>('')

  const addImage = () => {
    if (newUrl.trim() !== '') {
      onChange([...images, newUrl.trim()])
      setNewUrl('')
    }
  }

  const removeImage = (index: number) => {
    const updated = images.filter((_, i) => i !== index)
    onChange(updated)
  }

  return (
    <div className="mb-4">
      <label className="block text-sm font-medium text-gray-700 mb-1">Imágenes</label>
      <div className="space-y-2">
        {images.map((url, index) => (
          <div key={index} className="flex items-center border rounded p-1 bg-gray-50">
            <input
              type="text"
              value={url}
              readOnly
              className="flex-1 p-1 bg-transparent focus:outline-none text-sm"
            />
            <button type="button" onClick={() => removeImage(index)} className="text-red-500 px-2">
              ×
            </button>
          </div>
        ))}
      </div>
      <div className="mt-2 flex gap-2">
        <input
          type="text"
          value={newUrl}
          onChange={(e) => setNewUrl(e.target.value)}
          placeholder="Nueva URL de imagen"
          className="flex-1 p-1 border rounded focus:outline-none text-sm"
        />
        <button
          type="button"
          onClick={addImage}
          className="bg-blue-500 text-white px-3 py-1 rounded text-sm"
        >
          Agregar
        </button>
      </div>
    </div>
  )
}

// Componente para gestionar costos adicionales
const AdditionalCostsInput: React.FC<{
  costs: AdditionalCost[]
  onChange: (costs: AdditionalCost[]) => void
}> = ({ costs, onChange }) => {
  const [desc, setDesc] = useState<string>('')
  const [amount, setAmount] = useState<number>(0)

  const addCost = () => {
    if (desc.trim() !== '' && amount > 0) {
      onChange([...costs, { description: desc.trim(), amount }])
      setDesc('')
      setAmount(0)
    }
  }

  const removeCost = (index: number) => {
    const updated = costs.filter((_, i) => i !== index)
    onChange(updated)
  }

  return (
    <div className="mb-4">
      <label className="block text-sm font-medium text-gray-700 mb-1">Costos adicionales</label>
      {costs.length > 0 && (
        <ul className="space-y-1">
          {costs.map((cost, index) => (
            <li
              key={index}
              className="flex items-center justify-between border p-1 rounded bg-gray-50 text-sm"
            >
              <span>
                {cost.description}:{' '}
                {cost.amount.toLocaleString('es-CO', {
                  style: 'currency',
                  currency: 'COP',
                  minimumFractionDigits: 0,
                })}
              </span>
              <button type="button" onClick={() => removeCost(index)} className="text-red-500 px-2">
                ×
              </button>
            </li>
          ))}
        </ul>
      )}
      <div className="mt-2 grid grid-cols-2 gap-2">
        <input
          type="text"
          value={desc}
          onChange={(e) => setDesc(e.target.value)}
          placeholder="Descripción"
          className="p-1 border rounded focus:outline-none text-sm"
        />
        <input
          type="number"
          min="0"
          value={amount || ''}
          onChange={(e) => setAmount(Number(e.target.value))}
          placeholder="Monto"
          className="p-1 border rounded focus:outline-none text-sm"
        />
      </div>
      <button
        type="button"
        onClick={addCost}
        className="mt-2 bg-blue-500 text-white px-3 py-1 rounded text-sm"
      >
        Agregar costo
      </button>
    </div>
  )
}

// Componente Carousel sencillo para mostrar imágenes con animación
const Carousel: React.FC<{ images: string[] }> = ({ images }) => {
  const imgs = images || []
  const [current, setCurrent] = useState(0)
  const timeoutRef = useRef<NodeJS.Timeout | null>(null)

  useEffect(() => {
    if (imgs.length === 0) return
    const next = () => {
      setCurrent((prev) => (prev + 1) % imgs.length)
    }
    timeoutRef.current = setInterval(next, 3000)
    return () => {
      if (timeoutRef.current) clearInterval(timeoutRef.current)
    }
  }, [imgs])

  if (imgs.length === 0) {
    return (
      <div className="w-full h-48 bg-gray-200 flex items-center justify-center">
        <span className="text-gray-500 text-sm">Sin imagen</span>
      </div>
    )
  }
  return (
    <div className="relative">
      <img
        src={imgs[current]}
        alt="Producto"
        className="w-full h-48 object-cover transition-all duration-500"
      />
    </div>
  )
}

/* =====================================================
   COMPONENTE PRINCIPAL: GestionMenu
===================================================== */
const GestionMenu: React.FC = () => {
  // Estados principales
  const [menuItems, setMenuItems] = useState<MenuItemType[]>([])
  const [loading, setLoading] = useState<boolean>(true)
  const [modalOpen, setModalOpen] = useState<boolean>(false)
  const [editingItem, setEditingItem] = useState<MenuItemType | null>(null)
  const [formValues, setFormValues] = useState<Partial<MenuItemType>>(initialFormValues)
  const [alert, setAlert] = useState<{ type: 'success' | 'error'; message: string } | null>(null)
  // Validaciones reactivas por campo
  const [formErrors, setFormErrors] = useState<{ [key: string]: string }>({})
  // Modo: 'item' o 'combo'
  const [mode, setMode] = useState<'item' | 'combo'>('item')
  // Para combos: flujo en 2 pasos
  const [comboStep, setComboStep] = useState<number>(1)

  /* --- CARGA DE DATOS --- */
  // Define fetchMenu outside useEffect to be reusable
    const fetchMenu = async () => {
      setLoading(true)
      try {
        const querySnapshot = await getDocs(collection(db, COLLECTIONS.MENU))
        const items: MenuItemType[] = querySnapshot.docs.map((docSnap) => ({
          id: docSnap.id,
          ...docSnap.data(),
        })) as MenuItemType[]
        setMenuItems(items)
      } catch (error) {
        console.error('Error al cargar el menú:', error)
        setAlert({ type: 'error', message: 'Error al cargar el menú' })
      } finally {
        setLoading(false)
      }
    }

  useEffect(() => {
    fetchMenu() // Call fetchMenu on component mount
  }, [])

  const handleBulkDeleteMenu = async () => {
    const success = await deleteAllMenuItems()
    if (success) {
      // Recargar menú si la eliminación fue exitosa
      fetchMenu() // Use the defined fetchMenu function
    }
  }

  const handleBulkCreateDefaultMenu = async () => {
    const success = await createDefaultMenuItemsAndCombos()
    if (success) {
      // Recargar menú si la creación fue exitosa
      fetchMenu() // Use the defined fetchMenu function
    }
  }
  /* --- VALIDACIONES REACTIVAS --- */
  useEffect(() => {
    const errors: { [key: string]: string } = {}
    // Validaciones generales
    if (!formValues.name || formValues.name.trim() === '') {
      errors.name = 'El nombre es obligatorio'
    }
    if (formValues.price !== undefined && formValues.price < 0) {
      errors.price = 'El precio no puede ser negativo'
    }
    if (formValues.cost !== undefined && formValues.cost < 0) {
      errors.cost = 'El costo no puede ser negativo'
    }
    if (formValues.points !== undefined && formValues.points < 0) {
      errors.points = 'Los puntos no pueden ser negativos'
    }
    // Validaciones para combos
    if (mode === 'combo') {
      if (!formValues.components || formValues.components.length === 0) {
        errors.components = 'Debes seleccionar al menos un producto para el combo' // Mensaje más descriptivo
      }
      const baseCost = computeBaseCost()
      if ((Number(formValues.comboSellingPrice) || 0) < baseCost) {
        errors.comboSellingPrice =
          'El precio de venta del combo no puede ser menor que la suma de los costos base' // Mensaje más claro
      }
      const compPoints = computeComponentsPoints()
      if ((Number(formValues.comboPoints) || 0) < compPoints) {
        errors.comboPoints =
          'Los puntos del combo no pueden ser menores que la suma de los puntos de los productos' // Mensaje más claro
      }
      if (formValues.comboSellingPrice !== undefined && formValues.comboSellingPrice < 0) {
        // Validación precio combo negativo
        errors.comboSellingPrice = 'El precio de venta del combo no puede ser negativo'
      }
      if (formValues.comboPoints !== undefined && formValues.comboPoints < 0) {
        // Validación puntos combo negativos
        errors.comboPoints = 'Los puntos del combo no pueden ser negativos'
      }
    }
    setFormErrors(errors)
  }, [formValues, mode])

  /* --- MANEJO DEL FORMULARIO --- */
  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
    const { name, value } = e.target
    setFormValues((prev) => ({
      ...prev,
      [name]:
        name === 'price' ||
        name === 'cost' ||
        name === 'points' ||
        name === 'minimumPrice' ||
        name === 'comboSellingPrice' ||
        name === 'comboPoints'
          ? Number(value) || 0
          : value,
    }))
  }

  // Cambio entre modos (producto o combo)
  const handleModeChange = (newMode: 'item' | 'combo') => {
    setMode(newMode)
    if (newMode === 'combo') {
      setComboStep(1)
    }
    setFormValues((prev) => ({
      ...prev,
      isCombo: newMode === 'combo',
      components: newMode === 'item' ? [] : prev.components,
      minimumPrice: newMode === 'item' ? 0 : prev.minimumPrice,
      comboSellingPrice: newMode === 'item' ? 0 : prev.comboSellingPrice,
      comboPoints: newMode === 'item' ? 0 : prev.comboPoints,
      additionalCosts: [],
    }))
  }

  // Selección de productos para el combo (solo productos individuales)
  const handleComponentToggle = (componentId: string) => {
    const current = formValues.components || []
    if (current.includes(componentId)) {
      setFormValues((prev) => ({
        ...prev,
        components: current.filter((id) => id !== componentId),
      }))
    } else {
      setFormValues((prev) => ({
        ...prev,
        components: [...current, componentId],
      }))
    }
  }

  // Funciones para calcular totales a partir de los productos seleccionados
  const computeBaseCost = () => {
    if (!formValues.components || menuItems.length === 0) return 0
    const compCost = menuItems
      .filter((item) => !item.isCombo && formValues.components.includes(item.id))
      .reduce((sum, item) => sum + (Number(item.cost) || 0), 0)
    const additional = formValues.additionalCosts
      ? formValues.additionalCosts.reduce((sum, cost) => sum + (Number(cost.amount) || 0), 0)
      : 0
    return compCost + additional
  }

  const computeSuggestedSellingPrice = () => {
    if (!formValues.components || menuItems.length === 0) return 0
    const sumPrice = menuItems
      .filter((item) => !item.isCombo && formValues.components.includes(item.id))
      .reduce((sum, item) => sum + (Number(item.price) || 0), 0)
    const additional = formValues.additionalCosts
      ? formValues.additionalCosts.reduce((sum, cost) => sum + (Number(cost.amount) || 0), 0)
      : 0
    return sumPrice + additional
  }

  const computeComponentsPoints = () => {
    if (!formValues.components || menuItems.length === 0) return 0
    return menuItems
      .filter((item) => !item.isCombo && formValues.components.includes(item.id))
      .reduce((sum, item) => sum + (Number(item.points) || 0), 0)
  }

  // Nueva función para calcular puntos sugeridos del combo (similar a computeSuggestedSellingPrice pero con puntos)
  const computeSuggestedPoints = () => {
    if (!formValues.components || menuItems.length === 0) return 0
    return menuItems
      .filter((item) => !item.isCombo && formValues.components.includes(item.id))
      .reduce((sum, item) => sum + (Number(item.points) || 0), 0)
  }

  /* --- APERTURA Y EDICIÓN DEL MODAL --- */
  const openAddModal = (newMode: 'item' | 'combo') => {
    handleModeChange(newMode)
    setFormValues({ ...initialFormValues, isCombo: newMode === 'combo' })
    setEditingItem(null)
    setModalOpen(true)
  }

  const openEditModal = (item: MenuItemType) => {
    setEditingItem(item)
    setMode(item.isCombo ? 'combo' : 'item')
    // Para combo editado, ir directamente a la vista final (paso 2)
    if (item.isCombo) {
      setComboStep(2)
    }
    setFormValues(item)
    setModalOpen(true)
  }

  /* --- OPERACIONES CON FIRESTORE --- */
  const handleDelete = async (item: MenuItemType) => {
    if (window.confirm(`¿Eliminar el item "${item.name}"?`)) {
      try {
        await deleteDoc(doc(db, COLLECTIONS.MENU, item.id))
        setMenuItems((prev) => prev.filter((i) => i.id !== item.id))
        setAlert({ type: 'success', message: 'Item eliminado correctamente' })
      } catch (error) {
        console.error(error)
        setAlert({ type: 'error', message: 'Error al eliminar el item' })
      }
    }
  }

  const handleSave = async () => {
    if (Object.keys(formErrors).length > 0) {
      setAlert({
        type: 'error',
        message: 'Corrige los errores antes de guardar',
      })
      return
    }
    if (!formValues.name || formValues.name.trim() === '') {
      setAlert({ type: 'error', message: 'El nombre es obligatorio' })
      return
    }
    try {
      if (editingItem) {
        await updateDoc(doc(db, COLLECTIONS.MENU, editingItem.id), formValues)
        setMenuItems((prev) =>
          prev.map((i) =>
            i.id === editingItem.id ? ({ ...i, ...formValues } as MenuItemType) : i,
          ),
        )
        setAlert({ type: 'success', message: 'Item actualizado correctamente' })
      } else {
        const docRef = await addDoc(collection(db, COLLECTIONS.MENU), formValues)
        setMenuItems((prev) => [...prev, { id: docRef.id, ...formValues } as MenuItemType])
        setAlert({ type: 'success', message: 'Item agregado correctamente' })
      }
      setModalOpen(false)
    } catch (error) {
      console.error(error)
      setAlert({
        type: 'error',
        message: (error as { message: string }).message || 'Error al guardar el item',
      })
    }
  }

  const handleMarkUnavailable = async (
    item: MenuItemType,
    type: 'noDisponibleMomento' | 'noDisponibleLargoPlazo',
  ) => {
    try {
      await updateDoc(doc(db, COLLECTIONS.MENU, item.id), {
        availabilityStatus: type,
        available: false,
      })
      setMenuItems((prev) =>
        prev.map((i) =>
          i.id === item.id
            ? ({ ...i, availabilityStatus: type, available: false } as MenuItemType)
            : i,
        ),
      )
      setAlert({
        type: 'success',
        message:
          type === 'noDisponibleMomento'
            ? 'Item marcado como no disponible ahora'
            : 'Item marcado como no disponible a largo plazo',
      })
    } catch (error) {
      console.error(error)
      setAlert({
        type: 'error',
        message: (error as { message: string }).message || 'Error al actualizar la disponibilidad',
      })
    }
  }

  const closeAlert = () => setAlert(null)

  // Helper para formatear precios
  const formatPrice = (value: number | undefined) => {
    const num = Number(value)
    if (isNaN(num)) return 'N/A'
    return num.toLocaleString('es-CO', {
      style: 'currency',
      currency: 'COP',
      minimumFractionDigits: 0,
    })
  }

  /* =====================================================
     RENDERIZADO PRINCIPAL
  ====================================================== */
  return (
    <div className="min-h-screen bg-gray-50 p-4 md:p-8">
      <header className="mb-8 text-center">
        <h1 className="text-3xl font-bold text-gray-800">Gestionar Menú</h1>
      </header>

      {alert && (
        <div
          className={`mb-4 p-3 rounded flex justify-between items-center ${
            alert.type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
          }`}
        >
          <span>{alert.message}</span>
          <button onClick={closeAlert} className="font-bold text-xl">
            ×
          </button>
        </div>
      )}

      <div className="flex flex-col sm:flex-row sm:justify-between mb-4 gap-2">
        <div className="flex space-x-2">
          <button
            onClick={() => openAddModal('item')}
            className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded flex-1"
          >
            Nuevo Producto
          </button>
          <button
            onClick={() => openAddModal('combo')}
            className="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded flex-1"
          >
            Nuevo Combo
          </button>
        </div>
        {/* Aquí se agregan los nuevos botones */}
        <div className="flex space-x-2 mt-2 sm:mt-0">
          <button
            onClick={handleBulkDeleteMenu}
            className="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded flex-1"
          >
            Eliminar Todo el Menú
          </button>
          <button
            onClick={handleBulkCreateDefaultMenu}
            className="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded flex-1"
          >
            Crear Menú por Defecto
          </button>
        </div>
      </div>

      {loading ? (
        <p className="text-center text-gray-600">Cargando menú...</p>
      ) : (
        <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
          {menuItems.map((item) => (
            <div key={item.id} className="bg-white rounded-lg shadow-lg overflow-hidden">
              <div className="relative">
                <Carousel images={item.imageUrls ?? []} />
                <div className="absolute top-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded">
                  {item.availabilityStatus === 'disponible'
                    ? 'Disponible'
                    : item.availabilityStatus === 'noDisponibleMomento'
                      ? 'No Disponible Ahora'
                      : 'No Disponible a Largo Plazo'}
                </div>
              </div>
              <div className="p-4">
                <h2 className="text-xl font-semibold text-gray-800">{item.name}</h2>
                <p className="text-gray-600 text-sm mt-1">{item.description}</p>
                <div className="mt-2">
                  <span className="font-medium text-gray-700">Precio:</span>{' '}
                  <span className="text-gray-900">{formatPrice(item.price)}</span>
                </div>
                <div className="mt-1">
                  <span className="font-medium text-gray-700">Costo:</span>{' '}
                  <span className="text-gray-900">{formatPrice(item.cost)}</span>
                </div>
                <div className="mt-1">
                  <span className="font-medium text-gray-700">Puntos:</span>{' '}
                  <span className="text-gray-900">{item.points}</span>
                </div>
                {item.isCombo && (
                  <div className="mt-2 p-2 border rounded bg-gray-50">
                    <p className="text-sm font-medium text-gray-800 mb-1">Combo</p>
                    <p className="text-xs text-gray-600">
                      Componentes:{' '}
                      {item.components &&
                        item.components
                          .map((compId) => {
                            const comp = menuItems.find((m) => m.id === compId)
                            return comp ? comp.name : ''
                          })
                          .join(', ')}
                    </p>
                    <p className="text-xs text-gray-600">
                      Base:{' '}
                      <span className="bg-red-100 px-1 rounded">{formatPrice(item.cost)}</span> |
                      Mínimo:{' '}
                      <span className="bg-red-100 px-1 rounded">
                        {formatPrice(item.minimumPrice || 0)}
                      </span>
                    </p>
                    <p className="text-xs text-gray-600">
                      Venta: {formatPrice(item.comboSellingPrice || item.price)} | Puntos:{' '}
                      {item.comboPoints || item.points}
                    </p>
                  </div>
                )}
                <div className="flex flex-wrap justify-between mt-4 gap-2">
                  <button
                    onClick={() => openEditModal(item)}
                    className="bg-green-500 hover:bg-green-600 text-white font-bold py-1 px-3 rounded text-sm flex-1"
                  >
                    Editar
                  </button>
                  <button
                    onClick={() => handleDelete(item)}
                    className="bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-3 rounded text-sm flex-1"
                  >
                    ✕
                  </button>
                </div>
                <div className="flex flex-wrap justify-between mt-2 gap-2">
                  <button
                    onClick={() => handleMarkUnavailable(item, 'noDisponibleMomento')}
                    className="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-1 px-3 rounded text-xs flex-1"
                  >
                    No Disponible Ahora
                  </button>
                  <button
                    onClick={() => handleMarkUnavailable(item, 'noDisponibleLargoPlazo')}
                    className="bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded text-xs flex-1"
                  >
                    No Disponible Largo Plazo
                  </button>
                </div>
              </div>
            </div>
          ))}
        </div>
      )}

      {/* MODAL: Agregar/Editar Producto o Combo */}
      {modalOpen && (
        <div
          className="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 overflow-y-auto"
          onClick={() => setModalOpen(false)}
        >
          <div
            className="bg-white rounded-lg shadow-lg w-full max-w-lg p-6 my-4 mx-2 overflow-y-auto max-h-[90vh] animate-fade-in"
            onClick={(e) => e.stopPropagation()}
          >
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-2xl font-bold text-gray-800">
                {editingItem ? 'Editar Item' : 'Agregar Item'}
              </h2>
              {/* Botones para seleccionar modo */}
              <div className="flex space-x-2">
                <button
                  onClick={() => handleModeChange('item')}
                  className={`py-1 px-3 rounded ${
                    mode === 'item' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700'
                  }`}
                >
                  Producto
                </button>
                <button
                  onClick={() => handleModeChange('combo')}
                  className={`py-1 px-3 rounded ${
                    mode === 'combo' ? 'bg-purple-500 text-white' : 'bg-gray-200 text-gray-700'
                  }`}
                >
                  Combo
                </button>
              </div>
            </div>

            {Object.keys(formErrors).length > 0 && (
              <div className="mb-4 p-2 bg-red-50 border border-red-200 text-red-600 text-sm rounded">
                Corrige los errores en el formulario.
              </div>
            )}

            {mode === 'combo' ? (
              <>
                {comboStep === 1 ? (
                  // Paso 1: Selección de productos e imágenes
                  <div className="space-y-4">
                    <p className="text-lg font-semibold text-gray-700">
                      Paso 1: Selecciona los productos para el combo
                    </p>
                    {formErrors.components && (
                      <p className="text-red-500 text-xs">{formErrors.components}</p>
                    )}
                    <div className="max-h-60 overflow-y-auto border rounded p-2">
                      {menuItems
                        .filter((item) => !item.isCombo)
                        .map((item) => (
                          <label key={item.id} className="flex items-center space-x-2 mb-1">
                            <input
                              type="checkbox"
                              checked={formValues.components?.includes(item.id) || false}
                              onChange={() => handleComponentToggle(item.id)}
                              className="h-4 w-4 text-blue-600 border-gray-300 rounded"
                            />
                            <span className="text-sm text-gray-700">
                              {item.name} ({formatPrice(item.cost)})
                            </span>
                          </label>
                        ))}
                    </div>
                    {/* Resumen de productos seleccionados */}
                    {formValues.components && formValues.components.length > 0 && (
                      <div className="mt-4 p-2 border rounded bg-white shadow">
                        <p className="font-semibold text-gray-700 mb-1">Productos Seleccionados:</p>
                        <ul className="divide-y divide-gray-200 text-sm">
                          {formValues.components.map((compId) => {
                            const product = menuItems.find((m) => m.id === compId)
                            if (!product) return null
                            return (
                              <li key={compId} className="flex justify-between py-1">
                                <span>{product.name}</span>
                                <span>{formatPrice(product.cost)}</span>
                              </li>
                            )
                          })}
                        </ul>
                        <div className="mt-2 text-right font-bold text-red-600">
                          Total Base: {formatPrice(computeBaseCost())}
                        </div>
                      </div>
                    )}
                    {/* Agregar imágenes para el combo */}
                    <ImageInputList
                      images={formValues.imageUrls || []}
                      onChange={(imgs) => setFormValues((prev) => ({ ...prev, imageUrls: imgs }))}
                    />
                    <div className="flex justify-end space-x-4">
                      <button
                        onClick={() => setModalOpen(false)}
                        className="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded"
                        type="button"
                      >
                        Cancelar
                      </button>
                      <button
                        onClick={() => {
                          if (!formValues.components || formValues.components.length === 0) {
                            setAlert({
                              type: 'error',
                              message: 'Debes seleccionar al menos un producto.',
                            })
                          } else {
                            // Pre-cargar sugerencias: precio de venta sugerido y puntos sugeridos
                            setFormValues((prev) => ({
                              ...prev,
                              comboSellingPrice: computeSuggestedSellingPrice(),
                              comboPoints: computeSuggestedPoints(), // Usar la función correcta aquí
                            }))
                            setComboStep(2)
                            setAlert(null)
                          }
                        }}
                        className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"
                        type="button"
                      >
                        Siguiente
                      </button>
                    </div>
                  </div>
                ) : (
                  // Paso 2: Ingresar información básica, costos adicionales y preview
                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700">Nombre</label>
                      <input
                        type="text"
                        name="name"
                        value={formValues.name || ''}
                        onChange={handleChange}
                        className="mt-1 block w-full p-2 border rounded focus:outline-none"
                      />
                      {formErrors.name && (
                        <p className="text-red-500 text-xs mt-1">{formErrors.name}</p>
                      )}
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700">Descripción</label>
                      <textarea
                        name="description"
                        value={formValues.description || ''}
                        onChange={handleChange}
                        className="mt-1 block w-full p-2 border rounded focus:outline-none"
                      ></textarea>
                    </div>
                    <AdditionalCostsInput
                      costs={formValues.additionalCosts || []}
                      onChange={(costs) =>
                        setFormValues((prev) => ({ ...prev, additionalCosts: costs }))
                      }
                    />
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700">
                          Precio de Venta del Combo
                        </label>
                        <input
                          type="number"
                          name="comboSellingPrice"
                          min="0"
                          value={formValues.comboSellingPrice || 0}
                          onChange={handleChange}
                          className="mt-1 block w-full p-2 border rounded focus:outline-none"
                        />
                        {formErrors.comboSellingPrice && (
                          <p className="text-red-500 text-xs mt-1">
                            {formErrors.comboSellingPrice}
                          </p>
                        )}
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-700">
                          Puntos del Combo
                        </label>
                        <input
                          type="number"
                          name="comboPoints"
                          min="0"
                          value={formValues.comboPoints || 0}
                          onChange={handleChange}
                          className="mt-1 block w-full p-2 border rounded focus:outline-none"
                        />
                        {formErrors.comboPoints && (
                          <p className="text-red-500 text-xs mt-1">{formErrors.comboPoints}</p>
                        )}
                      </div>
                    </div>
                    {/* Preview del combo */}
                    <div className="p-4 border rounded bg-gray-50 shadow">
                      <p className="font-semibold text-gray-700 mb-1">Preview del Combo</p>
                      <p className="text-sm text-gray-600">
                        <strong>Nombre:</strong> {formValues.name || '(Sin nombre)'}
                      </p>
                      <p className="text-sm text-gray-600">
                        <strong>Descripción:</strong>{' '}
                        {formValues.description || '(Sin descripción)'}
                      </p>
                      <div className="mt-2">
                        <p className="text-sm font-semibold text-gray-700">
                          Productos Seleccionados:
                        </p>
                        <ul className="divide-y divide-gray-200 text-sm">
                          {formValues.components?.map((compId) => {
                            const product = menuItems.find((m) => m.id === compId)
                            if (!product) return null
                            return (
                              <li key={compId} className="flex justify-between py-1">
                                <span>{product.name}</span>
                                <span>{formatPrice(product.cost)}</span>
                              </li>
                            )
                          })}
                        </ul>
                      </div>
                      <div className="mt-2">
                        <p className="text-sm text-gray-700">
                          <strong>Costos adicionales:</strong>{' '}
                          {formValues.additionalCosts && formValues.additionalCosts.length > 0
                            ? formValues.additionalCosts
                                .map(
                                  (c) =>
                                    `${c.description}: ${c.amount.toLocaleString('es-CO', {
                                      style: 'currency',
                                      currency: 'COP',
                                      minimumFractionDigits: 0,
                                    })}`,
                                )
                                .join(' | ')
                            : 'Ninguno'}
                        </p>
                      </div>
                      <div className="mt-2">
                        <p className="text-sm text-red-600 font-bold">
                          Costo Base Sugerido: {formatPrice(computeBaseCost())}
                        </p>
                        <p className="text-sm text-green-600 font-bold">
                          Precio de Venta Sugerido: {formatPrice(computeSuggestedSellingPrice())}
                        </p>
                        <p className="text-sm text-indigo-600 font-bold">
                          Puntos Sugeridos: {computeSuggestedPoints()}
                        </p>
                      </div>
                    </div>
                    <div className="flex justify-between mt-6 space-x-4">
                      <button
                        onClick={() => setComboStep(1)}
                        className="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded"
                        type="button"
                      >
                        Volver
                      </button>
                      <button
                        onClick={handleSave}
                        disabled={Object.keys(formErrors).length > 0}
                        className={`${
                          Object.keys(formErrors).length > 0
                            ? 'opacity-50 cursor-not-allowed'
                            : 'bg-blue-500 hover:bg-blue-600'
                        } text-white font-bold py-2 px-4 rounded`}
                        type="button"
                      >
                        Guardar Combo
                      </button>
                    </div>
                  </div>
                )}
              </>
            ) : (
              // Modo Producto: formulario único
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700">Nombre</label>
                  <input
                    type="text"
                    name="name"
                    value={formValues.name || ''}
                    onChange={handleChange}
                    className="mt-1 block w-full p-2 border rounded focus:outline-none"
                  />
                  {formErrors.name && (
                    <p className="text-red-500 text-xs mt-1">{formErrors.name}</p>
                  )}
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700">Descripción</label>
                  <textarea
                    name="description"
                    value={formValues.description || ''}
                    onChange={handleChange}
                    className="mt-1 block w-full p-2 border rounded focus:outline-none"
                  ></textarea>
                </div>
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700">
                      Precio de Venta
                    </label>
                    <input
                      type="number"
                      name="price"
                      min="0"
                      value={formValues.price || 0}
                      onChange={handleChange}
                      className="mt-1 block w-full p-2 border rounded focus:outline-none"
                    />
                    {formErrors.price && (
                      <p className="text-red-500 text-xs mt-1">{formErrors.price}</p>
                    )}
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700">Costo</label>
                    <input
                      type="number"
                      name="cost"
                      min="0"
                      value={formValues.cost || 0}
                      onChange={handleChange}
                      className="mt-1 block w-full p-2 border rounded focus:outline-none"
                    />
                    {formErrors.cost && (
                      <p className="text-red-500 text-xs mt-1">{formErrors.cost}</p>
                    )}
                  </div>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700">Puntos</label>
                  <input
                    type="number"
                    name="points"
                    min="0"
                    value={formValues.points || 0}
                    onChange={handleChange}
                    className="mt-1 block w-full p-2 border rounded focus:outline-none"
                  />
                  {formErrors.points && (
                    <p className="text-red-500 text-xs mt-1">{formErrors.points}</p>
                  )}
                </div>
                <div className="mt-2">
                  <ImageInputList
                    images={formValues.imageUrls || []}
                    onChange={(imgs) => setFormValues((prev) => ({ ...prev, imageUrls: imgs }))}
                  />
                </div>
                <div className="mt-4">
                  <AdditionalCostsInput
                    costs={formValues.additionalCosts || []}
                    onChange={(costs) =>
                      setFormValues((prev) => ({ ...prev, additionalCosts: costs }))
                    }
                  />
                </div>
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700">Recomendación</label>
                    <input
                      type="text"
                      name="recommendation"
                      value={formValues.recommendation || ''}
                      onChange={handleChange}
                      className="mt-1 block w-full p-2 border rounded focus:outline-none"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700">Observaciones</label>
                    <input
                      type="text"
                      name="observations"
                      value={formValues.observations || ''}
                      onChange={handleChange}
                      className="mt-1 block w-full p-2 border rounded focus:outline-none"
                    />
                  </div>
                </div>
                <div className="mt-2">
                  <label className="block text-sm font-medium text-gray-700">Disponibilidad</label>
                  <div className="flex gap-2 mt-1">
                    <button
                      type="button"
                      onClick={() =>
                        setFormValues((prev) => ({
                          ...prev,
                          availabilityStatus: 'disponible',
                          available: true,
                        }))
                      }
                      className={`flex-1 py-2 rounded ${
                        formValues.availabilityStatus === 'disponible'
                          ? 'bg-blue-500 text-white'
                          : 'bg-gray-200 text-gray-700'
                      }`}
                    >
                      Disponible
                    </button>
                    <button
                      type="button"
                      onClick={() =>
                        setFormValues((prev) => ({
                          ...prev,
                          availabilityStatus: 'noDisponibleMomento',
                          available: false,
                        }))
                      }
                      className={`flex-1 py-2 rounded ${
                        formValues.availabilityStatus === 'noDisponibleMomento'
                          ? 'bg-yellow-500 text-white'
                          : 'bg-gray-200 text-gray-700'
                      }`}
                    >
                      No Disponible Ahora
                    </button>
                    <button
                      type="button"
                      onClick={() =>
                        setFormValues((prev) => ({
                          ...prev,
                          availabilityStatus: 'noDisponibleLargoPlazo',
                          available: false,
                        }))
                      }
                      className={`flex-1 py-2 rounded ${
                        formValues.availabilityStatus === 'noDisponibleLargoPlazo'
                          ? 'bg-red-600 text-white'
                          : 'bg-gray-200 text-gray-700'
                      }`}
                    >
                      No Disponible Largo Plazo
                    </button>
                  </div>
                </div>
                <div className="flex justify-end mt-6 space-x-4">
                  <button
                    onClick={() => setModalOpen(false)}
                    className="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded"
                    type="button"
                  >
                    Cancelar
                  </button>
                  <button
                    onClick={handleSave}
                    disabled={Object.keys(formErrors).length > 0}
                    className={`${
                      Object.keys(formErrors).length > 0
                        ? 'opacity-50 cursor-not-allowed'
                        : 'bg-blue-500 hover:bg-blue-600'
                    } text-white font-bold py-2 px-4 rounded`}
                    type="button"
                  >
                    Guardar Producto
                  </button>
                </div>
              </div>
            )}
          </div>
        </div>
      )}
    </div>
  )
}

export default GestionMenu

/* Fin src\pages\GestionMenu.tsx */

/* Fin src\pages\GestionMenu.tsx */

/* Inicio src\pages\GestionUsuarios.tsx */
// src/pages/GestionUsuarios.tsx
import {
    Button,
    Container,
    List,
    ListItem,
    ListItemText,
    Typography,
} from "@mui/material";
import { collection, doc, getDocs, updateDoc } from "firebase/firestore";
import React, { useEffect, useState } from "react";
import { db } from "../utils/firebase";

interface Usuario {
  uid: string;
  email: string;
  role: string;
  points: number;
}

const GestionUsuarios: React.FC = () => {
  const [usuarios, setUsuarios] = useState<Usuario[]>([]);

  useEffect(() => {
    const fetchUsuarios = async () => {
      const usuariosCol = collection(db, "users");
      const usuariosSnapshot = await getDocs(usuariosCol);
      const usuariosList = usuariosSnapshot.docs.map((doc) => ({
        uid: doc.id,
        email: doc.data().email || "No email",
        role: doc.data().role,
        points: doc.data().points || 0,
      }));
      setUsuarios(usuariosList);
    };

    fetchUsuarios();
  }, []);

  const cambiarRol = async (uid: string, nuevoRol: string) => {
    const usuarioRef = doc(db, "users", uid);
    await updateDoc(usuarioRef, { role: nuevoRol });
    setUsuarios((prevUsuarios) =>
      prevUsuarios.map((usuario) =>
        usuario.uid === uid ? { ...usuario, role: nuevoRol } : usuario
      )
    );
  };

  return (
    <Container sx={{ marginY: 3 }}>
      <Typography variant="h4" component="h1" gutterBottom>
        Gestión de Usuarios
      </Typography>
      <List>
        {usuarios.map((usuario) => (
          <ListItem key={usuario.uid}>
            <ListItemText
              primary={`Correo: ${usuario.email}`}
              secondary={`Rol: ${usuario.role} | Puntos: ${usuario.points}`}
            />
            <Button
              variant="contained"
              color="secondary"
              onClick={() =>
                cambiarRol(
                  usuario.uid,
                  usuario.role === "admin" ? "client" : "admin"
                )
              }
            >
              Cambiar a {usuario.role === "admin" ? "Cliente" : "Administrador"}
            </Button>
          </ListItem>
        ))}
      </List>
    </Container>
  );
};

export default GestionUsuarios;

/* Fin src\pages\GestionUsuarios.tsx */

/* Inicio src\pages\Login.tsx */
// src/pages/Login.tsx
import React, { useState } from 'react'
import { Link } from 'react-router-dom'
import LoginForm from '../components/auth/LoginForm'
import RegisterForm from '../components/auth/RegisterForm'
import PublicLayout from '../components/layout/PublicLayout'
import '../styles/login.css' // Importa el archivo CSS específico para el login

const Login: React.FC = () => {
  const [tabValue, setTabValue] = useState(0)

  const handleChange = (newValue: number) => {
    setTabValue(newValue)
  }

  return (
    <PublicLayout>
      <div className="login-container">
        <div className="login-card">
          <div className="login-header">
            <img src="/SrPol.png" alt="Logo SrPol" className="login-logo" />
          </div>

          <div className="login-tabs">
            <button
              className={`login-tab ${tabValue === 0 ? 'active' : ''}`}
              onClick={() => handleChange(0)}
            >
              Iniciar Sesión
            </button>
            <button
              className={`login-tab ${tabValue === 1 ? 'active' : ''}`}
              onClick={() => handleChange(1)}
            >
              Registrarse
            </button>
          </div>

          <div
            className={`login-form-container ${tabValue === 0 ? 'slide-in-left' : 'slide-in-right'}`}
          >
            {tabValue === 0 && <LoginForm />}
            {tabValue === 1 && <RegisterForm />}
          </div>

          {/* Nuevo enlace para acceso como invitado */}
          <div className="guest-access" style={{ marginTop: '1rem', textAlign: 'center' }}>
            <p>
              ¿No tienes cuenta?{' '}
              <Link to="/menu" style={{ color: '#4f46e5', textDecoration: 'underline' }}>
                Acceder como invitado
              </Link>
            </p>
          </div>
        </div>
      </div>
    </PublicLayout>
  )
}

export default Login

/* Fin src\pages\Login.tsx */

/* Inicio src\pages\MenuPage.tsx */
/* eslint-disable @typescript-eslint/no-unused-vars */
/* eslint-disable @typescript-eslint/no-misused-promises */
/* eslint-disable @typescript-eslint/no-floating-promises */
/* src/pages/MenuPage.tsx */
import { Typography } from '@mui/material'
import { addDoc, collection, getDocs, query, where } from 'firebase/firestore'
import React, { useState } from 'react'
import { useNavigate } from 'react-router-dom'
import { Person } from '../components/menu/GroupOrderPage'
import JoinOrderModal from '../components/menu/JoinOrderModal'
import Button from '../components/ui/Button'
import Container from '../components/ui/Container'
import TextField from '../components/ui/TextField'
import { MenuItemType } from '../context/AppContext'
import { useAuth } from '../hooks/useAuth'
import { useMenu } from '../hooks/useMenu'
import { COLLECTIONS } from '../utils/constants'
import { db } from '../utils/firebase'

const MenuPage: React.FC = () => {
  const { menu } = useMenu()
  const { user } = useAuth()
  const navigate = useNavigate()

  const [numPeople, setNumPeople] = useState<number>(1)
  const [people, setPeople] = useState<Person[]>(() => {
    return Array.from({ length: 1 }, (_, index) => ({
      personIndex: index,
      userId: null,
      name: `Persona ${index + 1}`,
      items: [],
      locked: false,
      finished: false,
    }))
  })
  const [showMenu, setShowMenu] = useState(false)
  const [message, setMessage] = useState<string | null>(null)
  const [isCreatingSharedOrder, setIsCreatingSharedOrder] = useState(false)
  const [isJoiningOrder, setIsJoiningOrder] = useState(false)

  const handleNumPeopleChange = (event: React.ChangeEvent<HTMLInputElement>) => {
    const num = Number(event.target.value)
    setNumPeople(num)

    const initialPeople = Array.from({ length: num }, (_, index) => ({
      personIndex: index,
      userId: null,
      name: `Persona ${index + 1}`,
      items: [],
      locked: false,
      finished: false,
    }))
    setPeople(initialPeople)
  }

  const handleNameChange = (index: number, value: string) => {
    const updatedPeople = [...people]
    if (updatedPeople[index]) {
      updatedPeople[index].name = value
      setPeople(updatedPeople)
    }
  }

  const generateCode = () => {
    return Math.floor(1000 + Math.random() * 9000).toString()
  }

  const handleStartOrder = async () => {
    setIsCreatingSharedOrder(true)
    setShowMenu(true)

    const code = generateCode()
    try {
      // Permitir creación de pedido compartido incluso si no hay usuario autenticado
      const groupOrderRef = await addDoc(collection(db, COLLECTIONS.GROUP_ORDERS), {
        code: code,
        ownerId: user ? user.uid : null, // Owner puede ser null para invitados
        status: 'open',
        maxPeople: numPeople,
        createdAt: new Date(),
        participants: people,
        sharedItems: [],
        showPricesToAll: false,
        orderPlaced: false,
        allFinished: false,
      })
      navigate(`/menu/${groupOrderRef.id}?code=${code}`)
    } catch (error) {
      console.error('Error al crear pedido compartido en Firestore:', error)
      setMessage('Error al crear el pedido compartido.')
      setTimeout(() => setMessage(null), 5000)
      setIsCreatingSharedOrder(false)
    }
  }

  const handleJoinOrder = () => {
    setIsJoiningOrder(true)
  }

  const processJoinOrder = async (code: string) => {
    setIsJoiningOrder(false)
    const q = query(
      collection(db, COLLECTIONS.GROUP_ORDERS),
      where('code', '==', code),
      where('status', '==', 'open'),
    )
    try {
      const querySnapshot = await getDocs(q)
      if (!querySnapshot.empty) {
        const groupOrderDoc = querySnapshot.docs[0]
        navigate(`/menu/${groupOrderDoc.id}?code=${code}`)
      } else {
        setMessage('No hay pedido activo con este código o el código es incorrecto.')
        setTimeout(() => setMessage(null), 5000)
      }
    } catch (error) {
      console.error('Error al buscar pedido compartido:', error)
      setMessage('Error al unirse al pedido compartido.')
      setTimeout(() => setMessage(null), 5000)
    }
  }

  const formatPriceCOP = (price: number) => {
    return price.toLocaleString('es-CO', {
      style: 'currency',
      currency: 'COP',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    })
  }

  return (
    <Container className="my-8">
      <div className="text-center mb-8">
        <Typography variant="h4" component="h1" className="text-3xl font-bold text-gray-900 mb-2">
          ¡Descubre nuestro Menú y Pide Fácil!
        </Typography>
        <Typography className="text-gray-600">
          Crea un pedido compartido con amigos o únete a uno existente.
        </Typography>
      </div>

      <div className="mb-8 grid grid-cols-1 md:grid-cols-2 gap-6 max-w-lg mx-auto">
        <Button
          variant="contained"
          color="primary"
          onClick={() => setIsCreatingSharedOrder(true)}
          className="py-3 px-6 rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300"
        >
          🎉 Crear Pedido Compartido
        </Button>
        <Button
          variant="outlined"
          color="primary"
          onClick={handleJoinOrder}
          className="py-3 px-6 rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300"
        >
          🤝 Unirme a Pedido Existente
        </Button>
      </div>

      {message && <div className="mb-4 text-center text-red-500">{message}</div>}

      {isCreatingSharedOrder && !showMenu && (
        <div className="max-w-md mx-auto p-6 rounded-xl shadow-lg bg-white animate-slide-down overflow-hidden">
          <Typography variant="h6" className="text-gray-800 mb-4 text-center">
            Configura tu Pedido Compartido
          </Typography>
          <div className="mb-4">
            <label htmlFor="numPeople" className="block text-gray-700 text-sm font-bold mb-2">
              ¿Cuántas personas?
            </label>
            <TextField
              type="number"
              id="numPeople"
              value={numPeople}
              onChange={handleNumPeopleChange}
              min="1"
              className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
            />
          </div>
          {Array.from({ length: numPeople }).map((_, index) => (
            <div key={index} className="mb-4">
              <label
                htmlFor={`personName-${index}`}
                className="block text-gray-700 text-sm font-bold mb-2"
              >
                Nombre de la persona {index + 1} (Opcional):
              </label>
              <TextField
                type="text"
                id={`personName-${index}`}
                value={people[index]?.name}
                onChange={(e) => handleNameChange(index, e.target.value)}
                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              />
            </div>
          ))}
          <div className="mt-6 text-center">
            <Button
              variant="contained"
              color="primary"
              onClick={handleStartOrder}
              className="py-3 px-6 rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300"
            >
              Comenzar a Pedir
            </Button>
          </div>
        </div>
      )}

      <JoinOrderModal
        open={isJoiningOrder}
        onClose={() => setIsJoiningOrder(false)}
        onJoinOrder={processJoinOrder}
      />
    </Container>
  )
}

export default MenuPage

/* Fin src\pages\MenuPage.tsx */

/* Inicio src\pages\PedidosPage.tsx */

import { Container, Typography } from "@mui/material";
import React from "react";
import PedidoList from "../components/pedidos/PedidoList";

const PedidosPage: React.FC = () => {
  return (
    <Container sx={{ marginY: 3 }}>
      <Typography variant="h4" component="h1" gutterBottom>
        Pedidos
      </Typography>
      <PedidoList />
    </Container>
  );
};

export default PedidosPage;

/* Fin src\pages\PedidosPage.tsx */

/* Inicio src\pages\Perfil.tsx */
// src/pages/Perfil.tsx
import {
  Alert,
  Avatar,
  Button,
  Container,
  Grid,
  Paper,
  Snackbar,
  Typography,
} from "@mui/material";
import React, { useState } from "react";
import { useAuth } from "../hooks/useAuth";

const Perfil: React.FC = () => {
  const { user, addPoints, points } = useAuth();
  const [snackbar, setSnackbar] = useState<{
    open: boolean;
    message: string;
    severity: "success" | "error";
  }>({ open: false, message: "", severity: "success" });

  const handleAddPoints = async () => {
    try {
      await addPoints();
      setSnackbar({
        open: true,
        message: "Puntos agregados exitosamente.",
        severity: "success",
      });
    } catch {
      setSnackbar({
        open: true,
        message: "Error al agregar puntos.",
        severity: "error",
      });
    }
  };

  const handleCloseSnackbar = () => {
    setSnackbar({ ...snackbar, open: false });
  };

  return (
    <Container sx={{ marginY: 3 }}>
      <Paper sx={{ padding: 4 }}>
        <Grid container spacing={4}>
          <Grid item xs={12} sm={4} sx={{ textAlign: "center" }}>
            <Avatar
              alt={user?.email}
              src="/static/images/avatar/1.jpg"
              sx={{ width: 120, height: 120, margin: "0 auto" }}
            />
            <Typography variant="h6" sx={{ mt: 2 }}>
              {user?.email}
            </Typography>
          </Grid>
          <Grid item xs={12} sm={8}>
            <Typography variant="h5" gutterBottom>
              Información del Perfil
            </Typography>
            <Typography variant="body1">
              <strong>UID:</strong> {user?.uid}
            </Typography>
            <Typography variant="body1">
              <strong>Puntos:</strong> {points}
            </Typography>
            <Button
              variant="contained"
              color="primary"
              onClick={handleAddPoints}
              sx={{ mt: 2 }}
            >
              Sumar 10 Puntos
            </Button>
          </Grid>
        </Grid>
      </Paper>
      <Snackbar
        open={snackbar.open}
        autoHideDuration={6000}
        onClose={handleCloseSnackbar}
      >
        <Alert
          onClose={handleCloseSnackbar}
          severity={snackbar.severity}
          sx={{ width: "100%" }}
        >
          {snackbar.message}
        </Alert>
      </Snackbar>
    </Container>
  );
};

export default Perfil;

/* Fin src\pages\Perfil.tsx */

/* Inicio src\pages\Success.tsx */
// src/pages/Success.tsx
import { Container, Typography } from "@mui/material";
import React, { useEffect } from "react";
import { useNavigate, useSearchParams } from "react-router-dom";
import { handlePaymentNotification } from "../payment/payment";
import "../styles/global.css";

const Success: React.FC = () => {
  const [searchParams] = useSearchParams();
  const sessionId = searchParams.get("session_id");
  const navigate = useNavigate();

  useEffect(() => {
    const handleSuccessPayment = async () => {
      if (sessionId) {
        try {
          await handlePaymentNotification(sessionId);
          navigate("/pedidos");
        } catch (error) {
          console.log(
            "Error al procesar el pago:",
            (error as { message: string }).message
          );
          navigate("/pedidos");
        }
      } else {
        navigate("/pedidos");
      }
    };
    handleSuccessPayment();
  }, [navigate, sessionId]);

  return (
    <Container>
      <Typography variant="h4">Pago exitoso, gracias por tu compra</Typography>
    </Container>
  );
};

export default Success;

/* Fin src\pages\Success.tsx */

/* Inicio src\payment\payment.ts */
// src/payment/payment.ts
import { doc, updateDoc } from "firebase/firestore";
import { COLLECTIONS } from "../utils/constants";
import { db } from "../utils/firebase";

export const updateOrderStatus = async (orderId: string, status: string) => {
    try {
        await updateDoc(doc(db, COLLECTIONS.PEDIDOS, orderId), { status: status });
        return true;
    } catch (error) {
        console.error("Error al actualizar el estado del pedido:", (error as { message: string }).message);
        throw new Error((error as { message: string }).message || "Error al actualizar el estado del pedido");
    }
};

export const handlePaymentNotification = async (session_id: string) => {
    console.log("Manejando notificacion de pago:", session_id);
    try {
        // Aquí debes implementar la lógica para verificar el pago con Stripe
        // Por ejemplo, puedes hacer una llamada a tu backend para verificar el estado del pago
        // Luego, actualizar el estado del pedido en Firestore
        // Este es un ejemplo simplificado:

        // Simulación de verificación de pago
        const paymentVerified = true; // Reemplaza con la lógica real

        if (paymentVerified) {
            // Supongamos que tienes el orderId en los metadatos de la sesión
            const orderId = "orderId_from_metadata"; // Reemplaza con el valor real
            await updateOrderStatus(orderId, "enviado");
            return true;
        } else {
            throw new Error("Pago no verificado");
        }
    } catch (error) {
        console.log("Error", (error as { message: string }).message);
        throw new Error((error as { message: string }).message || "Error al manejar la notificacion");
    }
};

declare const window;

export const createCheckoutSession = async (amount: number, orderId: string) => {
    try {
        const response = await fetch('https://api.stripe.com/v1/checkout/sessions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer YOUR_STRIPE_SECRET_KEY`,
            },
            body: JSON.stringify({
                line_items: [
                    {
                        price_data: {
                            currency: 'usd',
                            unit_amount: amount * 100,
                            product_data: {
                                name: 'Pedido',
                            },
                        },
                        quantity: 1,
                    }
                ],
                mode: 'payment',
                success_url: `${window.location.origin}/success?session_id={CHECKOUT_SESSION_ID}`,
                cancel_url: window.location.origin,
                metadata: {
                    orderId: orderId,
                },
            }),
        });
        const data = await response.json();
        if (!response.ok) {
            throw new Error(data.message || 'Error al crear sesion');
        }
        return data.id;
    } catch (error) {
        console.error("Error al crear la sesion de checkout:", (error as { message: string }).message);
        throw new Error((error as { message: string }).message || 'Error al crear sesion');
    }
};

export const processPayment = async (sessionId: string, publicKey: string) => {
    const stripe = window.Stripe(publicKey);
    stripe.redirectToCheckout({ sessionId });
};

/* Fin src\payment\payment.ts */

/* Inicio src\styles\authForm.css */
/* src/styles/auth-forms.css */
.auth-form {
  display: flex;
  flex-direction: column;
  gap: 1.2rem; /* Espacio entre los elementos del formulario */
  width: 100%;
}

.form-group {
  display: flex;
  flex-direction: column;
}

.form-group label {
  font-size: 0.95rem;
  color: #555;
  margin-bottom: 0.3rem;
}

.form-group input {
  padding: 0.9rem 1.2rem;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 1rem;
  transition: border-color 0.3s ease;
  background-color: #f9f9f9; /* Fondo claro */
}

.form-group input:focus {
  outline: none;
  border-color: #4f46e5; /* Color al enfocar */
  box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2); /* Sombra al enfocar */
}

.error-message {
  background-color: #fdecea;
  color: #d32f2f;
  padding: 0.75rem 1rem;
  border-radius: 8px;
  font-size: 0.9rem;
  margin-top: 0.5rem;
}

.auth-button {
  padding: 0.9rem 1.2rem;
  background-color: #4f46e5;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition:
    background-color 0.3s ease,
    transform 0.2s ease;
}

.auth-button:hover {
  background-color: #4338ca; /* Color al pasar el ratón */
}

.auth-button:active {
  transform: scale(0.98); /* Efecto al hacer clic */
}

/* Fin src\styles\authForm.css */

/* Inicio src\styles\global.css */
@tailwind base;
@tailwind components;
@tailwind utilities;

@keyframes fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
}

.animate-fade-in {
    animation: fade-in 0.5s ease-out forwards;
}

@keyframes slide-in-bottom {
    from {
        transform: translateY(100%);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.animate-slide-in-bottom {
    animation: slide-in-bottom 0.5s ease-out forwards;
}

@keyframes slide-down {
  from {
    max-height: 0;
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    max-height: 1000px; /* Increased max-height to accommodate more name fields */
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-slide-down {
  animation: slide-down 0.5s ease-out forwards;
  overflow: hidden; /* Ensure content within animated area is clipped */
}


.transition-max-height {
    transition: max-height 0.5s ease-in-out;
    overflow: hidden; /* Clip content during transition */
}


body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen",
        "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue",
        sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

code {
    font-family: source-code-pro, Menlo, Monaco, Consolas, "Courier New",
        monospace;
}
/* Fin src\styles\global.css */

/* Inicio src\styles\login.css */
/* src/styles/login.css */
/* Importar fuente Poppins */
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

/* Contenedor principal */
.login-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background-color: #f4f6f8; /* Fondo */
  padding: 20px;
}

/* Tarjeta de login */
.login-card {
  background-color: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  width: 100%;
  max-width: 400px;
  padding: 2rem;
  text-align: center;
  font-family: 'Poppins', sans-serif; /* Aplicar la fuente Poppins */
}

/* Encabezado */
.login-header {
  margin-bottom: 1.5rem;
}

.login-logo {
  width: 80px; /* Tamaño del logo */
  margin-bottom: 1rem;
  margin: auto;
  display: inline-block;
}

.login-title {
  font-size: 2rem;
  font-weight: 600;
  color: #333;
  margin-bottom: 0.5rem;
}

.login-subtitle {
  font-size: 1.2rem;
  color: #555;
}

/* Pestañas */
.login-tabs {
  display: flex;
  justify-content: center;
  margin-bottom: 1.5rem;
}

.login-tab {
  background-color: #f0f0f0;
  border: none;
  padding: 0.75rem 1.5rem;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.9rem;
  font-weight: 500;
  color: #333;
  transition: background-color 0.2s ease;
  margin: 0 0.25rem;
}

.login-tab.active {
  background-color: #e0e0e0;
}

.login-tab:hover {
  background-color: #d0d0d0;
}

/* Contenedor de formularios */
.login-form-container {
  /* Estilos aquí */
}

/* Estilos de formulario (puedes reutilizar los estilos de LoginForm y RegisterForm) */
.auth-form {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.form-group {
  display: flex;
  flex-direction: column;
}

.form-group label {
  font-size: 0.9rem;
  color: #333;
  margin-bottom: 0.25rem;
  text-align: left;
}

.form-group input {
  padding: 0.75rem;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 1rem;
}

.auth-button {
  background-color: #1976d2;
  color: white;
  padding: 0.75rem;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 600;
  transition: background-color 0.2s ease;
}

.auth-button:hover {
  background-color: #1565c0;
}

.error-message {
  color: #d32f2f;
  font-size: 0.8rem;
  margin-top: 0.5rem;
  text-align: left;
}

/* Fin src\styles\login.css */

/* Inicio src\styles\public-layout.css */
/* src/styles/public-layout.css */
.public-layout {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center; /* Centra horizontalmente */
  justify-content: center; /* Centra verticalmente */
  padding: 2rem;
  background-color: #f4f4f4; /* Un fondo claro */
}

/* Fin src\styles\public-layout.css */

/* Inicio src\styles\SplashScreen.css */
/* src/styles/SplashScreen.css */
/* Importa la fuente Poppins desde Google Fonts */
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

.splash-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #4f46e5, #7e57c2); /* Degradado de fondo */
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999; /* Asegura que esté en la parte superior */
  font-family: 'Poppins', sans-serif; /* Aplica la fuente */
  overflow: hidden; /* Para evitar que las animaciones se salgan */
  transition: opacity 0.8s ease; /* Animación de fade out más suave */
}

.splash-content {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.splash-logo {
  width: 120px; /* Tamaño inicial del logo */
  height: auto;
  margin-bottom: 20px;
  transform: scale(0); /* Escala inicial completamente pequeña */
  opacity: 0;
  transition:
    transform 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55),
    opacity 0.8s ease; /* Animación de escala y opacidad */
}

.scale-up {
  transform: scale(1); /* Escala final */
  opacity: 1;
}

.splash-text {
  text-align: center;
  opacity: 0; /* Inicia invisible */
  transition:
    opacity 0.6s ease 0.8s,
    transform 0.6s ease 0.8s; /* Fade in y movimiento después de 0.8s */
  transform: translateY(20px); /* Empieza un poco abajo */
}

.fade-in {
  opacity: 1; /* Aparece */
  transform: translateY(0); /* Vuelve a la posición normal */
}

.splash-title {
  font-size: 3rem;
  font-weight: 600;
  color: #fff; /* Color del título */
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); /* Sombra al texto */
}

.splash-subtitle {
  font-size: 1.2rem;
  color: #ddd; /* Color del subtítulo */
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); /* Sombra al texto */
}

.fade-out {
  opacity: 0;
  pointer-events: none;
  transform: scale(1.2); /* Un poco de escala para dar un efecto final */
  filter: blur(5px); /* Un pequeño desenfoque al final */
}

/* Fin src\styles\SplashScreen.css */

/* Inicio src\types\css.d.ts */
declare module '*.css'

/* Fin src\types\css.d.ts */

/* Inicio src\types\global.d.ts */
/* src/types/global.d.ts */
// Importa la interfaz MenuItem desde el contexto correcto
import { MenuItem } from '../context/AppContext'

declare global {
  interface Window {
    MercadoPago?: MercadoPago
    Stripe: (publicKey: string) => void
  }
  export type MenuItemType = MenuItem // Exporta MenuItemType

  // Define las interfaces para contabilidad aquí
  interface Movement {
    movementId: string
    type: 'entry' | 'exit'
    amount: number
    concept: string
    description?: string
    category: string
    method: string
    createdAt: string | number | Date
    createdBy: string
  }

  interface DailyCashRegister {
    id?: string
    date: string
    openingAmount: number
    closingAmount?: number
    realClosingAmount?: number
    discrepancy?: number
    status: 'open' | 'closed'
    createdBy: string
    closedBy?: string
    movements: Movement[]
    savings?: number; // Para guardar el ahorro diario
    baseAmount?: number; // Para guardar la base diaria
    dailyStaffPayments?: number; // Para guardar los pagos diarios al personal
    dailySalesRevenue?: number; // Para guardar los ingresos por ventas diarias
  }

  interface Expense {
    expenseId: string;
    date: string;
    amount: number;
    category: string;
    description?: string;
    paymentMethod: string;
    registeredBy: string;
    createdAt: string | number | Date;
  }

  interface StaffPayment {
    paymentId: string;
    date: string;
    employeeName: string;
    amount: number;
    paymentType: 'daily' | 'monthly' | 'quincenal';
    paymentMethod: string;
    registeredBy: string;
    createdAt: string | number | Date;
  }
}

interface MercadoPago {
  new(
    publicKey: string,
    options?,
  ): {
    checkout: (params) => void
  }
}

export { }; // Exporta un objeto vacío para evitar error de módulo

declare module '*.svg?url' {
  const content: string;
  export default content;
}
declare module '*.svg' {
  const content: string;
  export default content;
}
/* Fin src\types\global.d.ts */

/* Inicio src\utils\constants.ts */
/* src\utils\constants.ts */
export const COLLECTIONS = {
  MENU: 'menu',
  PEDIDOS: 'pedidos',
  GROUP_ORDERS: 'groupOrders', // Añadida la nueva colección
};
/* Fin src\utils\constants.ts */

/* Inicio src\utils\firebase.ts */
import { initializeApp } from 'firebase/app';
import { getAuth } from 'firebase/auth';
import { getFirestore } from 'firebase/firestore';

const firebaseConfig = {
  apiKey: "AIzaSyCKnLLXRtyfyLwVDVs05-q1NLR2JidFzus",
  authDomain: "alacartes.firebaseapp.com",
  projectId: "alacartes",
  storageBucket: "alacartes.firebasestorage.app",
  messagingSenderId: "145893311915",
  appId: "1:145893311915:web:9cd7cb44eba542ffda3eee"
};

const app = initializeApp(firebaseConfig);
export const db = getFirestore(app);
export const auth = getAuth(app);
/* Fin src\utils\firebase.ts */

/* Inicio src\utils\menu-scripts.ts */
// src/utils/menu-scripts.ts
import { addDoc, collection, deleteDoc, doc, getDocs } from 'firebase/firestore';
import { MenuItemType } from '../context/AppContext';
import { COLLECTIONS } from './constants';
import { auth, db } from './firebase';

export const deleteAllMenuItems = async () => {
    if (!auth.currentUser) {
        alert('Debes estar autenticado para eliminar el menú.');
        return;
    }
    if (!window.confirm('¿Estás seguro de que quieres eliminar TODO el menú? Esta acción es irreversible.')) {
        return;
    }
    try {
        const querySnapshot = await getDocs(collection(db, COLLECTIONS.MENU));
        const batch = [];
        querySnapshot.forEach((docSnap) => {
            batch.push(deleteDoc(doc(db, COLLECTIONS.MENU, docSnap.id)));
        });
        await Promise.all(batch);
        alert('Menú eliminado completamente.');
        return true;
    } catch (error) {
        console.error('Error al eliminar el menú:', error);
        alert('Error al eliminar el menú.');
        return false;
    }
};

export const createDefaultMenuItemsAndCombos = async () => {
    if (!auth.currentUser) {
        alert('Debes estar autenticado para crear el menú por defecto.');
        return;
    }
    if (!window.confirm('¿Estás seguro de que quieres crear el menú por defecto? Esto reemplazará el menú actual.')) {
        return;
    }

    try {
        const menuCollection = collection(db, COLLECTIONS.MENU);

        // Productos base (sin cambios en costos)
        const productosBase: Partial<MenuItemType>[] = [
            { name: 'Alitas BBQ', description: 'Alitas de pollo con salsa BBQ.', price: 3000, cost: 1500, points: 5, imageUrls: ['https://assets.unileversolutions.com/recipes-v2/237633.jpg'], available: true, recommendation: 'Alitas', observations: 'Salsa BBQ', availabilityStatus: 'disponible', isCombo: false, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Alitas Miel Mostaza', description: 'Alitas de pollo con salsa miel mostaza.', price: 3000, cost: 1500, points: 5, imageUrls: ['https://assets.unileversolutions.com/recipes-v2/237633.jpg'], available: true, recommendation: 'Alitas', observations: 'Salsa miel mostaza', availabilityStatus: 'disponible', isCombo: false, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Alitas Búfalo', description: 'Alitas de pollo con salsa búfalo.', price: 3000, cost: 1500, points: 5, imageUrls: ['https://assets.unileversolutions.com/recipes-v2/237633.jpg'], available: true, recommendation: 'Alitas', observations: 'Salsa búfalo', availabilityStatus: 'disponible', isCombo: false, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Pollo a la naranja', description: 'Pollo a la naranja con papa rustica.', price: 12000, cost: 6000, points: 15, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Especialidades', observations: '', availabilityStatus: 'disponible', isCombo: false, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Tiras de pollo', description: 'Tiras de pollo con papas rustica.', price: 10000, cost: 5000, points: 10, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Especialidades', observations: '', availabilityStatus: 'disponible', isCombo: false, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Nuggets de pollo', description: 'Nuggets de pollo con papas rustica.', price: 10000, cost: 5000, points: 10, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Especialidades', observations: '', availabilityStatus: 'disponible', isCombo: false, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Presa de pollo', description: 'Presa de pollo (Ala, Muslo o Contramuslo).', price: 5500, cost: 2200, points: 5, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Presas', observations: 'Ala, Muslo o Contramuslo', availabilityStatus: 'disponible', isCombo: false, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Pechuga de pollo', description: 'Pechuga de pollo.', price: 7000, cost: 3500, points: 8, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Pechuga', observations: '', availabilityStatus: 'disponible', isCombo: false, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Porcion de papas rusticas', description: 'Porcion de papas rusticas.', price: 3000, cost: 1200, points: 3, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Acompañamiento', observations: '', availabilityStatus: 'disponible', isCombo: false, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Porcion de arroz', description: 'Porcion de arroz.', price: 2000, cost: 800, points: 2, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Acompañamiento', observations: '', availabilityStatus: 'disponible', isCombo: false, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Jugo Natural', description: 'Jugo Natural (varios sabores).', price: 4000, cost: 1800, points: 4, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Acompañamiento', observations: 'Varios sabores disponibles', availabilityStatus: 'disponible', isCombo: false, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Vaso gaseosa', description: 'Vaso de gaseosa.', price: 1000, cost: 400, points: 1, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Acompañamiento', observations: 'Varias marcas disponibles', availabilityStatus: 'disponible', isCombo: false, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
        ];

        // Combos - AHORA CON PRECIOS Y PUNTOS ESTIMADOS
        const combos: Partial<MenuItemType>[] = [
            { name: 'Combo x 4 alitas', description: 'Combo de 4 alitas (1 salsa a elección).', price: 11000, cost: 6000, points: 15, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Alitas', observations: '1 salsa a elección', availabilityStatus: 'disponible', isCombo: true, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Combo x 6 alitas', description: 'Combo de 6 alitas (1 salsa a elección).', price: 15000, cost: 9000, points: 20, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Alitas', observations: '1 salsa a elección', availabilityStatus: 'disponible', isCombo: true, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Combo x 12 alitas', description: 'Combo de 12 alitas (2 salsas a elección).', price: 25000, cost: 18000, points: 30, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Alitas', observations: '2 salsas a elección', availabilityStatus: 'disponible', isCombo: true, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Combo x 24 alitas', description: 'Combo de 24 alitas (3 salsas a elección).', price: 45000, cost: 36000, points: 50, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Alitas', observations: '3 salsas a elección', availabilityStatus: 'disponible', isCombo: true, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Combo Pollo Jugo', description: '1 Pollo broaster personal + 1 Jugo natural a elección.', price: 20000, cost: 8800, points: 30, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Combo clásico y completo', observations: 'Elige el sabor del jugo', availabilityStatus: 'disponible', isCombo: true, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Combo Alitas Papas', description: 'Alitas BBQ (6 unidades) + Porción de papas fritas pequeña.', price: 16000, cost: 10200, points: 20, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Perfecto para compartir', observations: '', availabilityStatus: 'disponible', isCombo: true, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Combo Familiar Broaster', description: '2 Pollos broaster personales + 2 Porciones de papas fritas pequeñas + 2 Jugos naturales grandes.', price: 50000, cost: 30000, points: 60, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Ideal para familias o grupos', observations: 'Incluye aderezos y salsas', availabilityStatus: 'disponible', isCombo: true, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Combo Individual Alipapas', description: '1 Alipapas Personal + 1 Limonada Natural.', price: 24000, cost: 11300, points: 30, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Opción rápida y deliciosa', observations: '', availabilityStatus: 'disponible', isCombo: true, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Combo Doble Pollo', description: '2 Pollos broaster personales + Porción de arroz pequeña.', price: 38000, cost: 15200, points: 40, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Para compartir o para mucho apetito', observations: 'Incluye salsas', availabilityStatus: 'disponible', isCombo: true, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Combo Alitas y Arroz', description: 'Alitas BBQ (6 unidades) + Porción de arroz pequeña.', price: 17000, cost: 10200, points: 20, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Combinación sabrosa y económica', observations: '', availabilityStatus: 'disponible', isCombo: true, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Super Combo Pollo Completo', description: '2 Pollos broaster personales + Alitas BBQ (6 unidades) + Porción de papas fritas pequeña + 2 Limonadas Cerezadas.', price: 65000, cost: 35600, points: 80, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'El combo más completo para compartir', observations: 'Incluye todas las salsas y aderezos', availabilityStatus: 'disponible', isCombo: true, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Combo Ahorro Alitas', description: 'Alitas BBQ (12 unidades) + Porción de papas fritas pequeña.', price: 22000, cost: 19200, points: 30, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Más alitas, más sabor', observations: 'Ideal para reuniones informales', availabilityStatus: 'disponible', isCombo: true, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Combo Refrescante Limonada', description: 'Limonada Natural + Porción de papas fritas pequeña.', price: 12000, cost: 4700, points: 10, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Ligero y refrescante', observations: 'Perfecto para días calurosos', availabilityStatus: 'disponible', isCombo: true, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
            { name: 'Combo Doble Jugo', description: '2 Jugos naturales a elección + Porción de arroz pequeña.', price: 18000, cost: 7100, points: 20, imageUrls: ['public/SrPolForYouSinTitle.svg'], available: true, recommendation: 'Para los amantes de los jugos naturales', observations: 'Elige tus sabores favoritos', availabilityStatus: 'disponible', isCombo: true, components: [], minimumPrice: 0, comboSellingPrice: 0, comboPoints: 0, additionalCosts: [], },
        ];

        // Añadir productos base
        const productIdsMap: { [key: string]: string } = {};
        for (const producto of productosBase) {
            const docRef = await addDoc(menuCollection, producto);
            productIdsMap[producto.name] = docRef.id;
        }

        // Añadir combos y referenciar componentes, AHORA CALCULANDO PRECIOS Y PUNTOS DE COMBO
        for (const combo of combos) {
            const comboComponents: string[] = [];
            let suggestedComboPrice = 0; // Para calcular precio de venta sugerido
            let suggestedComboPoints = 0; // Para calcular puntos sugeridos

            if (combo.name === 'Combo x 4 alitas') {
                for (let i = 0; i < 4; i++) {
                    comboComponents.push(productIdsMap['Alitas BBQ']);
                    suggestedComboPrice += productosBase.find(p => p.name === 'Alitas BBQ')?.price || 0;
                    suggestedComboPoints += productosBase.find(p => p.name === 'Alitas BBQ')?.points || 0;
                }
            } else if (combo.name === 'Combo x 6 alitas') {
                for (let i = 0; i < 6; i++) {
                    comboComponents.push(productIdsMap['Alitas BBQ']);
                    suggestedComboPrice += productosBase.find(p => p.name === 'Alitas BBQ')?.price || 0;
                    suggestedComboPoints += productosBase.find(p => p.name === 'Alitas BBQ')?.points || 0;
                }
            } else if (combo.name === 'Combo x 12 alitas') {
                for (let i = 0; i < 12; i++) {
                    comboComponents.push(productIdsMap['Alitas BBQ']);
                    suggestedComboPrice += productosBase.find(p => p.name === 'Alitas BBQ')?.price || 0;
                    suggestedComboPoints += productosBase.find(p => p.name === 'Alitas BBQ')?.points || 0;
                }
            } else if (combo.name === 'Combo x 24 alitas') {
                for (let i = 0; i < 24; i++) {
                    comboComponents.push(productIdsMap['Alitas BBQ']);
                    suggestedComboPrice += productosBase.find(p => p.name === 'Alitas BBQ')?.price || 0;
                    suggestedComboPoints += productosBase.find(p => p.name === 'Alitas BBQ')?.points || 0;
                }
            } else if (combo.name === 'Combo Pollo Jugo') {
                comboComponents.push(productIdsMap['Pollo Broaster Personal']);
                comboComponents.push(productIdsMap['Jugo Natural Naranja']);
                suggestedComboPrice += productosBase.find(p => p.name === 'Pollo Broaster Personal')?.price || 0;
                suggestedComboPrice += productosBase.find(p => p.name === 'Jugo Natural Naranja')?.price || 0;
                suggestedComboPoints += productosBase.find(p => p.name === 'Pollo Broaster Personal')?.points || 0;
                suggestedComboPoints += productosBase.find(p => p.name === 'Jugo Natural Naranja')?.points || 0;
            } else if (combo.name === 'Combo Alitas Papas') {
                comboComponents.push(productIdsMap['Alitas BBQ (6 unidades)']);
                comboComponents.push(productIdsMap['Porcion de papas rusticas']);
                suggestedComboPrice += productosBase.find(p => p.name === 'Alitas BBQ (6 unidades)')?.price || 0;
                suggestedComboPrice += productosBase.find(p => p.name === 'Porcion de papas rusticas')?.price || 0;
                suggestedComboPoints += productosBase.find(p => p.name === 'Alitas BBQ (6 unidades)')?.points || 0;
                suggestedComboPoints += productosBase.find(p => p.name === 'Porcion de papas rusticas')?.points || 0;
            } else if (combo.name === 'Combo Familiar Broaster') {
                comboComponents.push(productIdsMap['Pollo Broaster Personal']);
                comboComponents.push(productIdsMap['Pollo Broaster Personal']);
                comboComponents.push(productIdsMap['Porcion de papas rusticas']);
                comboComponents.push(productIdsMap['Porcion de papas rusticas']);
                comboComponents.push(productIdsMap['Jugo Natural Naranja']);
                comboComponents.push(productIdsMap['Jugo Natural Naranja']);
                suggestedComboPrice += (productosBase.find(p => p.name === 'Pollo Broaster Personal')?.price || 0) * 2;
                suggestedComboPrice += (productosBase.find(p => p.name === 'Porcion de papas rusticas')?.price || 0) * 2;
                suggestedComboPrice += (productosBase.find(p => p.name === 'Jugo Natural Naranja')?.price || 0) * 2;
                suggestedComboPoints += (productosBase.find(p => p.name === 'Pollo Broaster Personal')?.points || 0) * 2;
                suggestedComboPoints += (productosBase.find(p => p.name === 'Porcion de papas rusticas')?.points || 0) * 2;
                suggestedComboPoints += (productosBase.find(p => p.name === 'Jugo Natural Naranja')?.points || 0) * 2;
            } else if (combo.name === 'Combo Individual Alipapas') {
                comboComponents.push(productIdsMap['Alipapas Personal']);
                comboComponents.push(productIdsMap['Limonada Natural']);
                suggestedComboPrice += productosBase.find(p => p.name === 'Alipapas Personal')?.price || 0;
                suggestedComboPrice += productosBase.find(p => p.name === 'Limonada Natural')?.price || 0;
                suggestedComboPoints += productosBase.find(p => p.name === 'Alipapas Personal')?.points || 0;
                suggestedComboPoints += productosBase.find(p => p.name === 'Limonada Natural')?.points || 0;
            } else if (combo.name === 'Combo Doble Pollo') {
                comboComponents.push(productIdsMap['Pollo Broaster Personal']);
                comboComponents.push(productIdsMap['Pollo Broaster Personal']);
                comboComponents.push(productIdsMap['Porcion de arroz']);
                suggestedComboPrice += (productosBase.find(p => p.name === 'Pollo Broaster Personal')?.price || 0) * 2;
                suggestedComboPrice += productosBase.find(p => p.name === 'Porcion de arroz')?.price || 0;
                suggestedComboPoints += (productosBase.find(p => p.name === 'Pollo Broaster Personal')?.points || 0) * 2;
                suggestedComboPoints += productosBase.find(p => p.name === 'Porcion de arroz')?.points || 0;
            } else if (combo.name === 'Combo Alitas y Arroz') {
                comboComponents.push(productIdsMap['Alitas BBQ (6 unidades)']);
                comboComponents.push(productIdsMap['Porcion de arroz']);
                suggestedComboPrice += productosBase.find(p => p.name === 'Alitas BBQ (6 unidades)')?.price || 0;
                suggestedComboPrice += productosBase.find(p => p.name === 'Porcion de arroz')?.price || 0;
                suggestedComboPoints += productosBase.find(p => p.name === 'Alitas BBQ (6 unidades)')?.points || 0;
                suggestedComboPoints += productosBase.find(p => p.name === 'Porcion de arroz')?.points || 0;
            } else if (combo.name === 'Super Combo Pollo Completo') {
                comboComponents.push(productIdsMap['Pollo Broaster Personal']);
                comboComponents.push(productIdsMap['Pollo Broaster Personal']);
                comboComponents.push(productIdsMap['Alitas BBQ (6 unidades)']);
                comboComponents.push(productIdsMap['Porcion de papas rusticas']);
                comboComponents.push(productIdsMap['Limonada Cerezada']);
                comboComponents.push(productIdsMap['Limonada Cerezada']);
                suggestedComboPrice += (productosBase.find(p => p.name === 'Pollo Broaster Personal')?.price || 0) * 2;
                suggestedComboPrice += productosBase.find(p => p.name === 'Alitas BBQ (6 unidades)')?.price || 0;
                suggestedComboPrice += productosBase.find(p => p.name === 'Porcion de papas rusticas')?.price || 0;
                suggestedComboPrice += (productosBase.find(p => p.name === 'Limonada Cerezada')?.price || 0) * 2;
                suggestedComboPoints += (productosBase.find(p => p.name === 'Pollo Broaster Personal')?.points || 0) * 2;
                suggestedComboPoints += productosBase.find(p => p.name === 'Alitas BBQ (6 unidades)')?.points || 0;
                suggestedComboPoints += productosBase.find(p => p.name === 'Porcion de papas rusticas')?.points || 0;
                suggestedComboPoints += (productosBase.find(p => p.name === 'Limonada Cerezada')?.points || 0) * 2;
            } else if (combo.name === 'Combo Ahorro Alitas') {
                comboComponents.push(productIdsMap['Alitas BBQ (6 unidades)']);
                comboComponents.push(productIdsMap['Alitas BBQ (6 unidades)']);
                comboComponents.push(productIdsMap['Porcion de papas rusticas']);
                suggestedComboPrice += (productosBase.find(p => p.name === 'Alitas BBQ (6 unidades)')?.price || 0) * 2;
                suggestedComboPrice += productosBase.find(p => p.name === 'Porcion de papas rusticas')?.price || 0;
                suggestedComboPoints += (productosBase.find(p => p.name === 'Alitas BBQ (6 unidades)')?.points || 0) * 2;
                suggestedComboPoints += productosBase.find(p => p.name === 'Porcion de papas rusticas')?.points || 0;
            } else if (combo.name === 'Combo Refrescante Limonada') {
                comboComponents.push(productIdsMap['Limonada Natural']);
                comboComponents.push(productIdsMap['Porcion de papas rusticas']);
                suggestedComboPrice += productosBase.find(p => p.name === 'Limonada Natural')?.price || 0;
                suggestedComboPrice += productosBase.find(p => p.name === 'Porcion de papas rusticas')?.price || 0;
                suggestedComboPoints += productosBase.find(p => p.name === 'Limonada Natural')?.points || 0;
                suggestedComboPoints += productosBase.find(p => p.name === 'Porcion de papas rusticas')?.points || 0;
            } else if (combo.name === 'Combo Doble Jugo') {
                comboComponents.push(productIdsMap['Jugo Natural Naranja']);
                comboComponents.push(productIdsMap['Jugo Natural Naranja']);
                comboComponents.push(productIdsMap['Porcion de arroz']);
                suggestedComboPrice += (productosBase.find(p => p.name === 'Jugo Natural Naranja')?.price || 0) * 2;
                suggestedComboPrice += productosBase.find(p => p.name === 'Porcion de arroz')?.price || 0;
                suggestedComboPoints += (productosBase.find(p => p.name === 'Jugo Natural Naranja')?.points || 0) * 2;
                suggestedComboPoints += productosBase.find(p => p.name === 'Porcion de arroz')?.points || 0;
            }


            const comboSellingPrice = suggestedComboPrice * 0.9; // Aplicar 10% de descuento al precio sugerido
            const comboToSave: Partial<MenuItemType> = {
                ...combo,
                components: comboComponents,
                comboSellingPrice: comboSellingPrice,
                comboPoints: suggestedComboPoints,
                minimumPrice: combo.cost // Usar el costo estimado como minimumPrice
            };
            await addDoc(menuCollection, comboToSave);
        }


        alert('Menú por defecto creado exitosamente.');
        return true;
    } catch (error) {
        console.error('Error al crear el menú por defecto:', error);
        alert('Error al crear el menú por defecto.');
        return false;
    }
};
/* Fin src\utils\menu-scripts.ts */

/* Inicio src\utils\theme.ts */
// src/utils/theme.ts
import { createTheme } from '@mui/material/styles';

const theme = createTheme({
    palette: {
        primary: {
            main: '#1976d2', // Color primario
        },
        secondary: {
            main: '#dc004e', // Color secundario
        },
        background: {
            default: '#f4f6f8', // Fondo general
            paper: '#ffffff', // Fondos de componentes
        },
    },
    typography: {
        fontFamily: '"Roboto", "Helvetica", "Arial", sans-serif',
        h5: {
            fontWeight: 600,
        },
    },
    components: {
        MuiButton: {
            styleOverrides: {
                root: {
                    textTransform: 'none', // Mantener el texto en su forma original
                },
            },
        },
        MuiTextField: {
            styleOverrides: {
                root: {
                    marginTop: '8px',
                    marginBottom: '8px',
                },
            },
        },
    },
});

export default theme;

/* Fin src\utils\theme.ts */

/* Inicio tailwind.config.js */
/** @type {import('tailwindcss').Config} */
export default {
  content: ['./index.html', './src/**/*.{js,ts,jsx,tsx}'],
  theme: {
    extend: {},
  },
  plugins: [],
}

/* Fin tailwind.config.js */

/* Inicio tsconfig.app.json */
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "noImplicitAny": false,
    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",
    /* Linting */
    "strict": false,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}

/* Fin tsconfig.app.json */

/* Inicio tsconfig.json */
{
  "compilerOptions": {
    "typeRoots": [
      "src/types",
      "./node_modules/@types"
    ],
    "outDir": "dist",
    "rootDir": "src",
    "strict": false,
    "noImplicitAny": false,
    "allowJs": true,
    "skipLibCheck": true,
    "target": "ES2020",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "isolatedModules": true,
    "jsx": "react-jsx",
    "esModuleInterop": true,
    "forceConsistentCasingInFileNames": true
  },
  "include": [
    "src"
  ],
  "exclude": [
    "node_modules",
    "dist",
    "eslint.config.js"
  ]
}
/* Fin tsconfig.json */

/* Inicio tsconfig.node.json */
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2022",
    "lib": ["ES2023"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}

/* Fin tsconfig.node.json */

/* Inicio vite.config.ts */
import react from '@vitejs/plugin-react'
import { defineConfig } from 'vite'
import { VitePWA } from 'vite-plugin-pwa'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [
    react(),
    VitePWA({
      registerType: 'autoUpdate',
      manifest: {
        name: 'SrPol',
        short_name: 'SrPol',
        description: 'Aplicación para restaurantes',
        theme_color: '#ffffff',
        icons: [
          {
            src: '/logo192.png',
            sizes: '192x192',
            type: 'image/png',
          },
          {
            src: '/logo512.png',
            sizes: '512x512',
            type: 'image/png',
          },
        ],
        start_url: '.',
        display: 'standalone',
        background_color: '#ffffff',
      },
      workbox: {
        globPatterns: ['**/*.{js,css,html,ico,png,svg,woff2}'],
      },
    }),
  ],
  server: {
    host: '0.0.0.0', // Escucha en todas las interfaces de red
    port: 5173, // O el puerto que estés usando (por defecto es 5173)
  },
})
/* Fin vite.config.ts */
